<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trading Journal - Multi Currency</title>
<style>
:root {
    --green:#2fa37a;
    --red:#e5533d;
    --soft-green:#eaf6f1;
    --soft-red:#fdecea;
    --bg:#f6f7f8;
    --blue:#4a6491;
    --dark-blue:#2c3e50;
    --gray:#7f8c8d;
    --purple:#9b59b6;
    --orange:#e67e22;
    --yellow:#f1c40f;
    --idr-green:#27ae60;
}

* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
}

body {
    padding: 20px;
    max-width: 1200px;
    margin: 0 auto;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    background-attachment: fixed;
    transition: background-image 0.5s ease;
    min-height: 100vh;
}

/* FIX: Background TANPA overlay atau blur untuk wallpaper terlihat jelas */
.container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
}

@media (max-width: 900px) {
    .container {
        grid-template-columns: 1fr;
    }
}

/* Header dengan Account Selector */
.header-section {
    grid-column: 1 / -1;
    background: rgba(255, 255, 255, 0.95);
    border-radius: 16px;
    padding: 20px;
    box-shadow: 0 6px 24px rgba(0,0,0,.1);
    margin-bottom: 20px;
    border: 1px solid rgba(255, 255, 255, 0.3);
}

.header-title {
    font-size: 1.8rem;
    color: var(--dark-blue);
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
}

/* Account Selector */
.account-selector {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
    flex-wrap: wrap;
}

.account-tab {
    padding: 10px 20px;
    border: 2px solid #ddd;
    border-radius: 10px;
    background: rgba(248, 249, 250, 0.95);
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    gap: 8px;
}

.account-tab:hover {
    background: rgba(233, 236, 239, 0.95);
    transform: translateY(-2px);
}

.account-tab.active {
    border-color: var(--blue);
    background: rgba(74, 100, 145, 0.95);
    color: white;
    box-shadow: 0 4px 12px rgba(74, 100, 145, 0.3);
}

.account-tab.usd {
    border-left: 4px solid var(--green);
}

.account-tab.cent {
    border-left: 4px solid var(--orange);
}

.account-tab.idr {
    border-left: 4px solid var(--idr-green);
}

.account-badge {
    background: rgba(255,255,255,0.2);
    padding: 2px 8px;
    border-radius: 10px;
    font-size: 0.8rem;
}

/* Wallpaper Button */
.wallpaper-btn {
    margin-left: auto;
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.9) 0%, rgba(118, 75, 162, 0.9) 100%);
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 10px;
    cursor: pointer;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.3s;
}

.wallpaper-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
}

/* Balance Display */
.balance-display {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-top: 15px;
}

@media (max-width: 600px) {
    .balance-display {
        grid-template-columns: 1fr;
    }
}

.current-balance {
    background: linear-gradient(135deg, rgba(232, 245, 233, 0.95), rgba(200, 230, 201, 0.95));
    padding: 20px;
    border-radius: 12px;
    border-left: 4px solid var(--green);
}

.initial-capital {
    background: linear-gradient(135deg, rgba(248, 249, 250, 0.95), rgba(233, 236, 239, 0.95));
    padding: 20px;
    border-radius: 12px;
    border-left: 4px solid var(--blue);
}

.balance-label {
    font-size: 0.9rem;
    color: var(--gray);
    margin-bottom: 5px;
}

.balance-amount {
    font-size: 1.8rem;
    font-weight: 700;
    margin: 5px 0;
}

.current-balance .balance-amount {
    color: var(--green);
}

.initial-capital .balance-amount {
    color: var(--dark-blue);
}

.growth-display {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 10px;
    font-size: 0.9rem;
}

.growth-badge {
    padding: 4px 10px;
    border-radius: 20px;
    font-weight: 600;
    font-size: 0.9rem;
}

.growth-positive {
    background: var(--soft-green);
    color: var(--green);
}

.growth-negative {
    background: var(--soft-red);
    color: var(--red);
}

.btn-edit {
    background: none;
    border: 1px solid var(--blue);
    color: var(--blue);
    padding: 5px 15px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.8rem;
    margin-top: 5px;
    transition: all 0.3s;
}

.btn-edit:hover {
    background: var(--blue);
    color: white;
    transform: translateY(-1px);
}

/* Form Input Trading */
.form-card {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 16px;
    padding: 20px;
    box-shadow: 0 6px 24px rgba(0,0,0,.1);
    border: 1px solid rgba(255, 255, 255, 0.3);
}

.form-card h2 {
    color: var(--dark-blue);
    margin-bottom: 20px;
    font-size: 1.3rem;
    display: flex;
    align-items: center;
    gap: 10px;
}

.form-group {
    margin-bottom: 15px;
}

label {
    display: block;
    margin-bottom: 5px;
    font-weight: 500;
    color: #444;
    font-size: 0.9rem;
}

input, select, textarea {
    width: 100%;
    padding: 10px 12px;
    border: 1px solid #ddd;
    border-radius: 8px;
    font-size: 14px;
    background: white;
}

input:focus, select:focus, textarea:focus {
    outline: none;
    border-color: var(--blue);
    box-shadow: 0 0 0 3px rgba(74, 100, 145, 0.1);
}

/* Profit/Loss Option Styling */
.profit-loss-option {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    margin-bottom: 15px;
}

.profit-loss-btn {
    padding: 12px;
    border: 2px solid #ddd;
    border-radius: 8px;
    background: white;
    cursor: pointer;
    font-weight: 600;
    text-align: center;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

.profit-loss-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.profit-btn {
    border-color: var(--green);
    color: var(--green);
}

.profit-btn.selected {
    background: var(--soft-green);
    border-color: var(--green);
    color: var(--green);
}

.loss-btn {
    border-color: var(--red);
    color: var(--red);
}

.loss-btn.selected {
    background: var(--soft-red);
    border-color: var(--red);
    color: var(--red);
}

.amount-input-group {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 10px;
    align-items: end;
}

.currency-display {
    background: #f8f9fa;
    padding: 10px 12px;
    border-radius: 8px;
    border: 1px solid #ddd;
    font-weight: 600;
    color: var(--dark-blue);
    text-align: center;
}

.btn {
    padding: 12px 20px;
    border: none;
    border-radius: 8px;
    background: var(--blue);
    color: white;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    width: 100%;
    font-size: 1rem;
}

.btn:hover {
    background: var(--dark-blue);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(44, 62, 80, 0.3);
}

.btn-success {
    background: var(--green);
}

.btn-success:hover {
    background: #2a916a;
}

.btn-danger {
    background: var(--red);
}

.btn-danger:hover {
    background: #c4412e;
}

/* Kalender PnL */
.calendar-card {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 16px;
    padding: 20px;
    box-shadow: 0 6px 24px rgba(0,0,0,.1);
    border: 1px solid rgba(255, 255, 255, 0.3);
}

.tabs {
    display: flex;
    gap: 20px;
    font-weight: 600;
    margin-bottom: 20px;
    border-bottom: 1px solid #eee;
    padding-bottom: 10px;
}

.tabs span {
    padding: 5px 0;
    cursor: pointer;
    color: var(--gray);
}

.tabs .active {
    color: var(--dark-blue);
    border-bottom: 2px solid var(--dark-blue);
}

.calendar-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.calendar-header .nav {
    cursor: pointer;
    font-weight: 600;
    padding: 5px 10px;
    border-radius: 6px;
    transition: all 0.3s;
    background: #f8f9fa;
}

.calendar-header .nav:hover {
    background: #f1f2f3;
    transform: translateY(-1px);
}

.month-label {
    font-weight: 600;
    font-size: 1.1rem;
}

.summary-box {
    background: #f1f2f3;
    border-radius: 12px;
    padding: 12px;
    text-align: center;
    margin-bottom: 15px;
    font-weight: 600;
}

.days-header {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    font-size: 12px;
    color: var(--gray);
    text-align: center;
    margin-bottom: 8px;
    padding: 0 5px;
}

.calendar-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 8px;
}

.calendar-cell {
    border-radius: 10px;
    padding: 8px 4px;
    text-align: center;
    font-size: 13px;
    min-height: 60px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    cursor: pointer;
    transition: all 0.3s;
    background: white;
    border: 1px solid #e9ecef;
}

.calendar-cell:hover {
    transform: scale(1.05);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.positive { 
    background: var(--soft-green);
    border: 1px solid #d4e9e0;
}

.negative { 
    background: var(--soft-red);
    border: 1px solid #f8d9d5;
}

.neutral {
    background: #f8f9fa;
    border: 1px solid #e9ecef;
}

.pnl-amount {
    font-size: 11px;
    font-weight: 600;
    margin-top: 3px;
}

.positive .pnl-amount { color: var(--green); }
.negative .pnl-amount { color: var(--red); }
.neutral .pnl-amount { color: var(--gray); }

.day-number {
    font-size: 13px;
    font-weight: 500;
}

.trade-count {
    font-size: 10px;
    color: var(--gray);
    background: rgba(255,255,255,0.7);
    border-radius: 3px;
    padding: 1px 4px;
    margin-top: 3px;
}

.empty-cell {
    background: transparent;
    border: 1px dashed #eee;
}

/* Statistics */
.stats-card {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 16px;
    padding: 20px;
    box-shadow: 0 6px 24px rgba(0,0,0,.1);
    grid-column: 1 / -1;
    border: 1px solid rgba(255, 255, 255, 0.3);
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-top: 15px;
}

.stat-item {
    background: #f8f9fa;
    border-radius: 10px;
    padding: 15px;
    text-align: center;
    transition: transform 0.3s;
}

.stat-item:hover {
    transform: translateY(-5px);
}

.stat-value {
    font-size: 1.5rem;
    font-weight: 600;
    margin: 5px 0;
}

.stat-positive { color: var(--green); }
.stat-negative { color: var(--red); }
.stat-neutral { color: var(--gray); }

.stat-label {
    font-size: 0.8rem;
    color: var(--gray);
}

/* Trade List */
.trades-card {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 16px;
    padding: 20px;
    box-shadow: 0 6px 24px rgba(0,0,0,.1);
    grid-column: 1 / -1;
    margin-top: 20px;
    border: 1px solid rgba(255, 255, 255, 0.3);
}

.trades-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
}

.trades-table th {
    text-align: left;
    padding: 12px 15px;
    background: #f8f9fa;
    color: var(--gray);
    font-weight: 500;
    font-size: 0.9rem;
    border-bottom: 2px solid #eee;
}

.trades-table td {
    padding: 12px 15px;
    border-bottom: 1px solid #eee;
    font-size: 0.9rem;
    background: white;
}

.trade-positive { color: var(--green); font-weight: 600; }
.trade-negative { color: var(--red); font-weight: 600; }
.trade-neutral { color: var(--gray); }

.trade-direction-buy { color: var(--green); }
.trade-direction-sell { color: var(--red); }

.delete-btn {
    background: none;
    border: none;
    color: var(--red);
    cursor: pointer;
    padding: 5px;
    transition: transform 0.2s;
}

.delete-btn:hover {
    transform: scale(1.2);
}

/* Modal */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.7);
    justify-content: center;
    align-items: center;
    z-index: 1000;
}

.modal-content {
    background: white;
    padding: 30px;
    border-radius: 16px;
    width: 90%;
    max-width: 400px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.4);
    animation: modalAppear 0.3s ease;
}

@keyframes modalAppear {
    from {
        opacity: 0;
        transform: translateY(-20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.modal-title {
    font-size: 1.3rem;
    color: var(--dark-blue);
}

.close-btn {
    background: none;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
    color: var(--gray);
}

/* Account Indicator */
.account-indicator {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    padding: 3px 8px;
    border-radius: 12px;
    font-size: 0.7rem;
    font-weight: 600;
    margin-left: 5px;
}

.usd-indicator {
    background: var(--soft-green);
    color: var(--green);
}

.cent-indicator {
    background: #ffeaa7;
    color: var(--orange);
}

.idr-indicator {
    background: #d5f4e6;
    color: var(--idr-green);
}

/* Currency Conversion Settings */
.conversion-settings {
    background: rgba(255, 243, 205, 0.3);
    padding: 15px;
    border-radius: 10px;
    margin-top: 15px;
    border-left: 4px solid #ffc107;
}

.conversion-toggle {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 10px;
}

.toggle-switch {
    position: relative;
    display: inline-block;
    width: 50px;
    height: 24px;
}

.toggle-switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.toggle-slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    transition: .4s;
    border-radius: 34px;
}

.toggle-slider:before {
    position: absolute;
    content: "";
    height: 16px;
    width: 16px;
    left: 4px;
    bottom: 4px;
    background-color: white;
    transition: .4s;
    border-radius: 50%;
}

input:checked + .toggle-slider {
    background-color: var(--green);
}

input:checked + .toggle-slider:before {
    transform: translateX(26px);
}

/* Responsive */
@media (max-width: 600px) {
    body {
        padding: 10px;
    }
    
    .calendar-cell {
        min-height: 50px;
        padding: 5px 2px;
        font-size: 12px;
    }
    
    .pnl-amount {
        font-size: 10px;
    }
    
    .amount-input-group {
        grid-template-columns: 1fr;
    }
    
    .account-selector {
        flex-direction: column;
    }
    
    .wallpaper-btn {
        margin-left: 0;
        margin-top: 10px;
        width: 100%;
    }
    
    .profit-loss-option {
        grid-template-columns: 1fr;
    }
}

/* Footer */
.footer {
    grid-column: 1 / -1;
    text-align: center;
    margin-top: 30px;
    padding: 20px;
    color: var(--gray);
    font-size: 0.9rem;
    background: rgba(255, 255, 255, 0.95);
    border-radius: 10px;
}

/* Exchange Rate Display */
.exchange-rate {
    background: rgba(52, 152, 219, 0.1);
    padding: 10px 15px;
    border-radius: 8px;
    margin-top: 10px;
    border-left: 4px solid #3498db;
    font-size: 0.85rem;
}

.exchange-rate strong {
    color: var(--dark-blue);
}

/* Cent Info Display */
.cent-info {
    background: rgba(255, 234, 167, 0.3);
    padding: 10px 15px;
    border-radius: 8px;
    margin-top: 10px;
    border-left: 4px solid var(--orange);
    font-size: 0.85rem;
}

.cent-info strong {
    color: var(--orange);
}

/* Modal Input untuk Cent */
.cent-input-info {
    font-size: 0.8rem;
    color: var(--orange);
    margin-top: 5px;
    font-weight: 500;
}
</style>
</head>
<body>

<!-- Modal Update Modal dengan info currency -->
<div id="capitalModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">üí∞ Update Modal</h3>
            <button class="close-btn" onclick="closeCapitalModal()">&times;</button>
        </div>
        <div class="form-group">
            <label id="capitalLabel">Jumlah Modal Baru</label>
            <input type="number" id="newCapital" placeholder="Contoh: 1000" min="0" step="0.01" required>
            <div id="capitalInfo" class="cent-input-info"></div>
        </div>
        <button class="btn btn-success" onclick="updateInitialCapital()" style="width: 100%; margin-top: 10px;">
            Update Modal
        </button>
    </div>
</div>

<!-- Modal Detail Hari -->
<div id="dayDetailModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title" id="dayDetailTitle">Detail Trading</h3>
            <button class="close-btn" onclick="closeDayDetailModal()">&times;</button>
        </div>
        <div id="dayDetailContent">
            <!-- Konten akan diisi oleh JavaScript -->
        </div>
    </div>
</div>

<!-- Modal Add Account -->
<div id="addAccountModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">‚ûï Tambah Account Baru</h3>
            <button class="close-btn" onclick="closeAddAccountModal()">&times;</button>
        </div>
        <div class="form-group">
            <label>Nama Account</label>
            <input type="text" id="newAccountName" placeholder="Contoh: Akun Cent Saya" required>
        </div>
        <div class="form-group">
            <label>Tipe Currency</label>
            <select id="newAccountType">
                <option value="usd">USD Account</option>
                <option value="cent">Cent Account</option>
                <option value="idr">Rupiah Account</option>
            </select>
        </div>
        <div class="form-group">
            <label>Modal Awal</label>
            <input type="number" id="newAccountCapital" placeholder="Contoh: 1000" min="0" step="0.01" required>
            <div id="newAccountInfo" class="cent-input-info"></div>
        </div>
        <div id="currencyInfo" style="display: none; background: rgba(255, 243, 205, 0.3); padding: 10px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #ffc107;">
            <!-- Info currency akan diisi JavaScript -->
        </div>
        <div class="conversion-settings" id="conversionSettings" style="display: none;">
            <div class="conversion-toggle">
                <label style="font-weight: 600; font-size: 0.9rem;">Tampilkan dalam IDR:</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="convertToIdr">
                    <span class="toggle-slider"></span>
                </label>
            </div>
            <div id="conversionInfo" style="font-size: 0.8rem; color: var(--gray);">
                Cent akan dikonversi ke IDR (100 CENT = 1 USD = 15,000 IDR)
            </div>
        </div>
        <button class="btn btn-success" onclick="addNewAccount()" style="width: 100%; margin-top: 10px;">
            Buat Account Baru
        </button>
    </div>
</div>

<!-- Modal Wallpaper SIMPLE - tanpa opacity control -->
<div id="wallpaperModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">üé® Custom Background</h3>
            <button class="close-btn" onclick="closeWallpaperModal()">&times;</button>
        </div>
        
        <div class="form-group">
            <label>Upload Gambar</label>
            <input type="file" id="wallpaperUpload" accept="image/*">
        </div>
        
        <div style="margin: 20px 0; text-align: center; color: var(--gray); font-size: 0.9rem;">
            atau pilih preset:
        </div>
        
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;">
            <div class="wallpaper-preset" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); height: 80px; border-radius: 8px; cursor: pointer;" onclick="setWallpaper('gradient1')"></div>
            <div class="wallpaper-preset" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); height: 80px; border-radius: 8px; cursor: pointer;" onclick="setWallpaper('gradient2')"></div>
            <div class="wallpaper-preset" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); height: 80px; border-radius: 8px; cursor: pointer;" onclick="setWallpaper('gradient3')"></div>
            <div class="wallpaper-preset" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); height: 80px; border-radius: 8px; cursor: pointer;" onclick="setWallpaper('gradient4')"></div>
            <div class="wallpaper-preset" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); height: 80px; border-radius: 8px; cursor: pointer;" onclick="setWallpaper('gradient5')"></div>
            <div class="wallpaper-preset" style="background: #f6f7f8; border: 2px solid #ddd; height: 80px; border-radius: 8px; cursor: pointer;" onclick="setWallpaper('default')">
                <div style="display: flex; align-items: center; justify-content: center; height: 100%; color: var(--gray);">Default</div>
            </div>
        </div>
        
        <button class="btn btn-danger" onclick="clearWallpaper()" style="width: 100%; margin-top: 20px;">
            ‚ùå Reset ke Default
        </button>
    </div>
</div>

<div class="header-section">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h1 class="header-title">üí∞ Trading Journal - Multi Currency</h1>
        <button class="wallpaper-btn" onclick="showWallpaperModal()">
            üé® Background
        </button>
    </div>
    
    <!-- Account Selector -->
    <div class="account-selector" id="accountTabs">
        <!-- Tabs akan diisi oleh JavaScript -->
    </div>
    
    <!-- Exchange Rate Info -->
    <div class="exchange-rate" id="exchangeRateInfo">
        <strong>Kurs Konversi:</strong> 1 USD = 100 CENT = 15,000 IDR
    </div>
    
    <!-- Cent Account Info (hanya tampil untuk cent account) -->
    <div class="cent-info" id="centAccountInfo" style="display: none;">
        <strong>Cent Account:</strong> 100 CENT = 1 USD = 15,000 IDR. Modal dalam CENT.
    </div>
    
    <div class="balance-display">
        <!-- SALDO SAAT INI (ATAS) -->
        <div class="current-balance">
            <div class="balance-label">SALDO SAAT INI</div>
            <div class="balance-amount" id="currentBalance">$0.00</div>
            <div class="growth-display">
                <div>
                    <span style="color: var(--gray);">Total Profit/Loss:</span>
                    <span id="totalProfitDisplay" style="font-weight: 600; margin-left: 5px;">$0.00</span>
                </div>
                <div class="growth-badge growth-positive" id="growthDisplay">+0.00%</div>
            </div>
        </div>
        
        <!-- MODAL AWAL (BAWAH) -->
        <div class="initial-capital">
            <div class="balance-label">MODAL AWAL</div>
            <div class="balance-amount" id="initialCapitalDisplay">$0.00</div>
            <button class="btn-edit" onclick="showCapitalModal()">
                ‚úèÔ∏è Edit Modal
            </button>
        </div>
    </div>
</div>

<div class="container">
    <!-- Form Input Trading -->
    <div class="form-card">
        <h2>
            ‚ûï Input Profit Trading 
            <span class="account-indicator usd-indicator" id="currentAccountBadge">USD</span>
        </h2>
        
        <!-- Cent Info -->
        <div class="cent-info" id="formCentInfo" style="display: none; margin-bottom: 15px;">
            <strong>Cent Account:</strong> Input profit dalam CENT. 100 CENT = 1 USD = 15,000 IDR
        </div>
        
        <!-- Conversion Toggle for Cent Account -->
        <div class="conversion-settings" id="formConversionSettings" style="display: none;">
            <div class="conversion-toggle">
                <label style="font-weight: 600; font-size: 0.9rem;">Tampilkan dalam IDR:</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="displayInIdr" onchange="toggleDisplayCurrency()">
                    <span class="toggle-slider"></span>
                </label>
            </div>
        </div>
        
        <form id="tradeForm">
            <div class="form-group">
                <label>Tanggal Trading</label>
                <input type="date" id="tradeDate" required>
            </div>
            
            <div class="form-group">
                <label>Pasangan Pair</label>
                <input type="text" id="pair" placeholder="Contoh: BTC/USDT" required>
            </div>
            
            <div class="form-group">
                <label>Arah Trading</label>
                <select id="direction" required>
                    <option value="BUY">BUY/Long</option>
                    <option value="SELL">SELL/Short</option>
                </select>
            </div>
            
            <!-- PROFIT/LOSS OPTION -->
            <div class="profit-loss-option">
                <div class="profit-loss-btn profit-btn" id="profitBtn" onclick="selectProfitLoss('profit')">
                    <span>üìà</span>
                    <span>PROFIT</span>
                </div>
                <div class="profit-loss-btn loss-btn" id="lossBtn" onclick="selectProfitLoss('loss')">
                    <span>üìâ</span>
                    <span>LOSS</span>
                </div>
            </div>
            
            <!-- Hidden input untuk menyimpan pilihan -->
            <input type="hidden" id="profitLossType" value="profit">
            
            <div class="form-group amount-input-group">
                <div>
                    <label id="amountLabel">Jumlah Profit</label>
                    <input type="number" id="profitAmount" placeholder="Contoh: 280" min="0" step="0.01" required>
                    <div id="profitInfo" class="cent-input-info" style="display: none;">Dalam CENT</div>
                </div>
                <div>
                    <label>Mata Uang</label>
                    <div class="currency-display" id="currencyDisplay">USD</div>
                </div>
            </div>
            
            <div class="form-group">
                <label>Profit/Loss dalam <span id="displayCurrencyLabel">USD</span></label>
                <input type="text" id="profitDisplay" placeholder="Auto calculate" readonly>
            </div>
            
            <div class="form-group">
                <label>Catatan Trading (Opsional)</label>
                <textarea id="notes" rows="2" placeholder="Strategi, emosi, atau catatan penting..."></textarea>
            </div>
            
            <button type="submit" class="btn btn-success">
                üí∞ Simpan Trading
            </button>
        </form>
    </div>

    <!-- Kalender PnL -->
    <div class="calendar-card">
        <div class="tabs">
            <span class="active">üìÖ PnL Harian</span>
        </div>
        
        <div class="calendar-header">
            <span class="nav" onclick="changeMonth(-1)">‚óÄ Prev</span>
            <span class="month-label" id="monthLabel"></span>
            <span class="nav" onclick="changeMonth(1)">Next ‚ñ∂</span>
        </div>
        
        <div class="summary-box" id="monthSummary">
            Total PnL Bulan Ini: $0.00
        </div>
        
        <div class="days-header">
            <div>Min</div><div>Sen</div><div>Sel</div><div>Rab</div><div>Kam</div><div>Jum</div><div>Sab</div>
        </div>
        
        <div class="calendar-grid" id="calendarGrid">
            <!-- Kalender akan diisi oleh JavaScript -->
        </div>
    </div>

    <!-- Statistics -->
    <div class="stats-card">
        <h2>üìä Statistik Performa</h2>
        <div class="stats-grid">
            <div class="stat-item">
                <div class="stat-label">Profit Terbesar</div>
                <div class="stat-value stat-positive" id="statMaxProfit">$0.00</div>
                <div class="stat-label" id="statMaxProfitDate">-</div>
            </div>
            
            <div class="stat-item">
                <div class="stat-label">Loss Terbesar</div>
                <div class="stat-value stat-negative" id="statMaxLoss">$0.00</div>
                <div class="stat-label" id="statMaxLossDate">-</div>
            </div>
            
            <div class="stat-item">
                <div class="stat-label">Total Trading</div>
                <div class="stat-value stat-neutral" id="statTotalTrades">0</div>
                <div class="stat-label">Transaksi</div>
            </div>
            
            <div class="stat-item">
                <div class="stat-label">Win Rate</div>
                <div class="stat-value stat-neutral" id="statWinRate">0%</div>
                <div class="stat-label">Rasio Menang</div>
            </div>
        </div>
    </div>

    <!-- Riwayat Trading -->
    <div class="trades-card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h2 style="margin: 0;">üìã Riwayat Trading</h2>
            <div style="display: flex; gap: 10px;">
                <button class="btn" onclick="showAddAccountModal()" style="width: auto; padding: 8px 15px;">
                    ‚ûï Account
                </button>
                <button class="btn" onclick="toggleCurrencyDisplay()" id="toggleCurrencyBtn" style="width: auto; padding: 8px 15px; display: none;">
                    üí± Tampilkan IDR
                </button>
            </div>
        </div>
        <div id="tradesList">
            <p style="text-align: center; color: var(--gray); padding: 20px;">
                Belum ada trading. Tambahkan trading pertama Anda!
            </p>
        </div>
    </div>
</div>

<div class="footer">
    <p>Trading Journal ¬© 2023 | Data tersimpan di browser Anda</p>
</div>

<script>
// Data Structure
let accounts = {
    "usd-account": {
        id: "usd-account",
        name: "USD Account",
        type: "usd", // 'usd', 'cent', or 'idr'
        capital: 1000,
        trades: [],
        convertToIdr: false,
        createdAt: new Date().toISOString()
    }
};

let currentAccountId = "usd-account";
let currentMonth = new Date();
let displayInIdr = false;
let exchangeRates = {
    USD_IDR: 15000, // 1 USD = 15,000 IDR
    CENT_USD: 100   // 100 CENT = 1 USD
};

// Wallpaper settings
let currentWallpaper = localStorage.getItem('tradingWallpaper') || 'default';

// Initialize
document.addEventListener('DOMContentLoaded', function() {
    loadData();
    setupEventListeners();
    applyWallpaper(currentWallpaper);
    renderAccountTabs();
    renderUI();
    
    // Auto-calculate when profit changes
    document.getElementById('profitAmount').addEventListener('input', function() {
        updateProfitDisplay();
    });
    
    // Show currency info when account type changes
    document.getElementById('newAccountType').addEventListener('change', function() {
        updateCurrencyInfo();
    });
});

// Load from localStorage
function loadData() {
    const savedAccounts = localStorage.getItem('tradingAccountsMulti');
    if (savedAccounts) {
        accounts = JSON.parse(savedAccounts);
    }
    
    const savedRates = localStorage.getItem('exchangeRates');
    if (savedRates) {
        exchangeRates = JSON.parse(savedRates);
    }
    
    const savedDisplay = localStorage.getItem('displayInIdr');
    if (savedDisplay) {
        displayInIdr = JSON.parse(savedDisplay);
    }
}

// Save to localStorage
function saveData() {
    localStorage.setItem('tradingAccountsMulti', JSON.stringify(accounts));
    localStorage.setItem('exchangeRates', JSON.stringify(exchangeRates));
    localStorage.setItem('displayInIdr', JSON.stringify(displayInIdr));
    renderUI();
}

// Setup event listeners
function setupEventListeners() {
    // Set today's date as default
    document.getElementById('tradeDate').valueAsDate = new Date();
    
    // Form submit
    document.getElementById('tradeForm').addEventListener('submit', function(e) {
        e.preventDefault();
        addTrade();
    });
    
    // Initialize conversion toggle
    document.getElementById('displayInIdr').checked = displayInIdr;
}

// Select Profit or Loss
function selectProfitLoss(type) {
    const profitBtn = document.getElementById('profitBtn');
    const lossBtn = document.getElementById('lossBtn');
    const amountLabel = document.getElementById('amountLabel');
    const amountInput = document.getElementById('profitAmount');
    
    // Reset both buttons
    profitBtn.classList.remove('selected');
    lossBtn.classList.remove('selected');
    
    // Set selected button
    if (type === 'profit') {
        profitBtn.classList.add('selected');
        amountLabel.textContent = 'Jumlah Profit';
        amountInput.placeholder = 'Contoh: 280';
        document.getElementById('profitLossType').value = 'profit';
    } else {
        lossBtn.classList.add('selected');
        amountLabel.textContent = 'Jumlah Loss';
        amountInput.placeholder = 'Contoh: 50';
        document.getElementById('profitLossType').value = 'loss';
    }
    
    // Update display
    updateProfitDisplay();
}

// Render account tabs
function renderAccountTabs() {
    const tabsContainer = document.getElementById('accountTabs');
    let tabsHTML = '';
    
    Object.keys(accounts).forEach(accountId => {
        const account = accounts[accountId];
        const isActive = accountId === currentAccountId;
        const typeClass = account.type;
        const typeText = account.type === 'cent' ? 'CENT' : account.type === 'idr' ? 'IDR' : 'USD';
        
        tabsHTML += `
            <div class="account-tab ${typeClass} ${isActive ? 'active' : ''}" 
                 onclick="switchAccount('${accountId}')">
                <span>${account.name}</span>
                <span class="account-badge">${typeText}</span>
            </div>
        `;
    });
    
    tabsHTML += `
        <div class="account-tab" onclick="showAddAccountModal()" style="border: 2px dashed #ccc;">
            ‚ûï Tambah Account
        </div>
    `;
    
    tabsContainer.innerHTML = tabsHTML;
    
    // Update current account badge
    updateAccountBadge();
}

// Switch between accounts
function switchAccount(accountId) {
    currentAccountId = accountId;
    const currentAccount = accounts[currentAccountId];
    displayInIdr = currentAccount.convertToIdr || false;
    
    // Update toggle
    document.getElementById('displayInIdr').checked = displayInIdr;
    document.getElementById('convertToIdr').checked = currentAccount.convertToIdr || false;
    
    renderAccountTabs();
    renderUI();
}

// Update currency info in add account modal
function updateCurrencyInfo() {
    const accountType = document.getElementById('newAccountType').value;
    const currencyInfo = document.getElementById('currencyInfo');
    const conversionSettings = document.getElementById('conversionSettings');
    const newAccountInfo = document.getElementById('newAccountInfo');
    
    let infoText = '';
    if (accountType === 'cent') {
        infoText = '‚ö†Ô∏è Cent Account: Input modal dalam CENT. 100 CENT = 1 USD = 15,000 IDR';
        newAccountInfo.textContent = 'Masukkan dalam CENT (contoh: 1000 CENT = $10)';
        conversionSettings.style.display = 'block';
    } else if (accountType === 'idr') {
        infoText = 'üí∞ Rupiah Account: Semua dalam IDR. Profit ditampilkan sebagai IDR (misal: 5,000 IDR = 5K).';
        newAccountInfo.textContent = 'Masukkan dalam IDR (contoh: 1000000 = 1 juta)';
        conversionSettings.style.display = 'none';
    } else {
        infoText = 'üíµ USD Account: Semua dalam USD.';
        newAccountInfo.textContent = 'Masukkan dalam USD';
        conversionSettings.style.display = 'none';
    }
    
    currencyInfo.innerHTML = infoText;
    currencyInfo.style.display = 'block';
    newAccountInfo.style.display = 'block';
}

// Update account badge
function updateAccountBadge() {
    const currentAccount = accounts[currentAccountId];
    const badge = document.getElementById('currentAccountBadge');
    const centInfo = document.getElementById('centAccountInfo');
    const formCentInfo = document.getElementById('formCentInfo');
    
    let badgeText = '';
    let badgeClass = '';
    
    if (currentAccount.type === 'cent') {
        badgeText = displayInIdr ? 'CENT ‚Üí IDR' : 'CENT ‚Üí USD';
        badgeClass = 'cent-indicator';
        centInfo.style.display = 'block';
        formCentInfo.style.display = 'block';
    } else if (currentAccount.type === 'idr') {
        badgeText = 'IDR';
        badgeClass = 'idr-indicator';
        centInfo.style.display = 'none';
        formCentInfo.style.display = 'none';
    } else {
        badgeText = 'USD';
        badgeClass = 'usd-indicator';
        centInfo.style.display = 'none';
        formCentInfo.style.display = 'none';
    }
    
    badge.textContent = badgeText;
    badge.className = `account-indicator ${badgeClass}`;
}

// Update profit display calculation
function updateProfitDisplay() {
    const profitInput = document.getElementById('profitAmount');
    const profitDisplayInput = document.getElementById('profitDisplay');
    const currencyDisplay = document.getElementById('currencyDisplay');
    const displayCurrencyLabel = document.getElementById('displayCurrencyLabel');
    const profitInfo = document.getElementById('profitInfo');
    const profitLossType = document.getElementById('profitLossType').value;
    
    const currentAccount = accounts[currentAccountId];
    const amount = parseFloat(profitInput.value);
    
    // Update currency display and info
    if (currentAccount.type === 'cent') {
        currencyDisplay.textContent = 'CENT';
        profitInfo.style.display = 'block';
    } else if (currentAccount.type === 'idr') {
        currencyDisplay.textContent = 'IDR';
        profitInfo.style.display = 'none';
    } else {
        currencyDisplay.textContent = 'USD';
        profitInfo.style.display = 'none';
    }
    
    if (!isNaN(amount) && amount > 0) {
        // Determine if this is profit or loss
        const isLoss = profitLossType === 'loss';
        
        let displayText = '';
        
        if (currentAccount.type === 'cent') {
            if (displayInIdr) {
                // CENT ‚Üí IDR (100 CENT = 1 USD = 15,000 IDR)
                const amountUSD = amount / exchangeRates.CENT_USD;
                const amountIDR = amountUSD * exchangeRates.USD_IDR;
                const finalAmount = isLoss ? -amountIDR : amountIDR;
                displayText = isLoss ? `-${formatIDR(amountIDR)}` : formatIDR(amountIDR);
                displayCurrencyLabel.textContent = 'IDR';
            } else {
                // CENT ‚Üí USD (100 CENT = 1 USD)
                const amountUSD = amount / exchangeRates.CENT_USD;
                const finalAmount = isLoss ? -amountUSD : amountUSD;
                displayText = isLoss ? `-$${amountUSD.toFixed(2)}` : `$${amountUSD.toFixed(2)}`;
                displayCurrencyLabel.textContent = 'USD';
            }
        } else if (currentAccount.type === 'idr') {
            const finalAmount = isLoss ? -amount : amount;
            displayText = isLoss ? `-${formatIDR(amount)}` : formatIDR(amount);
            displayCurrencyLabel.textContent = 'IDR';
        } else {
            if (displayInIdr) {
                // USD ‚Üí IDR
                const amountIDR = amount * exchangeRates.USD_IDR;
                const finalAmount = isLoss ? -amountIDR : amountIDR;
                displayText = isLoss ? `-${formatIDR(amountIDR)}` : formatIDR(amountIDR);
                displayCurrencyLabel.textContent = 'IDR';
            } else {
                const finalAmount = isLoss ? -amount : amount;
                displayText = isLoss ? `-$${amount.toFixed(2)}` : `$${amount.toFixed(2)}`;
                displayCurrencyLabel.textContent = 'USD';
            }
        }
        
        profitDisplayInput.value = displayText;
    } else {
        profitDisplayInput.value = '';
    }
}

// Modal functions
function showCapitalModal() {
    const currentAccount = accounts[currentAccountId];
    const capitalInput = document.getElementById('newCapital');
    const capitalLabel = document.getElementById('capitalLabel');
    const capitalInfo = document.getElementById('capitalInfo');
    
    // Set value based on account type
    if (currentAccount.type === 'cent') {
        // Cent account: store in CENT
        capitalInput.value = currentAccount.capital;
        capitalLabel.textContent = 'Modal (dalam CENT)';
        capitalInfo.textContent = `100 CENT = 1 USD = ${exchangeRates.USD_IDR.toLocaleString('id-ID')} IDR`;
        capitalInfo.style.display = 'block';
    } else if (currentAccount.type === 'idr') {
        // IDR account
        capitalInput.value = currentAccount.capital;
        capitalLabel.textContent = 'Modal (dalam IDR)';
        capitalInfo.textContent = `${exchangeRates.USD_IDR.toLocaleString('id-ID')} IDR = 1 USD`;
        capitalInfo.style.display = 'block';
    } else {
        // USD account
        capitalInput.value = currentAccount.capital;
        capitalLabel.textContent = 'Modal (dalam USD)';
        capitalInfo.style.display = 'none';
    }
    
    document.getElementById('capitalModal').style.display = 'flex';
}

function closeCapitalModal() {
    document.getElementById('capitalModal').style.display = 'none';
}

function updateInitialCapital() {
    const capitalInput = document.getElementById('newCapital');
    const currentAccount = accounts[currentAccountId];
    const capital = parseFloat(capitalInput.value);
    
    if (isNaN(capital) || capital < 0) {
        alert('Masukkan jumlah modal yang valid');
        return;
    }
    
    // Store as-is (CENT for cent account, IDR for idr account, USD for usd account)
    accounts[currentAccountId].capital = capital;
    
    closeCapitalModal();
    saveData();
    
    // Show confirmation message
    let message = '';
    if (currentAccount.type === 'cent') {
        const usdValue = capital / exchangeRates.CENT_USD;
        const idrValue = usdValue * exchangeRates.USD_IDR;
        message = `Modal berhasil diupdate menjadi ${capital.toLocaleString('id-ID')} CENT\n`;
        message += `($${usdValue.toFixed(2)} atau ${formatIDR(idrValue)})`;
    } else if (currentAccount.type === 'idr') {
        const usdValue = capital / exchangeRates.USD_IDR;
        message = `Modal berhasil diupdate menjadi ${formatIDR(capital)}\n`;
        message += `($${usdValue.toFixed(2)} USD)`;
    } else {
        const idrValue = capital * exchangeRates.USD_IDR;
        message = `Modal berhasil diupdate menjadi $${capital.toFixed(2)}\n`;
        message += `(${formatIDR(idrValue)})`;
    }
    
    alert(message);
}

function showAddAccountModal() {
    document.getElementById('newAccountName').value = '';
    document.getElementById('newAccountCapital').value = '';
    document.getElementById('newAccountType').value = 'usd';
    updateCurrencyInfo();
    document.getElementById('addAccountModal').style.display = 'flex';
}

function closeAddAccountModal() {
    document.getElementById('addAccountModal').style.display = 'none';
}

function addNewAccount() {
    const nameInput = document.getElementById('newAccountName');
    const typeInput = document.getElementById('newAccountType');
    const capitalInput = document.getElementById('newAccountCapital');
    const convertToIdr = document.getElementById('convertToIdr').checked;
    
    const name = nameInput.value.trim();
    const type = typeInput.value;
    const capital = parseFloat(capitalInput.value);
    
    if (!name) {
        alert('Masukkan nama account');
        return;
    }
    
    if (isNaN(capital) || capital < 0) {
        alert('Masukkan jumlah modal yang valid');
        return;
    }
    
    // Create unique ID
    const accountId = `${type}-${Date.now()}`;
    
    // Add new account
    accounts[accountId] = {
        id: accountId,
        name: name,
        type: type,
        capital: capital, // Store as-is based on type
        trades: [],
        convertToIdr: type === 'cent' ? convertToIdr : false,
        createdAt: new Date().toISOString()
    };
    
    // Switch to new account
    currentAccountId = accountId;
    displayInIdr = convertToIdr;
    
    // Clear form and close modal
    nameInput.value = '';
    capitalInput.value = '';
    closeAddAccountModal();
    
    // Save and render
    saveData();
    renderAccountTabs();
    renderUI();
    
    // Show confirmation
    let confirmMsg = `Account "${name}" berhasil ditambahkan!\n`;
    if (type === 'cent') {
        const usdValue = capital / exchangeRates.CENT_USD;
        const idrValue = usdValue * exchangeRates.USD_IDR;
        confirmMsg += `Modal: ${capital.toLocaleString('id-ID')} CENT ($${usdValue.toFixed(2)} atau ${formatIDR(idrValue)})`;
    } else if (type === 'idr') {
        const usdValue = capital / exchangeRates.USD_IDR;
        confirmMsg += `Modal: ${formatIDR(capital)} ($${usdValue.toFixed(2)} USD)`;
    } else {
        const idrValue = capital * exchangeRates.USD_IDR;
        confirmMsg += `Modal: $${capital.toFixed(2)} (${formatIDR(idrValue)})`;
    }
    
    alert(confirmMsg);
}

// Wallpaper functions - SIMPLE VERSION
function showWallpaperModal() {
    document.getElementById('wallpaperModal').style.display = 'flex';
}

function closeWallpaperModal() {
    document.getElementById('wallpaperModal').style.display = 'none';
}

function setWallpaper(type) {
    const body = document.body;
    
    switch(type) {
        case 'gradient1':
            body.style.backgroundImage = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
            break;
        case 'gradient2':
            body.style.backgroundImage = 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)';
            break;
        case 'gradient3':
            body.style.backgroundImage = 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)';
            break;
        case 'gradient4':
            body.style.backgroundImage = 'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)';
            break;
        case 'gradient5':
            body.style.backgroundImage = 'linear-gradient(135deg, #fa709a 0%, #fee140 100%)';
            break;
        default:
            body.style.backgroundImage = 'none';
            body.style.backgroundColor = '#f6f7f8';
    }
    
    currentWallpaper = type;
    localStorage.setItem('tradingWallpaper', type);
    closeWallpaperModal();
}

function applyWallpaper(type) {
    setWallpaper(type);
}

function clearWallpaper() {
    document.body.style.backgroundImage = 'none';
    document.body.style.backgroundColor = '#f6f7f8';
    currentWallpaper = 'default';
    localStorage.setItem('tradingWallpaper', 'default');
    closeWallpaperModal();
}

// Handle wallpaper upload
document.getElementById('wallpaperUpload').addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            document.body.style.backgroundImage = `url(${e.target.result})`;
            currentWallpaper = 'custom';
            localStorage.setItem('tradingWallpaper', 'custom');
            localStorage.setItem('customWallpaper', e.target.result);
            closeWallpaperModal();
        };
        reader.readAsDataURL(file);
    }
});

// Load custom wallpaper if exists
window.addEventListener('load', function() {
    const customWallpaper = localStorage.getItem('customWallpaper');
    if (customWallpaper && currentWallpaper === 'custom') {
        document.body.style.backgroundImage = `url(${customWallpaper})`;
    }
});

// Toggle display currency
function toggleDisplayCurrency() {
    const currentAccount = accounts[currentAccountId];
    
    if (currentAccount.type === 'idr') {
        // IDR account always shows IDR
        displayInIdr = true;
        document.getElementById('displayInIdr').checked = true;
        document.getElementById('displayInIdr').disabled = true;
        document.getElementById('formConversionSettings').style.display = 'none';
    } else {
        displayInIdr = document.getElementById('displayInIdr').checked;
        document.getElementById('formConversionSettings').style.display = 'block';
    }
    
    saveData();
    updateProfitDisplay();
    renderUI();
}

// Toggle currency display button
function toggleCurrencyDisplay() {
    const btn = document.getElementById('toggleCurrencyBtn');
    const currentAccount = accounts[currentAccountId];
    
    if (currentAccount.type === 'idr') {
        alert('Account IDR hanya menampilkan dalam IDR');
        return;
    }
    
    displayInIdr = !displayInIdr;
    document.getElementById('displayInIdr').checked = displayInIdr;
    btn.textContent = displayInIdr ? 'üíµ Tampilkan USD' : 'üí± Tampilkan IDR';
    
    saveData();
    updateProfitDisplay();
    renderUI();
}

// Add new trade
function addTrade() {
    const currentAccount = accounts[currentAccountId];
    
    // Get form values
    const profitInput = document.getElementById('profitAmount');
    const profitLossType = document.getElementById('profitLossType').value;
    const amount = parseFloat(profitInput.value);
    
    if (isNaN(amount) || amount <= 0) {
        alert('Masukkan jumlah yang valid (lebih dari 0)');
        return;
    }
    
    // Determine if this is profit or loss
    const isLoss = profitLossType === 'loss';
    
    // Calculate amount based on account type
    let profitUSD = 0;
    let profitIDR = 0;
    let originalAmount = amount;
    
    if (currentAccount.type === 'cent') {
        // Convert cent to USD (100 CENT = 1 USD)
        profitUSD = amount / exchangeRates.CENT_USD;
        profitIDR = profitUSD * exchangeRates.USD_IDR;
    } else if (currentAccount.type === 'idr') {
        // IDR directly
        profitIDR = amount;
        profitUSD = profitIDR / exchangeRates.USD_IDR;
    } else {
        // USD directly
        profitUSD = amount;
        profitIDR = profitUSD * exchangeRates.USD_IDR;
    }
    
    // Apply negative if it's a loss
    if (isLoss) {
        profitUSD = -profitUSD;
        profitIDR = -profitIDR;
        originalAmount = -originalAmount;
    }
    
    const trade = {
        id: Date.now(),
        date: document.getElementById('tradeDate').value,
        pair: document.getElementById('pair').value.trim().toUpperCase(),
        direction: document.getElementById('direction').value,
        profitOriginal: parseFloat(originalAmount.toFixed(2)), // Profit dalam currency asli (+ untuk profit, - untuk loss)
        profitUSD: parseFloat(profitUSD.toFixed(2)), // Profit dalam USD (+ untuk profit, - untuk loss)
        profitIDR: parseFloat(profitIDR.toFixed(2)), // Profit dalam IDR (+ untuk profit, - untuk loss)
        currency: currentAccount.type === 'cent' ? 'CENT' : 
                 currentAccount.type === 'idr' ? 'IDR' : 'USD',
        accountType: currentAccount.type,
        type: profitLossType, // 'profit' or 'loss'
        notes: document.getElementById('notes').value.trim()
    };
    
    // Calculate percentage based on account capital
    let capitalUSD = 0;
    if (currentAccount.type === 'cent') {
        // Capital in CENT, convert to USD
        capitalUSD = currentAccount.capital / exchangeRates.CENT_USD;
    } else if (currentAccount.type === 'idr') {
        // Capital in IDR, convert to USD
        capitalUSD = currentAccount.capital / exchangeRates.USD_IDR;
    } else {
        // Capital in USD
        capitalUSD = currentAccount.capital;
    }
    
    trade.percent = capitalUSD > 0 ? (trade.profitUSD / capitalUSD * 100).toFixed(2) : 0;
    
    // Add to account's trades
    currentAccount.trades.unshift(trade);
    
    // Save and reset form
    saveData();
    document.getElementById('tradeForm').reset();
    document.getElementById('tradeDate').valueAsDate = new Date();
    document.getElementById('profitDisplay').value = '';
    
    // Reset profit/loss selection
    document.getElementById('profitBtn').classList.add('selected');
    document.getElementById('lossBtn').classList.remove('selected');
    document.getElementById('profitLossType').value = 'profit';
    document.getElementById('amountLabel').textContent = 'Jumlah Profit';
    document.getElementById('profitAmount').placeholder = 'Contoh: 280';
    
    // Show notification
    const profitText = isLoss ? 'LOSS' : 'PROFIT';
    const profitDisplay = displayInIdr || currentAccount.type === 'idr' ? 
        formatIDR(trade.profitIDR) : `$${Math.abs(trade.profitUSD).toFixed(2)}`;
    const sign = isLoss ? '-' : '+';
    
    alert(`‚úÖ Trading ${profitText} disimpan!\n\nüí∞ Amount: ${sign}${profitDisplay}\nüìä % dari modal: ${sign}${Math.abs(trade.percent)}%\nüìÖ Tanggal: ${formatDate(trade.date)}`);
}

// Delete trade
function deleteTrade(id) {
    if (confirm('Hapus trading ini?')) {
        const currentAccount = accounts[currentAccountId];
        currentAccount.trades = currentAccount.trades.filter(trade => trade.id !== id);
        saveData();
    }
}

// Update balance display
function updateBalanceDisplay() {
    const currentAccount = accounts[currentAccountId];
    
    // Calculate totals in USD
    let totalProfitUSD = 0;
    let totalProfitIDR = 0;
    let currentBalanceUSD = 0;
    let currentBalanceIDR = 0;
    
    // Calculate total profit (positive and negative)
    totalProfitUSD = currentAccount.trades.reduce((sum, trade) => sum + trade.profitUSD, 0);
    totalProfitIDR = currentAccount.trades.reduce((sum, trade) => sum + trade.profitIDR, 0);
    
    // Calculate current balance based on account type
    if (currentAccount.type === 'cent') {
        // Capital in CENT, convert to USD and IDR
        const capitalUSD = currentAccount.capital / exchangeRates.CENT_USD;
        const capitalIDR = capitalUSD * exchangeRates.USD_IDR;
        currentBalanceUSD = capitalUSD + totalProfitUSD;
        currentBalanceIDR = capitalIDR + totalProfitIDR;
    } else if (currentAccount.type === 'idr') {
        // Capital in IDR
        const capitalUSD = currentAccount.capital / exchangeRates.USD_IDR;
        currentBalanceIDR = currentAccount.capital + totalProfitIDR;
        currentBalanceUSD = capitalUSD + totalProfitUSD;
    } else {
        // Capital in USD
        const capitalIDR = currentAccount.capital * exchangeRates.USD_IDR;
        currentBalanceUSD = currentAccount.capital + totalProfitUSD;
        currentBalanceIDR = capitalIDR + totalProfitIDR;
    }
    
    // Calculate growth percentage
    let capitalUSD = 0;
    if (currentAccount.type === 'cent') {
        capitalUSD = currentAccount.capital / exchangeRates.CENT_USD;
    } else if (currentAccount.type === 'idr') {
        capitalUSD = currentAccount.capital / exchangeRates.USD_IDR;
    } else {
        capitalUSD = currentAccount.capital;
    }
    
    const growthPercent = capitalUSD > 0 ? (totalProfitUSD / capitalUSD * 100) : 0;
    
    // Update displays based on display setting
    const toggleBtn = document.getElementById('toggleCurrencyBtn');
    
    if (displayInIdr || currentAccount.type === 'idr') {
        // Display in IDR
        document.getElementById('currentBalance').textContent = formatIDR(currentBalanceIDR);
        
        if (currentAccount.type === 'cent') {
            const capitalIDR = (currentAccount.capital / exchangeRates.CENT_USD) * exchangeRates.USD_IDR;
            document.getElementById('initialCapitalDisplay').textContent = formatIDR(capitalIDR);
        } else if (currentAccount.type === 'idr') {
            document.getElementById('initialCapitalDisplay').textContent = formatIDR(currentAccount.capital);
        } else {
            const capitalIDR = currentAccount.capital * exchangeRates.USD_IDR;
            document.getElementById('initialCapitalDisplay').textContent = formatIDR(capitalIDR);
        }
        
        const sign = totalProfitIDR >= 0 ? '+' : '';
        document.getElementById('totalProfitDisplay').textContent = `${sign}${formatIDR(totalProfitIDR)}`;
        toggleBtn.textContent = 'üíµ Tampilkan USD';
        toggleBtn.style.display = currentAccount.type !== 'idr' ? 'inline-block' : 'none';
    } else {
        // Display in USD
        document.getElementById('currentBalance').textContent = `$${formatNumber(currentBalanceUSD)}`;
        
        if (currentAccount.type === 'cent') {
            const capitalUSD = currentAccount.capital / exchangeRates.CENT_USD;
            document.getElementById('initialCapitalDisplay').textContent = `$${formatNumber(capitalUSD)}`;
        } else if (currentAccount.type === 'idr') {
            const capitalUSD = currentAccount.capital / exchangeRates.USD_IDR;
            document.getElementById('initialCapitalDisplay').textContent = `$${formatNumber(capitalUSD)}`;
        } else {
            document.getElementById('initialCapitalDisplay').textContent = `$${formatNumber(currentAccount.capital)}`;
        }
        
        const sign = totalProfitUSD >= 0 ? '+' : '';
        document.getElementById('totalProfitDisplay').textContent = `${sign}$${formatNumber(totalProfitUSD)}`;
        toggleBtn.textContent = 'üí± Tampilkan IDR';
        toggleBtn.style.display = currentAccount.type !== 'idr' ? 'inline-block' : 'none';
    }
    
    document.getElementById('totalProfitDisplay').style.color = totalProfitUSD >= 0 ? 'var(--green)' : 'var(--red)';
    
    // Update growth badge
    const growthEl = document.getElementById('growthDisplay');
    growthEl.textContent = `${growthPercent >= 0 ? '+' : ''}${Math.abs(growthPercent).toFixed(2)}%`;
    growthEl.className = `growth-badge ${growthPercent >= 0 ? 'growth-positive' : 'growth-negative'}`;
    
    // Update conversion settings visibility
    const formConversionSettings = document.getElementById('formConversionSettings');
    
    if (currentAccount.type === 'idr') {
        formConversionSettings.style.display = 'none';
    } else {
        formConversionSettings.style.display = 'block';
    }
}

// Render calendar
function renderCalendar() {
    const grid = document.getElementById('calendarGrid');
    const monthLabel = document.getElementById('monthLabel');
    const monthSummary = document.getElementById('monthSummary');
    
    // Clear grid
    grid.innerHTML = '';
    
    // Set month label
    const monthNames = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 
                       'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];
    const month = currentMonth.getMonth();
    const year = currentMonth.getFullYear();
    monthLabel.textContent = `${monthNames[month]} ${year}`;
    
    // Get first day of month and days in month
    const firstDay = new Date(year, month, 1).getDay();
    const daysInMonth = new Date(year, month + 1, 0).getDate();
    
    // Get current account trades
    const currentAccount = accounts[currentAccountId];
    const accountTrades = currentAccount.trades || [];
    
    // Calculate monthly PnL
    let monthProfitUSD = 0;
    let monthProfitIDR = 0;
    let monthTradeCount = 0;
    
    // Group trades by date for this month
    const tradesByDate = {};
    accountTrades.forEach(trade => {
        const tradeDate = new Date(trade.date);
        if (tradeDate.getMonth() === month && tradeDate.getFullYear() === year) {
            const dateKey = tradeDate.getDate();
            if (!tradesByDate[dateKey]) {
                tradesByDate[dateKey] = {
                    profitUSD: 0,
                    profitIDR: 0,
                    trades: []
                };
            }
            tradesByDate[dateKey].profitUSD += trade.profitUSD;
            tradesByDate[dateKey].profitIDR += trade.profitIDR;
            tradesByDate[dateKey].trades.push(trade);
            monthProfitUSD += trade.profitUSD;
            monthProfitIDR += trade.profitIDR;
            monthTradeCount++;
        }
    });
    
    // Update month summary
    let summaryText = '';
    if (displayInIdr || currentAccount.type === 'idr') {
        const sign = monthProfitIDR >= 0 ? '+' : '';
        summaryText = `Total PnL Bulan Ini: ${sign}${formatIDR(monthProfitIDR)} (${monthTradeCount} trading)`;
    } else {
        const sign = monthProfitUSD >= 0 ? '+' : '';
        summaryText = `Total PnL Bulan Ini: ${sign}$${formatNumber(monthProfitUSD)} (${monthTradeCount} trading)`;
    }
    
    monthSummary.textContent = summaryText;
    monthSummary.style.color = monthProfitUSD >= 0 ? 'var(--green)' : 'var(--red)';
    
    // Add empty cells for first day offset
    for (let i = 0; i < firstDay; i++) {
        grid.innerHTML += `<div class="calendar-cell empty-cell"></div>`;
    }
    
    // Add day cells
    for (let day = 1; day <= daysInMonth; day++) {
        const dateKey = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        const dayData = tradesByDate[day];
        
        let cellClass = 'neutral';
        let profitText = '';
        let tradeCountText = '';
        
        if (dayData) {
            // Determine cell class based on profit
            cellClass = dayData.profitUSD > 0 ? 'positive' : dayData.profitUSD < 0 ? 'negative' : 'neutral';
            
            // Format profit based on display setting
            if (displayInIdr || currentAccount.type === 'idr') {
                const profitSign = dayData.profitIDR >= 0 ? '+' : '';
                profitText = `<div class="pnl-amount">${profitSign}${formatIDR(dayData.profitIDR)}</div>`;
            } else {
                const profitSign = dayData.profitUSD >= 0 ? '+' : '';
                profitText = `<div class="pnl-amount">${profitSign}$${formatNumber(dayData.profitUSD)}</div>`;
            }
            
            // Trade count
            tradeCountText = dayData.trades.length > 0 ? 
                `<div class="trade-count">${dayData.trades.length} trade</div>` : '';
        }
        
        grid.innerHTML += `
            <div class="calendar-cell ${cellClass}" onclick="showDayDetail('${dateKey}')">
                <div class="day-number">${day}</div>
                ${profitText}
                ${tradeCountText}
            </div>
        `;
    }
}

// Show day detail
function showDayDetail(dateKey) {
    const currentAccount = accounts[currentAccountId];
    
    // Filter trades for this date
    const dayTrades = currentAccount.trades.filter(trade => trade.date === dateKey);
    
    if (dayTrades.length === 0) {
        document.getElementById('dayDetailTitle').textContent = `Tidak ada trading pada ${formatDate(dateKey)}`;
        document.getElementById('dayDetailContent').innerHTML = `
            <p style="text-align: center; color: var(--gray); padding: 20px;">
                Tidak ada trading pada tanggal ini.
            </p>
        `;
    } else {
        const totalProfitUSD = dayTrades.reduce((sum, trade) => sum + trade.profitUSD, 0);
        const totalProfitIDR = dayTrades.reduce((sum, trade) => sum + trade.profitIDR, 0);
        document.getElementById('dayDetailTitle').textContent = `Trading ${formatDate(dateKey)}`;
        
        let content = `
            <div style="background: #f8f9fa; padding: 10px; border-radius: 8px; margin-bottom: 15px;">
                <div style="display: flex; justify-content: space-between;">
                    <div>Total Profit/Loss:</div>
                    <div style="font-weight: 600; color: ${totalProfitUSD >= 0 ? 'var(--green)' : 'var(--red)'}">
                        ${displayInIdr || currentAccount.type === 'idr' ? 
                          `${totalProfitIDR >= 0 ? '+' : ''}${formatIDR(totalProfitIDR)}` : 
                          `${totalProfitUSD >= 0 ? '+' : ''}$${formatNumber(totalProfitUSD)}`}
                    </div>
                </div>
                <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                    <div>Jumlah Trading:</div>
                    <div>${dayTrades.length}</div>
                </div>
                <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                    <div>Profit:</div>
                    <div>${dayTrades.filter(t => t.type === 'profit').length}</div>
                </div>
                <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                    <div>Loss:</div>
                    <div>${dayTrades.filter(t => t.type === 'loss').length}</div>
                </div>
            </div>
        `;
        
        // Add each trade
        dayTrades.forEach(trade => {
            const profitColor = trade.profitUSD >= 0 ? 'var(--green)' : 'var(--red)';
            const directionColor = trade.direction === 'BUY' ? 'var(--green)' : 'var(--red)';
            const displayAmount = displayInIdr || currentAccount.type === 'idr' ? 
                formatIDR(trade.profitIDR) : `$${Math.abs(trade.profitUSD).toFixed(2)}`;
            const originalAmount = trade.currency === 'CENT' ? 
                `${Math.abs(trade.profitOriginal).toLocaleString('id-ID')} CENT` : 
                trade.currency === 'IDR' ? formatIDR(Math.abs(trade.profitOriginal)) :
                `$${Math.abs(trade.profitOriginal).toFixed(2)}`;
            
            content += `
                <div style="border: 1px solid #eee; border-radius: 8px; padding: 10px; margin-bottom: 10px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <div>
                            <div style="font-weight: 600; color: ${directionColor}">
                                ${trade.pair} ${trade.direction}
                            </div>
                            <div style="font-size: 0.8rem; color: ${trade.type === 'profit' ? 'var(--green)' : 'var(--red)'};">
                                ${trade.type === 'profit' ? 'üìà PROFIT' : 'üìâ LOSS'}
                            </div>
                        </div>
                        <div style="font-weight: 600; color: ${profitColor}">
                            ${trade.profitUSD >= 0 ? '+' : '-'}${displayAmount}
                        </div>
                    </div>
                    <div style="font-size: 0.9rem; color: var(--gray);">
                        ${originalAmount} ‚Ä¢ ${trade.profitUSD >= 0 ? '+' : '-'}${Math.abs(trade.percent)}% dari modal
                        <span class="account-indicator ${trade.accountType === 'cent' ? 'cent-indicator' : 
                            trade.accountType === 'idr' ? 'idr-indicator' : 'usd-indicator'}" style="margin-left: 5px;">
                            ${trade.accountType === 'cent' ? 'CENT' : 
                             trade.accountType === 'idr' ? 'IDR' : 'USD'}
                        </span>
                    </div>
                    ${trade.notes ? `<div style="font-size: 0.9rem; margin-top: 5px; font-style: italic;">"${trade.notes}"</div>` : ''}
                </div>
            `;
        });
        
        document.getElementById('dayDetailContent').innerHTML = content;
    }
    
    document.getElementById('dayDetailModal').style.display = 'flex';
}

function closeDayDetailModal() {
    document.getElementById('dayDetailModal').style.display = 'none';
}

// Change month
function changeMonth(step) {
    currentMonth.setMonth(currentMonth.getMonth() + step);
    renderCalendar();
}

// Render statistics
function renderStatistics() {
    const currentAccount = accounts[currentAccountId];
    const accountTrades = currentAccount.trades || [];
    
    if (accountTrades.length === 0) {
        document.getElementById('statMaxProfit').textContent = displayInIdr || currentAccount.type === 'idr' ? 'IDR 0' : '$0.00';
        document.getElementById('statMaxProfitDate').textContent = '-';
        document.getElementById('statMaxLoss').textContent = displayInIdr || currentAccount.type === 'idr' ? 'IDR 0' : '$0.00';
        document.getElementById('statMaxLossDate').textContent = '-';
        document.getElementById('statTotalTrades').textContent = '0';
        document.getElementById('statWinRate').textContent = '0%';
        return;
    }
    
    // Calculate statistics
    const winningTrades = accountTrades.filter(trade => trade.profitUSD > 0);
    const losingTrades = accountTrades.filter(trade => trade.profitUSD < 0);
    const winRate = accountTrades.length > 0 ? (winningTrades.length / accountTrades.length * 100).toFixed(1) : 0;
    
    // Find max profit
    let maxProfitUSD = 0;
    let maxProfitIDR = 0;
    let maxProfitDate = '';
    if (winningTrades.length > 0) {
        const maxProfitTrade = winningTrades.reduce((max, trade) => trade.profitUSD > max.profitUSD ? trade : max);
        maxProfitUSD = maxProfitTrade.profitUSD;
        maxProfitIDR = maxProfitTrade.profitIDR;
        maxProfitDate = formatDate(maxProfitTrade.date);
    }
    
    // Find max loss
    let maxLossUSD = 0;
    let maxLossIDR = 0;
    let maxLossDate = '';
    if (losingTrades.length > 0) {
        const maxLossTrade = losingTrades.reduce((min, trade) => trade.profitUSD < min.profitUSD ? trade : min);
        maxLossUSD = Math.abs(maxLossTrade.profitUSD);
        maxLossIDR = Math.abs(maxLossTrade.profitIDR);
        maxLossDate = formatDate(maxLossTrade.date);
    }
    
    // Update display based on currency setting
    if (displayInIdr || currentAccount.type === 'idr') {
        document.getElementById('statMaxProfit').textContent = `+${formatIDR(maxProfitIDR)}`;
        document.getElementById('statMaxLoss').textContent = `-${formatIDR(maxLossIDR)}`;
    } else {
        document.getElementById('statMaxProfit').textContent = `+$${formatNumber(maxProfitUSD)}`;
        document.getElementById('statMaxLoss').textContent = `-$${formatNumber(maxLossUSD)}`;
    }
    
    document.getElementById('statMaxProfitDate').textContent = maxProfitDate || '-';
    document.getElementById('statMaxLossDate').textContent = maxLossDate || '-';
    document.getElementById('statTotalTrades').textContent = accountTrades.length;
    document.getElementById('statWinRate').textContent = `${winRate}%`;
}

// Render trades list
function renderTradesList() {
    const container = document.getElementById('tradesList');
    const currentAccount = accounts[currentAccountId];
    const accountTrades = currentAccount.trades || [];
    
    if (accountTrades.length === 0) {
        container.innerHTML = `
            <p style="text-align: center; color: var(--gray); padding: 20px;">
                Belum ada trading di account ini. Tambahkan trading pertama Anda!
            </p>
        `;
        return;
    }
    
    let tableHTML = `
        <table class="trades-table">
            <thead>
                <tr>
                    <th>Tanggal</th>
                    <th>Pair</th>
                    <th>Direction</th>
                    <th>Tipe</th>
                    <th>Profit/Loss</th>
                    <th>%</th>
                    <th>Aksi</th>
                </tr>
            </thead>
            <tbody>
    `;
    
    accountTrades.forEach(trade => {
        const profitClass = trade.profitUSD > 0 ? 'trade-positive' : 'trade-negative';
        const directionClass = trade.direction === 'BUY' ? 'trade-direction-buy' : 'trade-direction-sell';
        const typeClass = trade.type === 'profit' ? 'trade-positive' : 'trade-negative';
        const profitSign = trade.profitUSD >= 0 ? '+' : '-';
        
        // Determine display amount
        let displayAmount = '';
        if (displayInIdr || currentAccount.type === 'idr') {
            displayAmount = `${profitSign}${formatIDR(Math.abs(trade.profitIDR))}`;
        } else {
            displayAmount = `${profitSign}$${formatNumber(Math.abs(trade.profitUSD))}`;
        }
        
        // Determine original amount display
        let originalAmount = '';
        if (trade.currency === 'CENT') {
            originalAmount = `${Math.abs(trade.profitOriginal).toLocaleString('id-ID')} CENT`;
        } else if (trade.currency === 'IDR') {
            originalAmount = formatIDR(Math.abs(trade.profitOriginal));
        } else {
            originalAmount = `$${Math.abs(trade.profitOriginal).toFixed(2)}`;
        }
        
        tableHTML += `
            <tr>
                <td>${formatDate(trade.date)}</td>
                <td>${trade.pair}</td>
                <td class="${directionClass}">${trade.direction}</td>
                <td class="${typeClass}">
                    ${trade.type === 'profit' ? 'üìà Profit' : 'üìâ Loss'}
                </td>
                <td class="${profitClass}">
                    ${displayAmount}
                    <div style="font-size: 0.8rem; color: var(--gray);">
                        ${originalAmount}
                    </div>
                </td>
                <td style="color: ${trade.profitUSD >= 0 ? 'var(--green)' : 'var(--red)'}">
                    ${profitSign}${Math.abs(trade.percent)}%
                </td>
                <td>
                    <button class="delete-btn" onclick="deleteTrade(${trade.id})" title="Hapus">
                        üóëÔ∏è
                    </button>
                </td>
            </tr>
        `;
    });
    
    tableHTML += `</tbody></table>`;
    container.innerHTML = tableHTML;
}

// Render all UI
function renderUI() {
    updateAccountBadge();
    updateBalanceDisplay();
    updateProfitDisplay();
    renderCalendar();
    renderStatistics();
    renderTradesList();
    updateExchangeRateInfo();
}

// Helper functions
function formatDate(dateString) {
    const date = new Date(dateString);
    return date.toLocaleDateString('id-ID', {
        day: '2-digit',
        month: 'short',
        year: 'numeric'
    });
}

function formatNumber(num) {
    if (Math.abs(num) >= 1000) {
        return (Math.abs(num) / 1000).toFixed(1) + 'K';
    }
    return Math.abs(num).toFixed(2);
}

function formatIDR(amount) {
    const absAmount = Math.abs(amount);
    if (absAmount >= 1000000) {
        return 'Rp' + (absAmount / 1000000).toFixed(1) + 'M';
    } else if (absAmount >= 1000) {
        return 'Rp' + (absAmount / 1000).toFixed(1) + 'K';
    }
    return 'Rp' + absAmount.toFixed(0);
}

// Update exchange rate info
function updateExchangeRateInfo() {
    const info = document.getElementById('exchangeRateInfo');
    info.innerHTML = `<strong>Kurs Konversi:</strong> 1 USD = ${exchangeRates.CENT_USD} CENT = ${exchangeRates.USD_IDR.toLocaleString('id-ID')} IDR`;
}

// Export/Import functions
function exportData() {
    const exportData = {
        accounts: accounts,
        currentAccountId: currentAccountId,
        exchangeRates: exchangeRates,
        displayInIdr: displayInIdr,
        exportDate: new Date().toISOString()
    };
    
    const dataStr = JSON.stringify(exportData, null, 2);
    const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
    
    const link = document.createElement('a');
    link.setAttribute('href', dataUri);
    link.setAttribute('download', `trading-accounts-${new Date().toISOString().slice(0,10)}.json`);
    link.click();
}

function importData() {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.json';
    
    input.onchange = function(e) {
        const file = e.target.files[0];
        const reader = new FileReader();
        
        reader.onload = function(e) {
            try {
                const imported = JSON.parse(e.target.result);
                
                if (confirm(`Impor ${Object.keys(imported.accounts).length} account?`)) {
                    accounts = imported.accounts;
                    currentAccountId = imported.currentAccountId || Object.keys(accounts)[0];
                    exchangeRates = imported.exchangeRates || exchangeRates;
                    displayInIdr = imported.displayInIdr || false;
                    saveData();
                    renderAccountTabs();
                    renderUI();
                    alert('Data berhasil diimpor!');
                }
            } catch (error) {
                alert('Gagal membaca file. Pastikan format JSON valid.');
            }
        };
        
        reader.readAsText(file);
    };
    
    input.click();
}

// Clear all data
function clearAllData() {
    if (confirm('Hapus SEMUA data trading di SEMUA account? Tindakan ini tidak dapat dibatalkan.')) {
        // Reset accounts but keep structure
        Object.keys(accounts).forEach(accountId => {
            accounts[accountId].trades = [];
            // Reset capital based on account type
            if (accountId.includes('cent')) {
                accounts[accountId].capital = 1000; // 1000 CENT = $10
            } else if (accountId.includes('idr')) {
                accounts[accountId].capital = 1000000; // 1 juta IDR
            } else {
                accounts[accountId].capital = 1000; // $1000
            }
        });
        
        saveData();
        alert('Semua data trading telah dihapus! Modal direset');
    }
}

// Add export/import buttons
document.addEventListener('DOMContentLoaded', function() {
    const footer = document.querySelector('.footer');
    const buttons = document.createElement('div');
    buttons.style.marginTop = '15px';
    buttons.innerHTML = `
        <button class="btn" onclick="exportData()" style="margin-right: 10px; padding: 8px 15px; width: auto; display: inline-block;">
            üì§ Ekspor Data
        </button>
        <button class="btn" onclick="importData()" style="padding: 8px 15px; width: auto; display: inline-block;">
            üì• Impor Data
        </button>
        <button class="btn btn-danger" onclick="clearAllData()" style="padding: 8px 15px; width: auto; display: inline-block; margin-left: 10px;">
            üóëÔ∏è Hapus Semua
        </button>
    `;
    footer.appendChild(buttons);
    
    // Initialize profit/loss selection
    selectProfitLoss('profit');
});
</script>
</body>
</html>
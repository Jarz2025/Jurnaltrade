<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pro Trader Journal v10.0</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://s3.tradingview.com/tv.js"></script>
    <style>
        /* ========== GLOBAL VARIABLES ========== */
        :root { 
            --bg-color: #0a0a0f; 
            --bg-secondary: #121218;
            --bg-tertiary: #1a1a24;
            --accent-color: #6366f1; 
            --accent-color-2: #8b5cf6; 
            --accent-gradient: linear-gradient(135deg, var(--accent-color), var(--accent-color-2));
            --card-bg: rgba(30, 30, 40, 0.9); 
            --card-border: rgba(255, 255, 255, 0.1);
            --glass-border: 1px solid var(--card-border); 
            --win-color: #10b981; 
            --loss-color: #ef4444; 
            --wd-color: #3b82f6; 
            --running-color: #10b981;
            --floating-color: #ef4444;
            --ai-color: #8b5cf6;
            --text-primary: #ffffff;
            --text-secondary: #d1d5db;
            --text-tertiary: #9ca3af;
            --cent-color: #f59e0b;
            --shadow-lg: 0 25px 70px rgba(0, 0, 0, 0.6);
            --shadow-md: 0 15px 50px rgba(0, 0, 0, 0.4);
            --shadow-sm: 0 8px 30px rgba(0, 0, 0, 0.3);
            --radius-xl: 32px;
            --radius-lg: 24px;
            --radius-md: 18px;
            --radius-sm: 14px;
            --transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.1);
            --blur-bg: backdrop-filter blur(40px);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        html {
            scroll-behavior: smooth;
        }
        
        body { 
            font-family: 'Poppins', sans-serif; 
            background: linear-gradient(135deg, #0a0a0f 0%, #1a1a24 100%); 
            color: var(--text-primary); 
            margin: 0; 
            padding: 20px 20px 180px 20px; 
            min-height: 100vh; 
            overflow-x: hidden;
            line-height: 1.6;
            position: relative;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 10% 20%, rgba(99, 102, 241, 0.15) 0%, transparent 40%),
                radial-gradient(circle at 90% 80%, rgba(139, 92, 246, 0.15) 0%, transparent 40%),
                radial-gradient(circle at 50% 50%, rgba(16, 185, 129, 0.08) 0%, transparent 50%);
            z-index: -3;
            pointer-events: none;
            animation: gradientShift 15s ease infinite alternate;
        }
        
        @keyframes gradientShift {
            0% { filter: hue-rotate(0deg); }
            100% { filter: hue-rotate(30deg); }
        }
        
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                linear-gradient(45deg, 
                    transparent 0%, 
                    rgba(255, 255, 255, 0.02) 50%, 
                    transparent 100%);
            z-index: -2;
            pointer-events: none;
            animation: shimmer 20s linear infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }
        
        .overlay { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: linear-gradient(135deg, rgba(10,10,15,0.95) 0%, rgba(30,30,40,0.98) 100%); 
            z-index: -1; 
            pointer-events: none; 
        }
        
        /* ========== ANIMATIONS ========== */
        @keyframes fadeIn { 
            from { opacity: 0; transform: translateY(30px); } 
            to { opacity: 1; transform: translateY(0); } 
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(80px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            33% { transform: translateY(-15px) rotate(2deg); }
            66% { transform: translateY(-8px) rotate(-2deg); }
        }
        
        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px rgba(99, 102, 241, 0.4); }
            50% { box-shadow: 0 0 40px rgba(99, 102, 241, 0.6); }
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {transform: translateY(0);}
            40% {transform: translateY(-15px);}
            60% {transform: translateY(-7px);}
        }
        
        /* ========== SCROLLBAR ========== */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--accent-gradient);
            border-radius: 12px;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent-color-2);
            box-shadow: 0 0 20px rgba(139, 92, 246, 0.5);
        }
        
        /* ========== CUSTOM SELECTION ========== */
        ::selection {
            background: var(--accent-color);
            color: white;
            text-shadow: none;
        }
        
        /* ========== LOGIN & REGISTER MODALS ========== */
        .auth-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 10, 15, 0.98);
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            z-index: 99999999;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            animation: fadeIn 0.5s ease;
        }
        
        .auth-content {
            background: linear-gradient(145deg, rgba(30, 30, 45, 0.95) 0%, rgba(20, 20, 35, 0.98) 100%);
            border-radius: var(--radius-xl);
            padding: 45px 40px;
            max-width: 480px;
            width: 100%;
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.1);
            box-shadow: var(--shadow-lg), inset 0 1px 0 rgba(255, 255, 255, 0.1);
            text-align: center;
            position: relative;
            overflow: hidden;
            animation: slideUp 0.6s ease 0.2s both;
        }
        
        .auth-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 8px;
            background: var(--accent-gradient);
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        .auth-content::after {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(99, 102, 241, 0.15) 0%, transparent 60%);
            z-index: -1;
            animation: spin 20s linear infinite;
        }
        
        .auth-icon {
            width: 110px;
            height: 110px;
            background: var(--accent-gradient);
            border-radius: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 42px;
            margin: 0 auto 30px;
            box-shadow: 0 25px 60px rgba(99, 102, 241, 0.5);
            animation: float 4s ease-in-out infinite;
            position: relative;
            overflow: hidden;
        }
        
        .auth-icon::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 3s linear infinite;
        }
        
        .auth-title {
            font-size: 38px;
            font-weight: 900;
            margin-bottom: 15px;
            background: var(--accent-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -1px;
            text-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .auth-subtitle {
            color: var(--text-tertiary);
            font-size: 16px;
            margin-bottom: 40px;
            line-height: 1.8;
            max-width: 350px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 22px;
            margin-bottom: 30px;
        }
        
        .auth-input-group {
            position: relative;
        }
        
        .auth-input {
            width: 100%;
            padding: 22px 25px;
            background: rgba(255, 255, 255, 0.08);
            border: 2px solid rgba(255, 255, 255, 0.15);
            border-radius: var(--radius-sm);
            color: white;
            font-size: 16px;
            font-weight: 500;
            outline: none;
            transition: var(--transition);
            backdrop-filter: blur(10px);
        }
        
        .auth-input:focus {
            border-color: var(--accent-color);
            background: rgba(255, 255, 255, 0.12);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.25);
            transform: translateY(-2px);
        }
        
        .auth-input::placeholder {
            color: var(--text-tertiary);
        }
        
        .auth-input-icon {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-tertiary);
            font-size: 18px;
        }
        
        .auth-btn {
            width: 100%;
            padding: 23px;
            background: var(--accent-gradient);
            border: none;
            color: white;
            font-weight: 800;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: var(--transition);
            font-size: 17px;
            margin-top: 15px;
            box-shadow: 0 15px 40px rgba(99, 102, 241, 0.4);
            position: relative;
            overflow: hidden;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }
        
        .auth-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.7s;
        }
        
        .auth-btn:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 20px 50px rgba(99, 102, 241, 0.5);
            letter-spacing: 1px;
        }
        
        .auth-btn:hover::before {
            left: 100%;
        }
        
        .auth-btn:active {
            transform: translateY(-2px) scale(0.98);
        }
        
        .auth-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }
        
        .auth-switch {
            margin-top: 30px;
            font-size: 15px;
            color: var(--text-secondary);
            padding-top: 25px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .auth-switch a {
            color: var(--accent-color);
            text-decoration: none;
            font-weight: 800;
            cursor: pointer;
            margin-left: 8px;
            transition: var(--transition);
            position: relative;
            padding: 5px 10px;
            border-radius: 6px;
        }
        
        .auth-switch a::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 10px;
            width: calc(100% - 20px);
            height: 2px;
            background: var(--accent-gradient);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }
        
        .auth-switch a:hover {
            background: rgba(99, 102, 241, 0.1);
        }
        
        .auth-switch a:hover::after {
            transform: scaleX(1);
        }
        
        .auth-error {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(239, 68, 68, 0.1));
            border: 2px solid rgba(239, 68, 68, 0.4);
            border-radius: var(--radius-sm);
            padding: 20px;
            margin-bottom: 25px;
            font-size: 15px;
            color: var(--loss-color);
            display: none;
            text-align: left;
            animation: slideDown 0.4s ease;
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .auth-success {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(16, 185, 129, 0.1));
            border: 2px solid rgba(16, 185, 129, 0.4);
            border-radius: var(--radius-sm);
            padding: 20px;
            margin-bottom: 25px;
            font-size: 15px;
            color: var(--win-color);
            display: none;
            text-align: left;
            animation: slideDown 0.4s ease;
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .auth-loading {
            display: inline-block;
            width: 24px;
            height: 24px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-right: 12px;
            vertical-align: middle;
        }
        
        /* GitHub Token Section */
        .token-section {
            margin-top: 30px;
            padding: 25px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: var(--radius-md);
            border: 2px solid rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            transition: var(--transition);
        }
        
        .token-section:hover {
            border-color: rgba(255, 255, 255, 0.25);
            transform: translateY(-3px);
            box-shadow: var(--shadow-sm);
        }
        
        .token-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            padding: 18px;
            border-radius: var(--radius-sm);
            transition: var(--transition);
            background: rgba(255, 255, 255, 0.08);
        }
        
        .token-toggle:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: translateY(-3px);
        }
        
        .token-toggle i {
            transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        .token-toggle.expanded i {
            transform: rotate(180deg);
        }
        
        .token-form {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .token-form.expanded {
            max-height: 280px;
            margin-top: 20px;
        }
        
        /* ========== ACCOUNT TYPE SELECTION MODAL ========== */
        .account-type-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 10, 15, 0.98);
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            z-index: 99999999;
            display: none;
            justify-content: center;
            align-items: center;
            padding: 20px;
            animation: fadeIn 0.5s ease;
        }
        
        .account-type-content {
            background: linear-gradient(145deg, rgba(30, 30, 45, 0.95) 0%, rgba(20, 20, 35, 0.98) 100%);
            border-radius: var(--radius-xl);
            padding: 45px 40px;
            max-width: 550px;
            width: 100%;
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.1);
            box-shadow: var(--shadow-lg), inset 0 1px 0 rgba(255, 255, 255, 0.1);
            text-align: center;
            position: relative;
            overflow: hidden;
            animation: slideUp 0.6s ease 0.2s both;
        }
        
        .account-type-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 8px;
            background: var(--accent-gradient);
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        .account-type-icon {
            width: 110px;
            height: 110px;
            background: var(--accent-gradient);
            border-radius: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 42px;
            margin: 0 auto 30px;
            box-shadow: 0 25px 60px rgba(99, 102, 241, 0.5);
            position: relative;
            overflow: hidden;
        }
        
        .account-type-icon::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 3s linear infinite;
        }
        
        .account-type-title {
            font-size: 38px;
            font-weight: 900;
            margin-bottom: 15px;
            background: var(--accent-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -1px;
            text-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .account-type-subtitle {
            color: var(--text-tertiary);
            font-size: 16px;
            margin-bottom: 45px;
            line-height: 1.8;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .account-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 40px;
        }
        
        .account-option {
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-lg);
            padding: 30px 25px;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            text-align: center;
            backdrop-filter: blur(10px);
        }
        
        .account-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--accent-gradient);
            opacity: 0;
            transition: var(--transition);
            z-index: -1;
        }
        
        .account-option:hover {
            transform: translateY(-8px) scale(1.02);
            border-color: rgba(99, 102, 241, 0.5);
            box-shadow: var(--shadow-md);
        }
        
        .account-option:hover::before {
            opacity: 0.1;
        }
        
        .account-option.selected {
            background: linear-gradient(145deg, rgba(99, 102, 241, 0.25), rgba(139, 92, 246, 0.15));
            border-color: var(--accent-color);
            box-shadow: 0 20px 50px rgba(99, 102, 241, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.2);
            transform: translateY(-5px);
        }
        
        .account-option.selected::before {
            opacity: 0.2;
        }
        
        .account-option-icon {
            width: 70px;
            height: 70px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            margin: 0 auto 25px;
            transition: var(--transition);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .account-option.selected .account-option-icon {
            background: var(--accent-gradient);
            border-color: transparent;
            transform: scale(1.15) rotate(5deg);
            box-shadow: 0 15px 35px rgba(99, 102, 241, 0.4);
        }
        
        .account-option-name {
            font-size: 24px;
            font-weight: 900;
            margin-bottom: 12px;
            color: var(--text-primary);
            letter-spacing: -0.5px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        .account-option-desc {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.7;
            margin-bottom: 20px;
        }
        
        .account-option-badge {
            display: inline-block;
            background: linear-gradient(135deg, var(--win-color), #059669);
            color: white;
            font-size: 13px;
            padding: 8px 20px;
            border-radius: 25px;
            font-weight: 800;
            letter-spacing: 1px;
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.3);
        }
        
        .account-type-warning {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.2), rgba(245, 158, 11, 0.1));
            border: 2px solid rgba(245, 158, 11, 0.4);
            border-radius: var(--radius-md);
            padding: 25px;
            margin-top: 30px;
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.8;
            text-align: left;
            backdrop-filter: blur(10px);
        }
        
        .account-type-warning i {
            color: var(--cent-color);
            margin-right: 12px;
            font-size: 18px;
            vertical-align: middle;
        }
        
        .confirm-account-btn {
            width: 100%;
            padding: 23px;
            background: var(--accent-gradient);
            border: none;
            color: white;
            font-weight: 800;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: var(--transition);
            font-size: 17px;
            margin-top: 30px;
            box-shadow: 0 15px 40px rgba(99, 102, 241, 0.4);
            position: relative;
            overflow: hidden;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }
        
        .confirm-account-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.7s;
        }
        
        .confirm-account-btn:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 20px 50px rgba(99, 102, 241, 0.5);
            letter-spacing: 1px;
        }
        
        .confirm-account-btn:hover::before {
            left: 100%;
        }
        
        .confirm-account-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }
        
        /* ========== TUTORIAL MODAL ========== */
        .tutorial-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 10, 15, 0.98);
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            z-index: 99999999;
            display: none;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .tutorial-content {
            background: linear-gradient(145deg, rgba(30, 30, 45, 0.95) 0%, rgba(20, 20, 35, 0.98) 100%);
            border-radius: var(--radius-xl);
            padding: 40px 35px;
            max-width: 600px;
            width: 100%;
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.1);
            box-shadow: var(--shadow-lg), inset 0 1px 0 rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
            animation: slideUp 0.6s ease 0.2s both;
        }
        
        .tutorial-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 8px;
            background: var(--accent-gradient);
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        .tutorial-header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .tutorial-title {
            font-size: 40px;
            font-weight: 900;
            background: var(--accent-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
            letter-spacing: -1px;
            text-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .tutorial-subtitle {
            color: var(--text-tertiary);
            font-size: 16px;
            line-height: 1.8;
        }
        
        .tutorial-step {
            display: none;
            animation: fadeIn 0.6s ease;
        }
        
        .tutorial-step.active {
            display: block;
        }
        
        .step-content {
            margin-bottom: 35px;
        }
        
        .step-icon {
            width: 85px;
            height: 85px;
            background: var(--accent-gradient);
            border-radius: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 34px;
            margin: 0 auto 30px;
            box-shadow: 0 20px 45px rgba(99, 102, 241, 0.4);
            animation: float 4s ease-in-out infinite;
            position: relative;
            overflow: hidden;
        }
        
        .step-icon::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 3s linear infinite;
        }
        
        .step-title {
            font-size: 28px;
            font-weight: 800;
            margin-bottom: 20px;
            color: var(--text-primary);
            text-align: center;
            letter-spacing: -0.5px;
        }
        
        .step-desc {
            color: var(--text-secondary);
            font-size: 16px;
            line-height: 1.8;
            margin-bottom: 30px;
            text-align: center;
            padding: 0 20px;
        }
        
        .step-indicators {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-bottom: 35px;
        }
        
        .step-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.25);
            transition: var(--transition);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .step-indicator:hover {
            background: rgba(255, 255, 255, 0.4);
            transform: scale(1.3);
        }
        
        .step-indicator.active {
            background: var(--accent-color);
            transform: scale(1.5);
            box-shadow: 0 0 15px var(--accent-color);
        }
        
        .step-indicator.active::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.6), transparent);
            animation: shimmer 2s linear infinite;
        }
        
        .tutorial-buttons {
            display: flex;
            gap: 20px;
        }
        
        .tutorial-btn {
            flex: 1;
            padding: 20px;
            border-radius: var(--radius-sm);
            border: none;
            font-weight: 800;
            font-size: 16px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            position: relative;
            overflow: hidden;
        }
        
        .tutorial-btn.skip {
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.1));
            color: var(--text-secondary);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .tutorial-btn.skip:hover {
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.15));
            transform: translateY(-4px);
            border-color: rgba(255, 255, 255, 0.3);
            box-shadow: var(--shadow-sm);
        }
        
        .tutorial-btn.next {
            background: var(--accent-gradient);
            color: white;
            box-shadow: 0 15px 35px rgba(99, 102, 241, 0.4);
        }
        
        .tutorial-btn.next:hover {
            transform: translateY(-5px) scale(1.03);
            box-shadow: 0 20px 45px rgba(99, 102, 241, 0.5);
        }
        
        .tutorial-btn.finish {
            background: linear-gradient(135deg, var(--win-color), #059669);
            color: white;
            box-shadow: 0 15px 35px rgba(16, 185, 129, 0.4);
        }
        
        .tutorial-btn.finish:hover {
            transform: translateY(-5px) scale(1.03);
            box-shadow: 0 20px 45px rgba(16, 185, 129, 0.5);
        }
        
        /* ========== MAIN CONTENT ========== */
        .main-content {
            display: none;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.8s ease, transform 0.8s ease;
        }
        
        .main-content.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }
        
        /* ========== HEADER ========== */
        header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 35px; 
            position: relative; 
            z-index: 10; 
            padding: 20px 0;
            animation: slideDown 0.8s ease 0.3s both;
        }
        
        .header-left {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .account-badge {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.25), rgba(245, 158, 11, 0.15));
            color: var(--cent-color);
            font-size: 13px;
            padding: 8px 20px;
            border-radius: 25px;
            font-weight: 900;
            border: 2px solid rgba(245, 158, 11, 0.4);
            backdrop-filter: blur(20px);
            letter-spacing: 1px;
            box-shadow: 0 8px 25px rgba(245, 158, 11, 0.2);
        }
        
        .account-badge.usd {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.25), rgba(16, 185, 129, 0.15));
            color: var(--win-color);
            border-color: rgba(16, 185, 129, 0.4);
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.2);
        }
        
        .header-text {
            flex: 1;
        }
        
        .header-text small {
            color: var(--text-tertiary);
            font-size: 14px;
            font-weight: 700;
            letter-spacing: 2px;
            text-transform: uppercase;
            display: block;
            margin-bottom: 8px;
            opacity: 0.8;
        }
        
        .header-text h2 {
            margin: 0;
            font-size: 32px;
            font-weight: 900;
            background: var(--accent-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -1px;
            text-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .user-avatar { 
            width: 65px; 
            height: 65px; 
            border-radius: 22px; 
            border: 3px solid var(--accent-color); 
            object-fit: cover; 
            background: var(--bg-tertiary); 
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 15px 40px rgba(99, 102, 241, 0.4);
            position: relative;
            overflow: hidden;
        }
        
        .user-avatar:hover {
            transform: scale(1.1) rotate(5deg);
            border-color: var(--accent-color-2);
            box-shadow: 0 20px 50px rgba(99, 102, 241, 0.5);
        }
        
        .user-avatar:active {
            transform: scale(0.95) rotate(-5deg);
        }
        
        .user-avatar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transform: translateX(-100%);
            transition: transform 0.6s;
        }
        
        .user-avatar:hover::before {
            transform: translateX(100%);
        }
        
        .logout-btn {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(239, 68, 68, 0.1));
            border: 2px solid rgba(239, 68, 68, 0.4);
            color: var(--loss-color);
            border-radius: var(--radius-sm);
            padding: 12px 20px;
            margin-left: 15px;
            font-size: 14px;
            cursor: pointer;
            transition: var(--transition);
            white-space: nowrap;
            font-weight: 800;
            letter-spacing: 1px;
            backdrop-filter: blur(10px);
        }
        
        .logout-btn:hover {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.3), rgba(239, 68, 68, 0.2));
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 12px 30px rgba(239, 68, 68, 0.3);
        }
        
        /* ========== SECTIONS ========== */
        .section { 
            display: none; 
            animation: fadeIn 0.8s ease; 
            position: relative; 
            z-index: 5; 
        }
        
        .section.active { 
            display: block; 
        }
        
        /* ========== CARDS ========== */
        .card { 
            background: linear-gradient(145deg, rgba(30, 30, 45, 0.95), rgba(25, 25, 40, 0.98));
            border-radius: var(--radius-lg); 
            padding: 30px; 
            margin-bottom: 25px; 
            border: 2px solid rgba(255, 255, 255, 0.1); 
            backdrop-filter: blur(30px); 
            -webkit-backdrop-filter: blur(30px);
            box-shadow: var(--shadow-sm), inset 0 1px 0 rgba(255, 255, 255, 0.1);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }
        
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.03), transparent);
            opacity: 0;
            transition: var(--transition);
        }
        
        .card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-md), inset 0 1px 0 rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.2);
        }
        
        .card:hover::before {
            opacity: 1;
        }
        
        /* ========== EQUITY CARD ========== */
        .equity-card {
            background: var(--accent-gradient);
            border-radius: var(--radius-xl);
            padding: 45px 35px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
            color: white;
            box-shadow: 0 30px 70px rgba(99, 102, 241, 0.4);
            border: none;
            transition: var(--transition);
            animation: fadeIn 0.8s ease 0.4s both;
        }
        
        .equity-card.running {
            background: linear-gradient(135deg, var(--win-color), #059669) !important;
            box-shadow: 0 30px 70px rgba(16, 185, 129, 0.4);
        }
        
        .equity-card.floating {
            background: linear-gradient(135deg, var(--loss-color), #dc2626) !important;
            box-shadow: 0 30px 70px rgba(239, 68, 68, 0.4);
        }
        
        .equity-card.mixed {
            background: linear-gradient(135deg, #f59e0b, #d97706) !important;
            box-shadow: 0 30px 70px rgba(245, 158, 11, 0.4);
        }
        
        .equity-card.cent {
            background: linear-gradient(135deg, var(--cent-color), #d97706) !important;
            box-shadow: 0 30px 70px rgba(245, 158, 11, 0.4);
        }
        
        .equity-card::before {
            content: '';
            position: absolute;
            width: 400px;
            height: 400px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            top: -200px;
            right: -150px;
            filter: blur(40px);
            animation: spin 20s linear infinite;
        }
        
        .equity-card::after {
            content: '';
            position: absolute;
            width: 300px;
            height: 300px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 50%;
            bottom: -150px;
            left: -150px;
            filter: blur(40px);
            animation: spin 15s linear infinite reverse;
        }
        
        .equity-content {
            position: relative;
            z-index: 2;
        }
        
        .equity-label {
            font-size: 16px;
            font-weight: 700;
            opacity: 0.95;
            margin-bottom: 15px;
            letter-spacing: 2px;
            text-transform: uppercase;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        .equity-amount {
            font-size: 56px;
            font-weight: 900;
            margin: 20px 0;
            text-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            font-family: 'Poppins', sans-serif;
            letter-spacing: -2px;
            line-height: 1;
        }
        
        .equity-growth {
            font-size: 17px;
            font-weight: 800;
            opacity: 0.95;
            background: rgba(255, 255, 255, 0.25);
            display: inline-block;
            padding: 12px 25px;
            border-radius: 30px;
            margin-top: 15px;
            backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 255, 255, 0.4);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }
        
        .equity-edit {
            position: absolute;
            top: 30px;
            right: 30px;
            background: rgba(255, 255, 255, 0.3);
            width: 55px;
            height: 55px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            z-index: 3;
            backdrop-filter: blur(20px);
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid rgba(255, 255, 255, 0.4);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .equity-edit:hover {
            background: rgba(255, 255, 255, 0.4);
            transform: rotate(15deg) scale(1.15);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
        }
        
        .equity-info {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 20px;
        }
        
        .balance-status {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 10px 20px;
            border-radius: 30px;
            font-size: 13px;
            font-weight: 800;
            backdrop-filter: blur(20px);
            border: 2px solid;
            letter-spacing: 1px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }
        
        .balance-running {
            background: rgba(16, 185, 129, 0.3);
            color: var(--running-color);
            border-color: rgba(16, 185, 129, 0.5);
        }
        
        .balance-floating {
            background: rgba(239, 68, 68, 0.3);
            color: var(--floating-color);
            border-color: rgba(239, 68, 68, 0.5);
        }
        
        .balance-mixed {
            background: rgba(245, 158, 11, 0.3);
            color: #f59e0b;
            border-color: rgba(245, 158, 11, 0.5);
        }
        
        .balance-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
            box-shadow: 0 0 15px;
        }
        
        .dot-running {
            background: var(--running-color);
            box-shadow: 0 0 15px var(--running-color);
            animation: pulse 2s infinite;
        }
        
        .dot-floating {
            background: var(--floating-color);
            box-shadow: 0 0 15px var(--floating-color);
            animation: pulse 2s infinite;
        }
        
        #floating-balance {
            font-size: 16px;
            margin-top: 15px;
            opacity: 0.95;
            font-weight: 700;
            background: rgba(255, 255, 255, 0.2);
            padding: 12px 20px;
            border-radius: var(--radius-md);
            display: inline-block;
            backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .balance-breakdown {
            margin-top: 25px;
            font-size: 14px;
            padding-top: 20px;
            border-top: 2px solid rgba(255, 255, 255, 0.3);
            animation: fadeIn 0.6s ease;
        }
        
        .balance-line {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .balance-line:last-child {
            border-bottom: none;
        }
        
        .balance-negative {
            color: var(--floating-color);
            font-weight: 800;
            text-shadow: 0 0 10px rgba(239, 68, 68, 0.3);
        }
        
        .balance-positive {
            color: var(--running-color);
            font-weight: 800;
            text-shadow: 0 0 10px rgba(16, 185, 129, 0.3);
        }
        
        #active-trades-info {
            font-size: 14px;
            margin-top: 20px;
            opacity: 0.95;
            padding: 15px 20px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: var(--radius-md);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        /* ========== TRADINGVIEW WIDGET ========== */
        .tradingview-widget-container {
            margin: 30px 0;
            border-radius: var(--radius-xl);
            overflow: hidden;
            height: 480px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            box-shadow: var(--shadow-md);
            position: relative;
            animation: fadeIn 0.8s ease 0.5s both;
        }
        
        .tradingview-widget-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.08), rgba(139, 92, 246, 0.08));
            z-index: 1;
            pointer-events: none;
        }
        
        #tradingview_chart {
            height: 100%;
            position: relative;
            z-index: 2;
        }
        
        /* ========== TRADINGVIEW WEB BUTTON ========== */
        .tv-web-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: linear-gradient(145deg, rgba(30, 30, 45, 0.95), rgba(25, 25, 40, 0.98));
            border: 2px solid var(--accent-color);
            color: white;
            padding: 12px 25px;
            border-radius: var(--radius-md);
            font-size: 15px;
            font-weight: 800;
            cursor: pointer;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: var(--transition);
            backdrop-filter: blur(20px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            letter-spacing: 0.5px;
        }
        
        .tv-web-btn:hover {
            background: var(--accent-gradient);
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 15px 40px rgba(99, 102, 241, 0.5);
        }
        
        /* ========== PRICE TICKER ========== */
        .price-ticker {
            display: flex;
            overflow-x: auto;
            gap: 20px;
            padding: 20px 0;
            margin-bottom: 30px;
            animation: fadeIn 0.8s ease 0.6s both;
        }
        
        .price-ticker::-webkit-scrollbar {
            height: 6px;
        }
        
        .ticker-item {
            min-width: 160px;
            padding: 25px;
            background: linear-gradient(145deg, rgba(30, 30, 45, 0.95), rgba(25, 25, 40, 0.98));
            border-radius: var(--radius-lg);
            border: 2px solid rgba(255, 255, 255, 0.1);
            transition: var(--transition);
            flex-shrink: 0;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(20px);
        }
        
        .ticker-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.03), transparent);
            opacity: 0;
            transition: var(--transition);
        }
        
        .ticker-item:hover {
            transform: translateY(-8px) scale(1.03);
            box-shadow: var(--shadow-md);
            border-color: rgba(255, 255, 255, 0.2);
        }
        
        .ticker-item:hover::before {
            opacity: 1;
        }
        
        .ticker-symbol {
            font-size: 14px;
            color: var(--text-tertiary);
            margin-bottom: 10px;
            font-weight: 800;
            letter-spacing: 2px;
            text-transform: uppercase;
        }
        
        .ticker-price {
            font-size: 26px;
            font-weight: 900;
            margin-bottom: 8px;
            letter-spacing: -0.5px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        
        .ticker-change {
            font-size: 14px;
            font-weight: 800;
            letter-spacing: 1px;
            padding: 6px 12px;
            border-radius: 20px;
            display: inline-block;
            backdrop-filter: blur(10px);
            border: 1px solid;
        }
        
        .ticker-change.positive {
            color: var(--win-color);
            background: rgba(16, 185, 129, 0.2);
            border-color: rgba(16, 185, 129, 0.3);
        }
        
        .ticker-change.negative {
            color: var(--loss-color);
            background: rgba(239, 68, 68, 0.2);
            border-color: rgba(239, 68, 68, 0.3);
        }
        
        .price-update {
            animation: fadeIn 0.4s ease;
        }
        
        /* ========== STAT GRID ========== */
        .stat-grid { 
            display: grid; 
            grid-template-columns: repeat(2, 1fr); 
            gap: 22px; 
            margin: 30px 0;
            animation: fadeIn 0.8s ease 0.7s both;
        }
        
        .stat-box { 
            background: linear-gradient(145deg, rgba(30, 30, 45, 0.95), rgba(25, 25, 40, 0.98));
            padding: 30px 20px; 
            border-radius: var(--radius-lg); 
            text-align: center; 
            border: 2px solid rgba(255, 255, 255, 0.1); 
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(20px);
        }
        
        .stat-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.03), transparent);
            opacity: 0;
            transition: var(--transition);
        }
        
        .stat-box:hover {
            transform: translateY(-8px) scale(1.03);
            box-shadow: var(--shadow-md);
            border-color: rgba(255, 255, 255, 0.2);
        }
        
        .stat-box:hover::before {
            opacity: 1;
        }
        
        .label-small { 
            font-size: 14px; 
            color: var(--text-tertiary); 
            text-transform: uppercase; 
            letter-spacing: 2px; 
            display: block; 
            margin-bottom: 15px; 
            font-weight: 800;
        }
        
        .stat-box .label-small {
            font-size: 12px;
            opacity: 0.8;
            margin-bottom: 20px;
        }
        
        .stat-box div:last-child {
            font-size: 32px;
            font-weight: 900;
            margin-top: 10px;
            text-shadow: 0 2px 15px rgba(0, 0, 0, 0.3);
        }
        
        #stat-wr {
            color: var(--win-color);
            font-size: 36px;
        }
        
        #total-trades {
            font-size: 36px;
            background: var(--accent-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        #stat-running {
            color: var(--running-color);
            font-size: 36px;
        }
        
        #stat-floating {
            color: var(--floating-color);
            font-size: 36px;
        }
        
        /* ========== RECENT ACTIVITY ========== */
        #recent-activity {
            font-size: 15px;
            color: var(--text-secondary);
            animation: fadeIn 0.8s ease 0.8s both;
        }
        
        /* ========== TRADE JOURNAL SECTION ========== */
        #trading .card {
            animation: fadeIn 0.8s ease 0.5s both;
        }
        
        .form-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }
        
        select, input[type="text"], input[type="number"], input[type="file"], textarea {
            width: 100%;
            padding: 22px 25px;
            background: rgba(255, 255, 255, 0.08);
            border: 2px solid rgba(255, 255, 255, 0.15);
            border-radius: var(--radius-sm);
            color: var(--text-primary);
            font-size: 16px;
            font-weight: 500;
            outline: none;
            transition: var(--transition);
            font-family: 'Poppins', sans-serif;
            backdrop-filter: blur(10px);
        }
        
        select:focus, input:focus, textarea:focus {
            border-color: var(--accent-color);
            background: rgba(255, 255, 255, 0.12);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.25);
            transform: translateY(-3px);
        }
        
        textarea {
            min-height: 160px;
            resize: vertical;
            line-height: 1.7;
        }
        
        .btn-primary { 
            width: 100%; 
            padding: 23px; 
            background: var(--accent-gradient); 
            border: none; 
            color: white; 
            font-weight: 800; 
            border-radius: var(--radius-sm); 
            cursor: pointer; 
            transition: var(--transition);
            font-size: 17px;
            letter-spacing: 1px;
            margin-top: 15px;
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            box-shadow: 0 15px 40px rgba(99, 102, 241, 0.4);
        }
        
        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.7s;
        }
        
        .btn-primary:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 20px 50px rgba(99, 102, 241, 0.5);
            letter-spacing: 2px;
        }
        
        .btn-primary:hover::before {
            left: 100%;
        }
        
        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }
        
        .current-pnl-input {
            font-size: 16px;
            padding: 22px;
            margin-top: 15px;
            background: rgba(16, 185, 129, 0.2);
            border: 2px solid var(--running-color);
            color: var(--running-color);
            border-radius: var(--radius-sm);
            font-weight: 700;
            backdrop-filter: blur(10px);
        }
        
        .pnl-update-btn {
            background: linear-gradient(135deg, var(--running-color), #059669);
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            padding: 15px 25px;
            font-size: 14px;
            cursor: pointer;
            margin-top: 15px;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            font-weight: 800;
            transition: var(--transition);
            letter-spacing: 1px;
            text-transform: uppercase;
            box-shadow: 0 10px 30px rgba(16, 185, 129, 0.3);
        }
        
        .pnl-update-btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 15px 40px rgba(16, 185, 129, 0.4);
        }
        
        .pnl-update-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }
        
        .timestamp {
            font-size: 13px;
            color: var(--text-tertiary);
            margin-top: 10px;
            display: block;
            font-style: italic;
        }
        
        /* ========== LOT CALCULATOR BUTTON ========== */
        .lot-calculator-btn {
            width: 100%;
            padding: 20px;
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            border: none;
            color: white;
            font-weight: 800;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: var(--transition);
            font-size: 16px;
            margin-top: 20px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            box-shadow: 0 15px 35px rgba(139, 92, 246, 0.4);
            letter-spacing: 0.5px;
            text-transform: uppercase;
            position: relative;
            overflow: hidden;
        }
        
        .lot-calculator-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.7s;
        }
        
        .lot-calculator-btn:hover {
            background: linear-gradient(135deg, #7c3aed, #6d28d9);
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 20px 45px rgba(139, 92, 246, 0.5);
        }
        
        .lot-calculator-btn:hover::before {
            left: 100%;
        }
        
        /* ========== TRADE HISTORY ========== */
        #trade-list {
            animation: fadeIn 0.8s ease 0.6s both;
        }
        
        .history-item { 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            padding: 25px;
            background: linear-gradient(145deg, rgba(30, 30, 45, 0.95), rgba(25, 25, 40, 0.98));
            border-radius: var(--radius-lg);
            margin-bottom: 20px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(20px);
        }
        
        .history-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.03), transparent);
            opacity: 0;
            transition: var(--transition);
        }
        
        .history-item:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-sm);
            border-color: rgba(255, 255, 255, 0.2);
        }
        
        .history-item:hover::before {
            opacity: 1;
        }
        
        .del-btn { 
            color: var(--text-tertiary); 
            cursor: pointer; 
            padding: 12px; 
            font-size: 18px; 
            transition: var(--transition); 
            border-radius: var(--radius-sm);
            margin-left: 12px;
            background: rgba(255, 255, 255, 0.08);
            border: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        .del-btn:hover { 
            color: var(--loss-color); 
            background: rgba(239, 68, 68, 0.15);
            border-color: rgba(239, 68, 68, 0.3);
            transform: rotate(90deg) scale(1.1);
        }
        
        .edit-btn {
            color: var(--text-tertiary);
            cursor: pointer;
            padding: 12px;
            font-size: 18px;
            transition: var(--transition);
            margin-left: 12px;
            border-radius: var(--radius-sm);
            background: rgba(255, 255, 255, 0.08);
            border: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        .edit-btn:hover {
            color: var(--wd-color);
            background: rgba(59, 130, 246, 0.15);
            border-color: rgba(59, 130, 246, 0.3);
            transform: rotate(-15deg) scale(1.1);
        }
        
        /* ========== JOURNAL SECTION ========== */
        .journal-form {
            animation: fadeIn 0.8s ease 0.5s both;
        }
        
        .journal-quick-tips {
            margin-top: 25px;
            padding: 25px;
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.15), rgba(139, 92, 246, 0.05));
            border-radius: var(--radius-lg);
            border: 2px solid rgba(139, 92, 246, 0.3);
            backdrop-filter: blur(20px);
        }
        
        .journal-quick-tips-title {
            font-size: 16px;
            color: var(--ai-color);
            font-weight: 800;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            letter-spacing: 1px;
            text-transform: uppercase;
        }
        
        .journal-quick-tips-list {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.8;
            padding-left: 25px;
        }
        
        .journal-quick-tips-list li {
            margin-bottom: 15px;
            position: relative;
            padding-left: 5px;
        }
        
        .journal-quick-tips-list li::before {
            content: '';
            position: absolute;
            left: -25px;
            color: var(--ai-color);
            font-weight: 900;
            font-size: 16px;
        }
        
        .journal-entry { 
            border-left: 5px solid var(--accent-color); 
            margin-bottom: 25px;
            background: linear-gradient(145deg, rgba(30, 30, 45, 0.95), rgba(25, 25, 40, 0.98));
            border-radius: var(--radius-lg);
            padding: 30px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            animation: fadeIn 0.6s ease;
            backdrop-filter: blur(20px);
        }
        
        .journal-entry::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.03), transparent);
            opacity: 0;
            transition: var(--transition);
        }
        
        .journal-entry:hover {
            transform: translateX(10px);
            box-shadow: var(--shadow-sm);
            border-color: rgba(255, 255, 255, 0.2);
        }
        
        .journal-entry:hover::before {
            opacity: 1;
        }
        
        .journal-category { 
            display: inline-block; 
            padding: 10px 22px; 
            border-radius: 30px; 
            font-size: 12px; 
            font-weight: 900; 
            text-transform: uppercase; 
            margin-bottom: 20px; 
            letter-spacing: 2px;
            backdrop-filter: blur(10px);
            border: 2px solid;
        }
        
        .cat-mistake { 
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.25), rgba(239, 68, 68, 0.15)); 
            color: var(--loss-color); 
            border-color: rgba(239, 68, 68, 0.4);
        }
        
        .cat-lesson { 
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.25), rgba(16, 185, 129, 0.15)); 
            color: var(--win-color); 
            border-color: rgba(16, 185, 129, 0.4);
        }
        
        .cat-analysis { 
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.25), rgba(59, 130, 246, 0.15)); 
            color: var(--wd-color); 
            border-color: rgba(59, 130, 246, 0.4);
        }
        
        .cat-note { 
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.25), rgba(245, 158, 11, 0.15)); 
            color: #f59e0b; 
            border-color: rgba(245, 158, 11, 0.4);
        }
        
        /* ========== SAVING GOALS SECTION ========== */
        #dream-list {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 25px;
            margin-top: 25px;
        }
        
        .dream-item {
            background: linear-gradient(145deg, rgba(30, 30, 45, 0.95), rgba(25, 25, 40, 0.98));
            border-radius: var(--radius-lg);
            overflow: hidden;
            border: 2px solid rgba(255, 255, 255, 0.1);
            transition: var(--transition);
            position: relative;
            animation: fadeIn 0.8s ease 0.6s both;
            backdrop-filter: blur(20px);
        }
        
        .dream-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.03), transparent);
            opacity: 0;
            transition: var(--transition);
        }
        
        .dream-item:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-md);
            border-color: rgba(255, 255, 255, 0.2);
        }
        
        .dream-item:hover::before {
            opacity: 1;
        }
        
        .dream-item img {
            width: 100%;
            height: 180px;
            object-fit: cover;
            border-bottom: 2px solid var(--card-border);
        }
        
        .dream-item-content {
            padding: 25px;
        }
        
        .dream-item h4 {
            font-size: 20px;
            font-weight: 800;
            margin-bottom: 15px;
            color: var(--text-primary);
            letter-spacing: -0.5px;
        }
        
        .dream-item p {
            font-size: 15px;
            color: var(--text-secondary);
            margin-bottom: 20px;
            line-height: 1.7;
        }
        
        .dream-progress {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .dream-progress-bar {
            height: 100%;
            background: var(--accent-gradient);
            border-radius: 4px;
            transition: width 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            overflow: hidden;
        }
        
        .dream-progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s infinite;
        }
        
        /* ========== AI ASSISTANT SECTION ========== */
        #ai .card {
            animation: fadeIn 0.8s ease 0.5s both;
        }
        
        .ai-chat-container {
            height: 550px;
            display: flex;
            flex-direction: column;
            background: linear-gradient(145deg, rgba(30, 30, 45, 0.95), rgba(25, 25, 40, 0.98));
            border-radius: var(--radius-lg);
            overflow: hidden;
            border: 2px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
        }
        
        .ai-chat-header {
            padding: 25px;
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.3), rgba(139, 92, 246, 0.2));
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            gap: 20px;
            position: relative;
            overflow: hidden;
        }
        
        .ai-chat-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            animation: shimmer 3s infinite;
        }
        
        .ai-avatar {
            width: 60px;
            height: 60px;
            background: var(--accent-gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 26px;
            box-shadow: 0 15px 35px rgba(99, 102, 241, 0.4);
            position: relative;
            z-index: 2;
            animation: float 3s ease-in-out infinite;
        }
        
        .ai-header-text {
            position: relative;
            z-index: 2;
            flex: 1;
        }
        
        .ai-header-text h4 {
            margin: 0;
            font-size: 22px;
            font-weight: 900;
            color: white;
            letter-spacing: -0.5px;
        }
        
        .ai-header-text p {
            margin: 8px 0 0 0;
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: 500;
        }
        
        .ai-chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 30px;
            display: flex;
            flex-direction: column;
            gap: 25px;
            background: rgba(0, 0, 0, 0.2);
        }
        
        .message {
            max-width: 85%;
            padding: 20px;
            border-radius: var(--radius-md);
            animation: slideUp 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
        }
        
        .message.user {
            align-self: flex-end;
            background: var(--accent-gradient);
            color: white;
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .message.ai {
            align-self: flex-start;
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.12), rgba(255, 255, 255, 0.08));
            border: 2px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .message-content {
            font-size: 15px;
            line-height: 1.7;
            position: relative;
            z-index: 2;
        }
        
        .message-time {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.5);
            margin-top: 10px;
            text-align: right;
            font-weight: 600;
            position: relative;
            z-index: 2;
        }
        
        .ai-chat-input {
            padding: 25px;
            border-top: 2px solid rgba(255, 255, 255, 0.1);
            background: linear-gradient(145deg, rgba(30, 30, 45, 0.95), rgba(25, 25, 40, 0.98));
            display: flex;
            gap: 20px;
            align-items: flex-end;
        }
        
        .ai-chat-input textarea {
            flex: 1;
            padding: 20px;
            background: rgba(255, 255, 255, 0.08);
            border: 2px solid rgba(255, 255, 255, 0.15);
            border-radius: var(--radius-md);
            color: white;
            font-size: 15px;
            resize: none;
            height: 70px;
            font-family: 'Poppins', sans-serif;
            transition: var(--transition);
            backdrop-filter: blur(10px);
        }
        
        .ai-chat-input textarea:focus {
            border-color: var(--accent-color);
            background: rgba(255, 255, 255, 0.12);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.25);
            transform: translateY(-3px);
        }
        
        .ai-send-btn {
            background: var(--accent-gradient);
            border: none;
            color: white;
            width: 70px;
            height: 70px;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition);
            font-size: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 15px 35px rgba(99, 102, 241, 0.4);
        }
        
        .ai-send-btn:hover {
            transform: translateY(-5px) scale(1.1);
            box-shadow: 0 20px 45px rgba(99, 102, 241, 0.5);
        }
        
        .ai-send-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }
        
        .ai-typing-indicator {
            display: none;
            padding: 15px 20px;
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.12), rgba(255, 255, 255, 0.08));
            border-radius: var(--radius-md);
            border: 2px solid rgba(255, 255, 255, 0.1);
            align-self: flex-start;
            max-width: 200px;
        }
        
        .ai-typing-indicator span {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--accent-color);
            margin: 0 2px;
            animation: bounce 1.4s infinite ease-in-out both;
        }
        
        .ai-typing-indicator span:nth-child(1) { animation-delay: -0.32s; }
        .ai-typing-indicator span:nth-child(2) { animation-delay: -0.16s; }
        
        /* ========== SETTINGS SECTION ========== */
        .checkbox-container {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
            cursor: pointer;
            padding: 20px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: var(--radius-md);
            transition: var(--transition);
            border: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        .checkbox-container:hover {
            background: rgba(255, 255, 255, 0.12);
            border-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-3px);
        }
        
        .checkbox-container input {
            width: auto;
            margin-right: 20px;
            margin-bottom: 0;
            transform: scale(1.4);
            accent-color: var(--accent-color);
        }
        
        /* ========== WITHDRAWAL ACTIONS ========== */
        .wd-actions {
            display: flex;
            gap: 20px;
            margin-top: 30px;
            padding-top: 25px;
            border-top: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        .wd-action-btn {
            flex: 1;
            padding: 20px;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(59, 130, 246, 0.1));
            border: 2px solid rgba(59, 130, 246, 0.3);
            border-radius: var(--radius-md);
            color: var(--wd-color);
            font-weight: 800;
            font-size: 15px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            letter-spacing: 1px;
            backdrop-filter: blur(10px);
            text-transform: uppercase;
        }
        
        .wd-action-btn:hover {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.3), rgba(59, 130, 246, 0.2));
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(59, 130, 246, 0.3);
        }
        
        .wd-action-btn.add {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(16, 185, 129, 0.1));
            border-color: rgba(16, 185, 129, 0.3);
            color: var(--win-color);
        }
        
        .wd-action-btn.add:hover {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.3), rgba(16, 185, 129, 0.2));
            box-shadow: 0 15px 35px rgba(16, 185, 129, 0.3);
        }
        
        /* ========== LOT CALCULATOR MODAL ========== */
        .lot-calculator-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 10, 15, 0.98);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999999;
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            padding: 20px;
            animation: fadeIn 0.5s ease;
        }
        
        .lot-calculator-modal.active {
            display: flex;
        }
        
        .lot-calculator-content {
            background: linear-gradient(145deg, rgba(30, 30, 45, 0.95), rgba(20, 20, 35, 0.98));
            border-radius: var(--radius-xl);
            padding: 40px;
            width: 100%;
            max-width: 550px;
            animation: slideUp 0.6s ease 0.2s both;
            border: 2px solid rgba(255, 255, 255, 0.1);
            box-shadow: var(--shadow-lg), inset 0 1px 0 rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        .lot-calculator-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 8px;
            background: var(--accent-gradient);
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        .lot-calculator-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 35px;
        }
        
        .lot-calculator-title {
            font-size: 32px;
            font-weight: 900;
            background: var(--accent-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -1px;
            text-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .close-lot-btn {
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.1));
            border: 2px solid rgba(255, 255, 255, 0.2);
            color: white;
            width: 55px;
            height: 55px;
            border-radius: var(--radius-md);
            cursor: pointer;
            font-size: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            backdrop-filter: blur(10px);
        }
        
        .close-lot-btn:hover {
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.15));
            transform: rotate(90deg) scale(1.1);
            border-color: rgba(255, 255, 255, 0.3);
        }
        
        .lot-form-group {
            margin-bottom: 30px;
        }
        
        .lot-label {
            font-size: 15px;
            color: var(--text-tertiary);
            margin-bottom: 12px;
            display: block;
            font-weight: 700;
            letter-spacing: 1px;
            text-transform: uppercase;
        }
        
        .lot-input-group {
            position: relative;
            margin-bottom: 25px;
        }
        
        .lot-input {
            width: 100%;
            padding: 22px;
            background: rgba(255, 255, 255, 0.08);
            border: 2px solid rgba(255, 255, 255, 0.15);
            border-radius: var(--radius-sm);
            color: white;
            font-size: 16px;
            outline: none;
            transition: var(--transition);
            font-weight: 500;
            backdrop-filter: blur(10px);
        }
        
        .lot-input:focus {
            border-color: var(--accent-color);
            background: rgba(255, 255, 255, 0.12);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.25);
            transform: translateY(-3px);
        }
        
        .lot-input-unit {
            position: absolute;
            right: 22px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-tertiary);
            font-size: 15px;
            font-weight: 700;
        }
        
        .calculate-btn {
            width: 100%;
            padding: 23px;
            background: var(--accent-gradient);
            border: none;
            color: white;
            font-weight: 800;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: var(--transition);
            font-size: 17px;
            margin-top: 20px;
            box-shadow: 0 15px 40px rgba(99, 102, 241, 0.4);
            position: relative;
            overflow: hidden;
            letter-spacing: 1px;
            text-transform: uppercase;
        }
        
        .calculate-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.7s;
        }
        
        .calculate-btn:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 20px 50px rgba(99, 102, 241, 0.5);
        }
        
        .calculate-btn:hover::before {
            left: 100%;
        }
        
        .calculate-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }
        
        .result-container {
            margin-top: 35px;
            padding: 30px;
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.05));
            border-radius: var(--radius-lg);
            border: 2px solid rgba(255, 255, 255, 0.1);
            animation: fadeIn 0.6s ease;
            backdrop-filter: blur(20px);
        }
        
        .result-title {
            font-size: 22px;
            font-weight: 900;
            margin-bottom: 25px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 15px;
            letter-spacing: -0.5px;
        }
        
        .lot-result {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .lot-result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 22px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-md);
            border: 2px solid rgba(255, 255, 255, 0.08);
            transition: var(--transition);
        }
        
        .lot-result-item:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-3px);
        }
        
        .lot-result-label {
            font-size: 15px;
            color: var(--text-secondary);
            font-weight: 700;
            letter-spacing: 1px;
            text-transform: uppercase;
        }
        
        .lot-result-value {
            font-size: 28px;
            font-weight: 900;
            color: var(--accent-color);
            letter-spacing: -1px;
            text-shadow: 0 2px 15px rgba(99, 102, 241, 0.3);
        }
        
        .lot-recommendation {
            margin-top: 30px;
            padding: 30px;
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(16, 185, 129, 0.1));
            border-radius: var(--radius-lg);
            border: 2px solid rgba(16, 185, 129, 0.3);
            backdrop-filter: blur(20px);
        }
        
        .lot-recommendation-title {
            font-size: 20px;
            font-weight: 900;
            margin-bottom: 20px;
            color: var(--win-color);
            display: flex;
            align-items: center;
            gap: 15px;
            letter-spacing: -0.5px;
        }
        
        .lot-recommendation-text {
            font-size: 16px;
            color: var(--text-secondary);
            line-height: 1.8;
        }
        
        .lot-warning {
            font-size: 14px;
            color: #f59e0b;
            text-align: center;
            margin-top: 25px;
            padding: 20px;
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.15), rgba(245, 158, 11, 0.1));
            border-radius: var(--radius-md);
            border: 2px solid rgba(245, 158, 11, 0.2);
            line-height: 1.8;
            backdrop-filter: blur(10px);
        }
        
        /* ========== RECOMMENDATION POPUP ========== */
        .recommendation-popup {
            position: fixed;
            top: 120px;
            left: 20px;
            right: 20px;
            z-index: 999999;
            background: linear-gradient(145deg, rgba(30, 30, 45, 0.95), rgba(25, 25, 40, 0.98));
            border-radius: var(--radius-xl);
            padding: 30px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            box-shadow: var(--shadow-lg), inset 0 1px 0 rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(40px);
            -webkit-backdrop-filter: blur(40px);
            display: none;
            animation: slideDown 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .recommendation-popup.active {
            display: block;
        }
        
        .recommendation-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .recommendation-icon {
            width: 60px;
            height: 60px;
            background: var(--accent-gradient);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 26px;
            box-shadow: 0 15px 35px rgba(99, 102, 241, 0.4);
        }
        
        .recommendation-title {
            font-size: 24px;
            font-weight: 900;
            color: var(--text-primary);
            flex: 1;
            letter-spacing: -0.5px;
        }
        
        .close-recommendation {
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.1));
            border: 2px solid rgba(255, 255, 255, 0.2);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: var(--radius-md);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            font-size: 20px;
            backdrop-filter: blur(10px);
        }
        
        .close-recommendation:hover {
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.15));
            transform: rotate(90deg) scale(1.1);
            border-color: rgba(255, 255, 255, 0.3);
        }
        
        .recommendation-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }
        
        .recommendation-box {
            padding: 30px;
            border-radius: var(--radius-lg);
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.05));
            border: 2px solid rgba(255, 255, 255, 0.1);
            transition: var(--transition);
            backdrop-filter: blur(20px);
        }
        
        .recommendation-box:hover {
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.12), rgba(255, 255, 255, 0.08));
            transform: translateY(-5px);
            border-color: rgba(255, 255, 255, 0.2);
        }
        
        .recommendation-label {
            font-size: 14px;
            color: var(--text-tertiary);
            margin-bottom: 15px;
            font-weight: 800;
            letter-spacing: 2px;
            text-transform: uppercase;
        }
        
        .recommendation-value {
            font-size: 38px;
            font-weight: 900;
            color: var(--accent-color);
            letter-spacing: -2px;
            text-shadow: 0 2px 20px rgba(99, 102, 241, 0.3);
        }
        
        .recommendation-note {
            font-size: 13px;
            color: var(--text-secondary);
            margin-top: 12px;
            line-height: 1.6;
        }
        
        /* ========== LOGOUT MODAL ========== */
        .logout-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 10, 15, 0.98);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999999;
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            padding: 20px;
            animation: fadeIn 0.5s ease;
        }
        
        .logout-modal.active {
            display: flex;
        }
        
        .logout-content {
            background: linear-gradient(145deg, rgba(30, 30, 45, 0.95), rgba(20, 20, 35, 0.98));
            border-radius: var(--radius-xl);
            padding: 45px 40px;
            width: 100%;
            max-width: 500px;
            animation: slideUp 0.6s ease 0.2s both;
            border: 2px solid rgba(255, 255, 255, 0.1);
            box-shadow: var(--shadow-lg), inset 0 1px 0 rgba(255, 255, 255, 0.1);
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .logout-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 8px;
            background: linear-gradient(135deg, #ef4444, #dc2626);
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        .logout-icon {
            width: 110px;
            height: 110px;
            background: linear-gradient(135deg, #ef4444, #dc2626);
            border-radius: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 42px;
            margin: 0 auto 30px;
            box-shadow: 0 25px 60px rgba(239, 68, 68, 0.5);
            position: relative;
            overflow: hidden;
        }
        
        .logout-icon::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 3s linear infinite;
        }
        
        .logout-title {
            font-size: 32px;
            font-weight: 900;
            margin-bottom: 20px;
            color: var(--text-primary);
            letter-spacing: -0.5px;
        }
        
        .logout-text {
            color: var(--text-secondary);
            font-size: 16px;
            margin-bottom: 40px;
            line-height: 1.8;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .logout-buttons {
            display: flex;
            gap: 20px;
        }
        
        .logout-btn-confirm {
            flex: 1;
            padding: 23px;
            background: linear-gradient(135deg, #ef4444, #dc2626);
            border: none;
            color: white;
            font-weight: 800;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: var(--transition);
            font-size: 17px;
            position: relative;
            overflow: hidden;
            letter-spacing: 1px;
            text-transform: uppercase;
            box-shadow: 0 15px 40px rgba(239, 68, 68, 0.4);
        }
        
        .logout-btn-confirm::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.7s;
        }
        
        .logout-btn-confirm:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 20px 50px rgba(239, 68, 68, 0.5);
        }
        
        .logout-btn-confirm:hover::before {
            left: 100%;
        }
        
        .logout-btn-cancel {
            flex: 1;
            padding: 23px;
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.1));
            border: 2px solid rgba(255, 255, 255, 0.2);
            color: var(--text-secondary);
            font-weight: 800;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: var(--transition);
            font-size: 17px;
            letter-spacing: 1px;
            text-transform: uppercase;
            backdrop-filter: blur(10px);
        }
        
        .logout-btn-cancel:hover {
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.15));
            transform: translateY(-5px);
            box-shadow: var(--shadow-sm);
            border-color: rgba(255, 255, 255, 0.3);
        }
        
        /* ========== NAVIGATION ========== */
        .nav-container { 
            position: fixed; 
            bottom: 30px; 
            left: 50%; 
            transform: translateX(-50%); 
            width: 94%; 
            max-width: 550px; 
            background: linear-gradient(145deg, rgba(30, 30, 45, 0.98), rgba(25, 25, 40, 0.95)); 
            backdrop-filter: blur(40px); 
            -webkit-backdrop-filter: blur(40px); 
            border-radius: var(--radius-xl); 
            display: flex; 
            justify-content: space-around; 
            padding: 22px; 
            border: 2px solid rgba(255, 255, 255, 0.1); 
            z-index: 999999; 
            box-shadow: var(--shadow-lg), inset 0 1px 0 rgba(255, 255, 255, 0.1); 
            pointer-events: auto; 
            animation: slideUp 0.8s ease 0.9s both;
        }
        
        .nav-btn { 
            background: none; 
            border: none; 
            color: var(--text-tertiary); 
            font-size: 24px; 
            cursor: pointer; 
            flex: 1; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            padding: 18px; 
            border-radius: var(--radius-lg);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }
        
        .nav-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--accent-gradient);
            opacity: 0;
            transition: var(--transition);
            z-index: -1;
        }
        
        .nav-btn.active { 
            color: white;
            transform: translateY(-8px) scale(1.1);
            box-shadow: 0 15px 40px rgba(99, 102, 241, 0.4);
        }
        
        .nav-btn.active::before {
            opacity: 1;
        }
        
        .nav-btn:hover {
            color: white;
            transform: translateY(-5px) scale(1.05);
        }
        
        .nav-badge {
            position: absolute;
            top: 5px;
            right: 20px;
            background: var(--loss-color);
            color: white;
            font-size: 10px;
            font-weight: 900;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: pulse 2s infinite;
        }
        
        /* ========== LOADING SPINNER ========== */
        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top: 3px solid var(--accent-color);
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 12px;
        }
        
        .price-loading {
            font-size: 14px;
            color: var(--text-tertiary);
            font-weight: 600;
        }
        
        /* ========== SECTION HEADERS ========== */
        h3 {
            font-size: 32px;
            font-weight: 900;
            margin: 25px 0 35px 0;
            color: var(--text-primary);
            letter-spacing: -1px;
            animation: fadeIn 0.8s ease;
            position: relative;
            display: inline-block;
            text-shadow: 0 2px 15px rgba(0, 0, 0, 0.3);
        }
        
        h3::after {
            content: '';
            position: absolute;
            bottom: -15px;
            left: 0;
            width: 60px;
            height: 6px;
            background: var(--accent-gradient);
            border-radius: 3px;
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        h4 {
            font-size: 24px;
            font-weight: 800;
            margin: 30px 0 25px 0;
            color: var(--text-secondary);
            animation: fadeIn 0.8s ease 0.2s both;
            letter-spacing: -0.5px;
        }
        
        /* ========== EMPTY STATE ========== */
        .empty-state {
            text-align: center;
            padding: 70px 35px;
            color: var(--text-tertiary);
            animation: fadeIn 0.8s ease;
            background: linear-gradient(145deg, rgba(30, 30, 45, 0.5), rgba(25, 25, 40, 0.5));
            border-radius: var(--radius-lg);
            border: 2px dashed rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
        }
        
        .empty-state i {
            font-size: 70px;
            margin-bottom: 30px;
            opacity: 0.3;
            animation: float 3s ease-in-out infinite;
        }
        
        .empty-state p {
            font-size: 17px;
            line-height: 1.8;
            max-width: 350px;
            margin: 0 auto;
        }
        
        /* ========== INFO BOX ========== */
        .info-box {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(59, 130, 246, 0.1));
            border-left: 6px solid var(--wd-color);
            padding: 25px;
            border-radius: var(--radius-lg);
            margin: 30px 0;
            font-size: 15px;
            line-height: 1.8;
            animation: fadeIn 0.8s ease;
            backdrop-filter: blur(20px);
            border: 2px solid rgba(59, 130, 246, 0.2);
        }
        
        /* ========== CENT ACCOUNT SPECIFIC ========== */
        .cent-mode .equity-amount::before {
            content: ' ';
        }
        
        .cent-mode .lot-result-value::after {
            content: ' USC';
        }
        
        .cent-mode .lot-warning {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.2), rgba(245, 158, 11, 0.1));
            border: 2px solid rgba(245, 158, 11, 0.3);
        }
        
        /* ========== RESPONSIVE DESIGN ========== */
        @media (max-width: 768px) {
            body {
                padding: 15px 15px 170px 15px;
            }
            
            .tradingview-widget-container {
                height: 400px;
            }
            
            .tv-web-btn {
                padding: 10px 20px;
                font-size: 14px;
            }
            
            .ticker-item {
                min-width: 140px;
                padding: 20px;
            }
            
            .ticker-price {
                font-size: 22px;
            }
            
            .account-options {
                grid-template-columns: 1fr;
            }
            
            #dream-list {
                grid-template-columns: 1fr;
            }
            
            .recommendation-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .wd-actions {
                flex-direction: column;
            }
            
            .logout-buttons {
                flex-direction: column;
            }
            
            .nav-container {
                padding: 18px;
                border-radius: var(--radius-lg);
                max-width: 500px;
            }
            
            .nav-btn {
                padding: 15px;
                font-size: 22px;
            }
            
            .ai-chat-container {
                height: 500px;
            }
        }
        
        @media (max-width: 480px) {
            body {
                padding: 12px 12px 160px 12px;
            }
            
            .tradingview-widget-container {
                height: 350px;
            }
            
            .tv-web-btn {
                padding: 8px 15px;
                font-size: 13px;
            }
            
            .ticker-item {
                min-width: 130px;
                padding: 18px;
            }
            
            .ticker-price {
                font-size: 20px;
            }
            
            .equity-amount {
                font-size: 46px;
            }
            
            .stat-box {
                padding: 25px 15px;
            }
            
            .stat-box div:last-child {
                font-size: 28px;
            }
            
            .nav-container {
                width: 96%;
                padding: 15px;
                border-radius: var(--radius-lg);
            }
            
            .nav-btn {
                padding: 12px;
                font-size: 20px;
            }
            
            .form-group {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .ai-chat-container {
                height: 450px;
            }
        }
        
        @media (max-width: 360px) {
            .tradingview-widget-container {
                height: 300px;
            }
            
            .ticker-item {
                min-width: 120px;
                padding: 15px;
            }
            
            .equity-amount {
                font-size: 40px;
            }
            
            .stat-grid {
                grid-template-columns: 1fr;
            }
            
            .nav-container {
                padding: 12px;
            }
            
            .nav-btn {
                padding: 10px;
                font-size: 18px;
            }
        }
        
        /* ========== PERFORMANCE OPTIMIZATION ========== */
        .will-change {
            will-change: transform, opacity;
        }
        
        /* ========== PRINT STYLES ========== */
        @media print {
            .nav-container,
            .auth-modal,
            .account-type-modal,
            .tutorial-modal,
            .lot-calculator-modal,
            .recommendation-popup,
            .logout-modal,
            .tv-web-btn {
                display: none !important;
            }
            
            .main-content.active {
                display: block !important;
                animation: none;
            }
            
            body {
                padding: 20px;
                background: white;
                color: black;
            }
            
            .card {
                background: white;
                border: 1px solid #ddd;
                box-shadow: none;
                break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <!-- Login Modal -->
    <div class="auth-modal" id="loginModal">
        <div class="auth-content">
            <div class="auth-icon">
                <i class="fas fa-sign-in-alt"></i>
            </div>
            <h1 class="auth-title">TRADER JOURNAL PRO</h1>
            <p class="auth-subtitle">Login untuk mengakses dashboard trading dan analisis canggih</p>
            
            <div class="auth-error" id="loginError">
                <i class="fas fa-exclamation-circle"></i> <span id="loginErrorText">Username atau password salah</span>
            </div>
            
            <div class="auth-success" id="loginSuccess">
                <i class="fas fa-check-circle"></i> <span id="loginSuccessText">Login berhasil! Mengarahkan...</span>
            </div>
            
            <form class="auth-form" id="loginForm">
                <div class="auth-input-group">
                    <input type="text" class="auth-input" id="loginUsername" placeholder="Username" required>
                    <i class="fas fa-user auth-input-icon"></i>
                </div>
                
                <div class="auth-input-group">
                    <input type="password" class="auth-input" id="loginPassword" placeholder="Password" required>
                    <i class="fas fa-lock auth-input-icon"></i>
                </div>
                
                <!-- GitHub Token Section -->
                <div class="token-section">
                    <div class="token-toggle" id="tokenToggle" onclick="toggleTokenSection()">
                        <div>
                            <i class="fab fa-github"></i>
                            <span style="margin-left: 10px; font-size: 15px; font-weight: 700;">GitHub Sync (Opsional)</span>
                        </div>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="token-form" id="tokenForm">
                        <div class="auth-input-group">
                            <input type="password" class="auth-input" id="githubTokenInput" 
                                   placeholder="Masukkan GitHub Token">
                            <i class="fas fa-key auth-input-icon"></i>
                        </div>
                        <small style="text-align: left; color: var(--text-tertiary); display: block; margin-top: 12px; line-height: 1.6;">
                            <i class="fas fa-info-circle"></i> Token untuk sync data ke GitHub. Kosongkan untuk mode lokal.
                            <br><a href="javascript:void(0)" onclick="showTokenHelp()" style="color: var(--accent-color); font-weight: 700;">Cara dapat token? </a>
                        </small>
                    </div>
                </div>
                
                <button type="submit" class="auth-btn" id="loginBtn">
                    <i class="fas fa-sign-in-alt"></i> LOGIN SEKARANG
                </button>
            </form>
            
            <div class="auth-switch">
                Belum punya akun? <a onclick="showRegister()">DAFTAR DISINI</a>
            </div>
        </div>
    </div>
    
    <!-- Register Modal -->
    <div class="auth-modal" id="registerModal" style="display: none;">
        <div class="auth-content">
            <div class="auth-icon">
                <i class="fas fa-user-plus"></i>
            </div>
            <h1 class="auth-title">BUAT AKUN BARU</h1>
            <p class="auth-subtitle">Bergabung dengan komunitas trader profesional</p>
            
            <div class="auth-error" id="registerError">
                <i class="fas fa-exclamation-circle"></i> <span id="registerErrorText">Terjadi kesalahan</span>
            </div>
            
            <div class="auth-success" id="registerSuccess">
                <i class="fas fa-check-circle"></i> <span id="registerSuccessText">Registrasi berhasil!</span>
            </div>
            
            <form class="auth-form" id="registerForm">
                <div class="auth-input-group">
                    <input type="text" class="auth-input" id="registerUsername" placeholder="Username" required>
                    <i class="fas fa-user auth-input-icon"></i>
                </div>
                
                <div class="auth-input-group">
                    <input type="password" class="auth-input" id="registerPassword" placeholder="Password" required>
                    <i class="fas fa-lock auth-input-icon"></i>
                </div>
                
                <div class="auth-input-group">
                    <input type="password" class="auth-input" id="registerConfirmPassword" placeholder="Konfirmasi Password" required>
                    <i class="fas fa-lock auth-input-icon"></i>
                </div>
                
                <!-- GitHub Token Section -->
                <div class="token-section">
                    <div class="token-toggle" id="tokenToggleRegister" onclick="toggleTokenSection('register')">
                        <div>
                            <i class="fab fa-github"></i>
                            <span style="margin-left: 10px; font-size: 15px; font-weight: 700;">GitHub Sync (Opsional)</span>
                        </div>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="token-form" id="tokenFormRegister">
                        <div class="auth-input-group">
                            <input type="password" class="auth-input" id="githubTokenInputRegister" 
                                   placeholder="Masukkan GitHub Token">
                            <i class="fas fa-key auth-input-icon"></i>
                        </div>
                        <small style="text-align: left; color: var(--text-tertiary); display: block; margin-top: 12px; line-height: 1.6;">
                            <i class="fas fa-info-circle"></i> Token untuk sync data ke GitHub. Kosongkan untuk mode lokal.
                        </small>
                    </div>
                </div>
                
                <button type="submit" class="auth-btn" id="registerBtn">
                    <i class="fas fa-user-plus"></i> BUAT AKUN SEKARANG
                </button>
            </form>
            
            <div class="auth-switch">
                Sudah punya akun? <a onclick="showLogin()">LOGIN DISINI</a>
            </div>
        </div>
    </div>
    
    <!-- Account Type Selection Modal -->
    <div class="account-type-modal" id="accountTypeModal">
        <div class="account-type-content">
            <div class="account-type-icon">
                <i class="fas fa-wallet"></i>
            </div>
            <h1 class="account-type-title">PILIH TIPE AKUN</h1>
            <p class="account-type-subtitle">Pilih tipe akun trading Anda untuk optimasi kalkulasi lot</p>
            
            <div class="account-options">
                <div class="account-option" onclick="selectAccountType('usd')" id="usdAccountOption">
                    <div class="account-option-icon">
                        <i class="fas fa-dollar-sign"></i>
                    </div>
                    <div class="account-option-name">USD ACCOUNT</div>
                    <div class="account-option-desc">
                        Standard trading account dengan perhitungan lot normal.
                        Balance dalam USD, lot size standar (0.01, 0.1, 1.0).
                    </div>
                    <span class="account-option-badge">REKOMENDASI</span>
                </div>
                
                <div class="account-option" onclick="selectAccountType('cent')" id="centAccountOption">
                    <div class="account-option-icon">
                        <i class="fas fa-coins"></i>
                    </div>
                    <div class="account-option-name">CENT ACCOUNT</div>
                    <div class="account-option-desc">
                        Cent account dengan perhitungan khusus.
                        Balance dalam USC (USD Cent), lot size diperkecil 100x.
                    </div>
                </div>
            </div>
            
            <div class="account-type-warning">
                <i class="fas fa-exclamation-triangle"></i> 
                <strong>Perhatian:</strong> Pilihan ini akan mempengaruhi perhitungan lot calculator. Anda bisa mengubahnya nanti di settings.
            </div>
            
            <button class="confirm-account-btn" id="confirmAccountBtn" onclick="confirmAccountType()">
                <i class="fas fa-check-circle"></i> KONFIRMASI PILIHAN
            </button>
        </div>
    </div>
    
    <!-- Tutorial Modal -->
    <div class="tutorial-modal" id="tutorialModal">
        <div class="tutorial-content">
            <div class="tutorial-header">
                <h1 class="tutorial-title"> WELCOME TO PRO TRADER!</h1>
                <p class="tutorial-subtitle">Ikuti tur singkat untuk menguasai semua fitur</p>
            </div>
            
            <!-- Step 1 -->
            <div class="tutorial-step active" id="step1">
                <div class="step-content">
                    <div class="step-icon"></div>
                    <h3 class="step-title">Dashboard Overview</h3>
                    <p class="step-desc">
                        Dashboard menampilkan equity live, statistik trading, dan market data real-time. 
                        Equity card berubah warna berdasarkan status trading Anda.
                    </p>
                    <div class="step-indicators">
                        <div class="step-indicator active"></div>
                        <div class="step-indicator"></div>
                        <div class="step-indicator"></div>
                        <div class="step-indicator"></div>
                        <div class="step-indicator"></div>
                    </div>
                </div>
                <div class="tutorial-buttons">
                    <button class="tutorial-btn skip" onclick="skipTutorial()">SKIP TUTORIAL</button>
                    <button class="tutorial-btn next" onclick="nextTutorialStep()">NEXT </button>
                </div>
            </div>
            
            <!-- Step 2 -->
            <div class="tutorial-step" id="step2">
                <div class="step-content">
                    <div class="step-icon"></div>
                    <h3 class="step-title">Trade Journal</h3>
                    <p class="step-desc">
                        Catat setiap trade dengan detail lengkap: pair, side, result, dan P&L. 
                        Gunakan status RUNNING/FLOATING untuk trade yang masih aktif.
                    </p>
                    <div class="step-indicators">
                        <div class="step-indicator"></div>
                        <div class="step-indicator active"></div>
                        <div class="step-indicator"></div>
                        <div class="step-indicator"></div>
                        <div class="step-indicator"></div>
                    </div>
                </div>
                <div class="tutorial-buttons">
                    <button class="tutorial-btn skip" onclick="prevTutorialStep()"> BACK</button>
                    <button class="tutorial-btn next" onclick="nextTutorialStep()">NEXT </button>
                </div>
            </div>
            
            <!-- Step 3 -->
            <div class="tutorial-step" id="step3">
                <div class="step-content">
                    <div class="step-icon"></div>
                    <h3 class="step-title">Psychology Journal</h3>
                    <p class="step-desc">
                        Catat pelajaran, kesalahan, dan analisis trading. 
                        Tools ini membantu meningkatkan mindset dan menghindari kesalahan berulang.
                    </p>
                    <div class="step-indicators">
                        <div class="step-indicator"></div>
                        <div class="step-indicator"></div>
                        <div class="step-indicator active"></div>
                        <div class="step-indicator"></div>
                        <div class="step-indicator"></div>
                    </div>
                </div>
                <div class="tutorial-buttons">
                    <button class="tutorial-btn skip" onclick="prevTutorialStep()"> BACK</button>
                    <button class="tutorial-btn next" onclick="nextTutorialStep()">NEXT </button>
                </div>
            </div>
            
            <!-- Step 4 -->
            <div class="tutorial-step" id="step4">
                <div class="step-content">
                    <div class="step-icon"></div>
                    <h3 class="step-title">Lot Calculator</h3>
                    <p class="step-desc">
                        Fitur canggih! Hitung lot optimal berdasarkan balance, risk per trade, dan stop loss.
                        Dapatkan rekomendasi lot dan maximal layering.
                    </p>
                    <div class="step-indicators">
                        <div class="step-indicator"></div>
                        <div class="step-indicator"></div>
                        <div class="step-indicator"></div>
                        <div class="step-indicator active"></div>
                        <div class="step-indicator"></div>
                    </div>
                </div>
                <div class="tutorial-buttons">
                    <button class="tutorial-btn skip" onclick="prevTutorialStep()"> BACK</button>
                    <button class="tutorial-btn next" onclick="nextTutorialStep()">NEXT </button>
                </div>
            </div>
            
            <!-- Step 5 -->
            <div class="tutorial-step" id="step5">
                <div class="step-content">
                    <div class="step-icon"></div>
                    <h3 class="step-title">AI Assistant</h3>
                    <p class="step-desc">
                        Dapatkan analisis dan saran dari AI untuk trading Anda.
                        Tanya apapun tentang trading, psikologi, atau strategi.
                    </p>
                    <div class="step-indicators">
                        <div class="step-indicator"></div>
                        <div class="step-indicator"></div>
                        <div class="step-indicator"></div>
                        <div class="step-indicator"></div>
                        <div class="step-indicator active"></div>
                    </div>
                </div>
                <div class="tutorial-buttons">
                    <button class="tutorial-btn skip" onclick="prevTutorialStep()"> BACK</button>
                    <button class="tutorial-btn finish" onclick="finishTutorial()">START TRADING! </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Lot Calculator Modal -->
    <div class="lot-calculator-modal" id="lotCalculatorModal">
        <div class="lot-calculator-content">
            <div class="lot-calculator-header">
                <h2 class="lot-calculator-title">LOT CALCULATOR</h2>
                <button class="close-lot-btn" onclick="closeLotCalculator()"></button>
            </div>
            
            <div class="lot-form-group">
                <label class="lot-label">Account Balance (<span id="balance-unit">$</span>)</label>
                <div class="lot-input-group">
                    <input type="number" id="calc-balance" class="lot-input" placeholder="5000" min="1" step="0.01">
                    <span class="lot-input-unit" id="balance-unit-label">USD</span>
                </div>
                
                <label class="lot-label">Risk per Trade (%)</label>
                <div class="lot-input-group">
                    <input type="number" id="calc-risk" class="lot-input" placeholder="2" min="0.1" max="10" step="0.1">
                    <span class="lot-input-unit">%</span>
                </div>
                
                <label class="lot-label">Stop Loss (Pips)</label>
                <div class="lot-input-group">
                    <input type="number" id="calc-sl" class="lot-input" placeholder="30" min="1" step="1">
                    <span class="lot-input-unit">Pips</span>
                </div>
                
                <label class="lot-label">Instrument</label>
                <select id="calc-instrument" class="lot-input" style="margin-bottom: 0;">
                    <option value="forex">Forex Major (EUR/USD, GBP/USD, etc.)</option>
                    <option value="forex_minor">Forex Minor/Crossover</option>
                    <option value="gold">XAU/USD (Gold)</option>
                    <option value="index">Indices (US30, NAS100, etc.)</option>
                    <option value="crypto">Cryptocurrency</option>
                </select>
            </div>
            
            <button class="calculate-btn" id="calculateBtn" onclick="calculateLot()">
                <i class="fas fa-calculator"></i> CALCULATE OPTIMAL LOT
            </button>
            
            <div class="result-container" id="lotResultContainer" style="display: none;">
                <h3 class="result-title"><i class="fas fa-chart-line"></i> Recommendation</h3>
                <div class="lot-result">
                    <div class="lot-result-item">
                        <span class="lot-result-label">Optimal Lot Size</span>
                        <span class="lot-result-value" id="result-lot">0.01</span>
                    </div>
                    <div class="lot-result-item">
                        <span class="lot-result-label">Risk Amount</span>
                        <span class="lot-result-value" id="result-risk">$10</span>
                    </div>
                    <div class="lot-result-item">
                        <span class="lot-result-label">Max Layering</span>
                        <span class="lot-result-value" id="result-layering">3</span>
                    </div>
                </div>
                
                <div class="lot-recommendation">
                    <h4 class="lot-recommendation-title"><i class="fas fa-lightbulb"></i> Trading Recommendation</h4>
                    <p class="lot-recommendation-text" id="recommendation-text">
                        Based on your balance and risk profile, we recommend starting with 0.01 lot size.
                        Max layering: 3 positions to manage risk effectively.
                    </p>
                </div>
            </div>
            
            <p class="lot-warning" id="lot-warning-text">
                <i class="fas fa-exclamation-triangle"></i> This is a recommendation. Always adjust based on your risk tolerance and market conditions.
            </p>
        </div>
    </div>
    
    <!-- Recommendation Popup -->
    <div class="recommendation-popup" id="recommendationPopup">
        <div class="recommendation-header">
            <div class="recommendation-icon">
                <i class="fas fa-lightbulb"></i>
            </div>
            <div class="recommendation-title">Trading Recommendation</div>
            <button class="close-recommendation" onclick="closeRecommendation()"></button>
        </div>
        <div class="recommendation-content">
            <div class="recommendation-box">
                <div class="recommendation-label">Rekomendasi Lot Anda</div>
                <div class="recommendation-value" id="popup-lot">0.01</div>
                <div class="recommendation-note">Optimal untuk risk management</div>
            </div>
            <div class="recommendation-box">
                <div class="recommendation-label">Maximal Layering</div>
                <div class="recommendation-value" id="popup-layering">3</div>
                <div class="recommendation-note">Maksimal posisi bersamaan</div>
            </div>
        </div>
    </div>
    
    <!-- Logout Modal -->
    <div class="logout-modal" id="logoutModal">
        <div class="logout-content">
            <div class="logout-icon">
                <i class="fas fa-sign-out-alt"></i>
            </div>
            <h2 class="logout-title">KONFIRMASI LOGOUT</h2>
            <p class="logout-text">Apakah Anda yakin ingin logout? Semua data yang belum tersimpan mungkin akan hilang.</p>
            <div class="logout-buttons">
                <button class="logout-btn-cancel" onclick="closeLogoutModal()">BATAL</button>
                <button class="logout-btn-confirm" onclick="confirmLogout()">YA, LOGOUT</button>
            </div>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <div class="overlay"></div>
        
        <header>
            <div class="header-left">
                <div id="account-badge" class="account-badge usd" style="display: none;">
                    <i class="fas fa-wallet"></i>
                    <span>USD ACCOUNT</span>
                </div>
            </div>
            <div class="header-text">
                <small>PRO TRADER DASHBOARD</small>
                <h2 id="display-name">TRADER</h2>
            </div>
            <img src="https://ui-avatars.com/api/?name=User&background=6366f1&color=fff" id="header-avatar" class="user-avatar" onclick="openSettings()">
            <button onclick="openLogoutModal()" class="logout-btn">
                <i class="fas fa-sign-out-alt"></i> LOGOUT
            </button>
        </header>

        <!-- TradingView Chart Widget -->
        <div class="tradingview-widget-container">
            <button class="tv-web-btn" onclick="openTradingViewWeb()">
                <i class="fas fa-external-link-alt"></i> OPEN IN TRADINGVIEW
            </button>
            <div id="tradingview_chart" style="height: 100%;"></div>
        </div>

        <!-- Live Price Ticker -->
        <div class="price-ticker" id="priceTicker">
            <!-- Price items will be dynamically added -->
        </div>

        <!-- Home Section -->
        <div id="home" class="section active">
            <!-- Equity Card -->
            <div class="equity-card" id="equityCard">
                <div class="equity-edit" onclick="editEquity()"></div>
                <div class="equity-content">
                    <div class="equity-label">CURRENT EQUITY (NET)</div>
                    <div class="equity-amount"><span id="currency-symbol">$</span> <span id="home-balance">0</span></div>
                    <div id="floating-balance" style="display: none;"></div>
                    <div class="equity-info">
                        <div class="equity-growth" id="home-growth">Growth: 0%</div>
                        <span id="balance-status-indicator" class="balance-status"></span>
                    </div>
                    <div id="balance-breakdown" class="balance-breakdown" style="display: none;"></div>
                    <div id="active-trades-info" style="display: none;"></div>
                </div>
            </div>

            <!-- Statistics Grid -->
            <div class="stat-grid" style="margin-top: 20px;">
                <div class="stat-box">
                    <span class="label-small">WIN RATE</span>
                    <div id="stat-wr">0%</div>
                </div>
                <div class="stat-box">
                    <span class="label-small">TOTAL TRADES</span>
                    <div id="total-trades">0</div>
                </div>
                <div class="stat-box">
                    <span class="label-small">RUNNING</span>
                    <div id="stat-running">0</div>
                </div>
                <div class="stat-box">
                    <span class="label-small">FLOATING</span>
                    <div id="stat-floating">0</div>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="card" style="margin-top: 20px;">
                <span class="label-small"><i class="fas fa-history"></i> RECENT ACTIVITY</span>
                <div id="recent-activity">
                    No recent activity
                </div>
            </div>
        </div>

        <!-- Trading Journal Section -->
        <div id="trading" class="section">
            <h3>TRADE JOURNAL</h3>
            <div class="card">
                <input type="text" id="pair" placeholder="Pair (ex: BTC/USDT)">
                
                <div class="form-group">
                    <select id="side">
                        <option value="BUY">BUY</option>
                        <option value="SELL">SELL</option>
                    </select>
                    <select id="result">
                        <option value="running">RUNNING</option>
                        <option value="floating">FLOATING</option>
                        <option value="win">WIN (+)</option>
                        <option value="loss">LOSS (-)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <input type="number" id="pnl" placeholder="Final P&L ($)" step="0.01">
                    <input type="number" id="rr" placeholder="RR Ratio" step="0.1">
                </div>
                
                <!-- Running/Floating Current P&L -->
                <div id="current-pnl-container" style="display: none;">
                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                        <div style="flex: 1;">
                            <small style="color: var(--text-tertiary);">Current Floating P&L (<span id="pnl-currency">$</span>)</small>
                            <input type="number" id="current-pnl" class="current-pnl-input" placeholder="Contoh: -150 (negatif untuk floating)" step="0.01">
                        </div>
                        <button onclick="updateCurrentPnl()" class="pnl-update-btn" id="updatePnlBtn">
                            <i class="fas fa-sync-alt"></i> UPDATE
                        </button>
                    </div>
                    <small class="timestamp" id="current-pnl-timestamp">Last updated: -</small>
                    <small style="color: var(--text-tertiary); display: block; margin-top: 10px; font-size: 12px;">
                        <i class="fas fa-info-circle"></i> Nilai NEGATIF untuk floating loss
                    </small>
                </div>
                
                <label class="label-small">Feeling Entry:</label>
                <select id="emotion">
                    <option value="Tenang"> Tenang / Disiplin</option>
                    <option value="Takut"> Takut / Ragu</option>
                    <option value="FOMO"> FOMO / Buru-buru</option>
                    <option value="Marah"> Marah / Revenge Trade</option>
                </select>
                
                <input type="text" id="screenshot" placeholder="Link Gambar Chart (opsional)">
                <label class="label-small">Atau Upload Gambar:</label>
                <input type="file" id="trade-screenshot" accept="image/*" style="padding: 15px;">
                
                <!-- Lot Recommendation Button -->
                <button class="lot-calculator-btn" onclick="openLotCalculator()">
                    <i class="fas fa-calculator"></i> KALKULATOR LOT & LAYERING
                </button>
                
                <button class="btn-primary" onclick="addTrade()" id="addTradeBtn">SUBMIT TRADE</button>
                <button class="btn-primary" onclick="addWithdrawal()" style="background: linear-gradient(135deg, var(--wd-color), #2563eb); margin-top:15px;" id="addWithdrawalBtn">WITHDRAWAL</button>
            </div>
            <h4>TRADE HISTORY</h4>
            <div id="trade-list"></div>
            
            <!-- Tambahan: Menu Withdrawal di bawah tampilan withdrawal -->
            <div class="wd-actions">
                <button class="wd-action-btn add" onclick="addWithdrawal()" id="addWdBtn">
                    <i class="fas fa-plus"></i> ADD WITHDRAWAL
                </button>
                <button class="wd-action-btn" onclick="showAllWithdrawals()">
                    <i class="fas fa-history"></i> VIEW ALL
                </button>
                <button class="wd-action-btn" onclick="exportWithdrawals()">
                    <i class="fas fa-download"></i> EXPORT
                </button>
            </div>
        </div>
        
        <!-- Psychology Journal Section -->
        <div id="journal" class="section">
            <h3><i class="fas fa-book"></i> PERSONAL JOURNAL</h3>
            <div class="card journal-form">
                <label class="label-small">KATEGORI:</label>
                <select id="journal-category">
                    <option value="mistake"> Kesalahan</option>
                    <option value="lesson"> Pelajaran</option>
                    <option value="analysis"> Analisis</option>
                    <option value="note"> Catatan</option>
                </select>
                <input type="text" id="journal-title" placeholder="Judul (opsional)">
                <textarea id="journal-content" placeholder="Tulis jurnal lo di sini... Apa yang salah? Apa yang dipelajari? Analisis trade, dll."></textarea>
                
                <div class="journal-quick-tips">
                    <div class="journal-quick-tips-title">
                        <i class="fas fa-lightbulb"></i> QUICK TIPS
                    </div>
                    <ul class="journal-quick-tips-list">
                        <li>Catat EMOSI saat entry dan exit trade</li>
                        <li>Analisis mengapa trade tersebut profit/loss</li>
                        <li>Note pattern yang berhasil/berulang</li>
                        <li>Review journal mingguan untuk improvement</li>
                    </ul>
                </div>
                
                <button class="btn-primary" onclick="addJournal()" id="addJournalBtn"><i class="fas fa-plus"></i> TAMBAH JOURNAL ENTRY</button>
            </div>
            <h4>ENTRIES</h4>
            <div id="journal-list"></div>
        </div>

        <!-- AI Assistant Section -->
        <div id="ai" class="section">
            <h3><i class="fas fa-robot"></i> AI TRADING ASSISTANT</h3>
            <div class="card">
                <div class="ai-chat-container">
                    <div class="ai-chat-header">
                        <div class="ai-avatar">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div class="ai-header-text">
                            <h4>TRADING AI ASSISTANT</h4>
                            <p>Ask me anything about trading, psychology, or strategies</p>
                        </div>
                    </div>
                    
                    <div class="ai-chat-messages" id="aiChatMessages">
                        <div class="message ai">
                            <div class="message-content">
                                Halo! Saya AI Assistant Anda. Saya bisa membantu dengan:
                                <br> Analisis trading pattern
                                <br> Risk management advice
                                <br> Psychology coaching
                                <br> Strategy optimization
                                <br><br>Apa yang bisa saya bantu hari ini?
                            </div>
                            <div class="message-time">Just now</div>
                        </div>
                    </div>
                    
                    <div class="ai-typing-indicator" id="aiTypingIndicator">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                    
                    <div class="ai-chat-input">
                        <textarea id="aiMessageInput" placeholder="Tanya apa saja tentang trading..."></textarea>
                        <button class="ai-send-btn" onclick="sendAiMessage()" id="aiSendBtn">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Saving Goals Section -->
        <div id="saving" class="section">
            <h3>DREAM GOALS</h3>
            <div class="card">
                <input type="text" id="itemName" placeholder="Nama Barang">
                <input type="text" id="itemImage" placeholder="URL Gambar">
                <input type="number" id="itemPrice" placeholder="Harga ($)">
                <button class="btn-primary" onclick="addItem()" id="addItemBtn">TAMBAH TARGET</button>
            </div>
            <div id="dream-list"></div>
        </div>

        <!-- Settings Section -->
        <div id="settings" class="section">
            <h3>SETTINGS</h3>
            <div class="card">
                <input type="text" id="input-name" placeholder="Nama">
                <input type="number" id="input-capital" placeholder="Modal Awal ($)">
                
                <!-- Account Type Switch -->
                <div style="margin-top: 25px;">
                    <label class="label-small"><i class="fas fa-exchange-alt"></i> SWITCH ACCOUNT TYPE</label>
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-top: 15px; padding: 18px; background: rgba(255,255,255,0.08); border-radius: var(--radius-md); border: 2px solid rgba(255,255,255,0.1);">
                        <div>
                            <div style="font-weight: 800; font-size: 16px;" id="current-account-type-display">USD ACCOUNT</div>
                            <div style="font-size: 13px; color: var(--text-tertiary);">Current account type</div>
                        </div>
                        <button onclick="switchAccountType()" class="btn-primary" style="padding: 12px 25px; font-size: 14px; width: auto;" id="switchAccountBtn">
                            <i class="fas fa-sync-alt"></i> SWITCH
                        </button>
                    </div>
                    <p style="font-size: 12px; color: var(--text-tertiary); margin-top: 10px; line-height: 1.6;">
                        <i class="fas fa-info-circle"></i> Switching account type akan mengubah perhitungan lot calculator.
                    </p>
                </div>
                
                <!-- Lot Calculator Settings -->
                <div style="margin-top: 25px;">
                    <label class="label-small"><i class="fas fa-calculator"></i> LOT CALCULATOR DEFAULTS</label>
                    <div class="form-group" style="margin-top: 15px;">
                        <div>
                            <small style="color: var(--text-tertiary);">Default Risk (%)</small>
                            <input type="number" id="default-risk" placeholder="2" min="0.1" max="10" step="0.1" style="margin-bottom: 10px;">
                        </div>
                        <div>
                            <small style="color: var(--text-tertiary);">Default SL (Pips)</small>
                            <input type="number" id="default-sl" placeholder="30" min="1" step="1" style="margin-bottom: 10px;">
                        </div>
                    </div>
                </div>
                
                <!-- Tutorial Toggle -->
                <div style="margin-top: 25px;">
                    <label class="label-small"><i class="fas fa-graduation-cap"></i> TUTORIAL SETTINGS</label>
                    <div class="checkbox-container" style="margin-top: 15px;">
                        <input type="checkbox" id="tutorial-toggle" checked>
                        <label for="tutorial-toggle" style="color: var(--text-secondary); font-size: 14px;">
                            Tampilkan tutorial saat pertama kali (akan mati otomatis setelah 1x menyimpan data)
                        </label>
                    </div>
                    <button onclick="resetTutorial()" class="btn-primary" style="background: rgba(255,255,255,0.1); border: 2px solid rgba(255,255,255,0.2); margin-top: 15px;" id="resetTutorialBtn">
                        <i class="fas fa-redo"></i> RESET TUTORIAL
                    </button>
                </div>
                
                <div style="text-align: left; margin-top: 25px;">
                    <label class="label-small">WALLPAPER GALERI</label>
                    <input type="file" id="bg-input" accept="image/*" onchange="previewBg(event)" style="display:none;">
                    <button onclick="document.getElementById('bg-input').click()" class="btn-primary" style="background: rgba(255,255,255,0.1); border: 2px solid rgba(255,255,255,0.2);" id="wallpaperBtn">
                        <i class="fas fa-image"></i> PILIH WALLPAPER
                    </button>
                </div>

                <div style="margin-top: 30px; padding-top: 25px; border-top: 2px dashed rgba(255,255,255,0.1);">
                    <a href="https://wa.me/+62812-9935-4986?text=Halo%20Bre!%20Mau%20kasih%20saran%20buat%20update%20Pro%20Trader%20Journal%20nih..." 
                       target="_blank" 
                       style="text-decoration: none; display: inline-block; width: 100%;">
                        <button class="btn-primary" style="background: linear-gradient(135deg, #25d366, #128C7E);">
                            <i class="fab fa-whatsapp" style="font-size: 22px;"></i> CHAT ADMIN
                        </button>
                    </a>
                    <p style="font-size: 13px; color: var(--text-tertiary); margin: 12px auto 0 auto; line-height: 1.6; text-align: center;">
                        Mau kasih saran/ide buat update bagian apa? <br>Chat admin 
                    </p>
                </div>

                <div class="card" style="border: 3px dashed var(--accent-color); margin-top: 25px; background: rgba(99, 102, 241, 0.08);">
                    <span class="label-small">BACKUP & RECOVERY</span>
                    <div class="form-group" style="margin-top: 15px;">
                        <button onclick="exportData()" class="btn-primary" style="background: rgba(255,255,255,0.1); border: 2px solid rgba(255,255,255,0.2); padding: 15px;" id="exportBtn">
                            <i class="fas fa-download"></i> EXPORT JSON
                        </button>
                        <button onclick="document.getElementById('import-file').click()" class="btn-primary" style="background: rgba(255,255,255,0.1); border: 2px solid rgba(255,255,255,0.2); padding: 15px;" id="importBtn">
                            <i class="fas fa-upload"></i> IMPORT DATA
                        </button>
                    </div>
                    <input type="file" id="import-file" style="display:none" onchange="importData(event)">
                    <p style="font-size: 12px; color: var(--text-tertiary); margin-top: 15px; text-align: center; line-height: 1.6;">Gunakan file ini untuk pindah HP/Browser.</p>
                </div>

                <button class="btn-primary" onclick="saveProfile()" id="saveProfileBtn">SIMPAN PERUBAHAN</button>
                <button onclick="clearAllData()" style="background:none; border:none; color:var(--loss-color); font-size:13px; margin-top:25px; cursor:pointer; padding: 10px 0; font-weight: 800;" id="clearDataBtn">RESET SEMUA DATA</button>
            </div>
        </div>

        <!-- Navigation -->
        <nav class="nav-container">
            <button class="nav-btn active" onclick="showTab('home', this)"><i class="fas fa-home"></i></button>
            <button class="nav-btn" onclick="showTab('trading', this)"><i class="fas fa-chart-line"></i></button>
            <button class="nav-btn" onclick="showTab('journal', this)"><i class="fas fa-book"></i></button>
            <button class="nav-btn" onclick="showTab('ai', this)"><i class="fas fa-robot"></i></button>
            <button class="nav-btn" onclick="showTab('saving', this)"><i class="fas fa-wallet"></i></button>
            <button class="nav-btn" onclick="showTab('settings', this)"><i class="fas fa-cog"></i></button>
        </nav>
    </div>

    <script>
        // ========== CONFIGURATION ==========
        const DATABASE_URL = 'https://api.github.com/repos/Jarz2025/Jurnaltrade/contents/Database.txt';
        const PRICE_URL = 'https://api.github.com/repos/Jarz2025/Jurnaltrade/contents/Price.txt';
        
        const TRADINGVIEW_SYMBOLS = [
            'XAUUSD',
            'BTCUSD',
            'US30',
            'NAS100',
            'EURUSD',
            'GBPUSD',
            'USDJPY',
            'AUDUSD'
        ];
        
        // ========== GLOBAL VARIABLES ==========
        let currentUser = null;
        let isLoggedIn = false;
        let allUsers = {};
        let githubToken = '';
        
        let trades = [];
        let items = [];
        let withdrawals = [];
        let journals = [];
        let aiMessages = [];
        let config = { 
            name: "Trader", 
            capital: 1000, 
            accent: "#6366f1",
            accent2: "#8b5cf6",
            bgData: "", 
            profilePic: "https://ui-avatars.com/api/?name=User&background=6366f1&color=fff",
            tutorialCompleted: false,
            defaultRisk: 2,
            defaultSL: 30,
            accountType: 'usd',
        };
        
        let marketPrices = {};
        let tradingViewWidget = null;
        let tutorialStep = 1;
        const totalTutorialSteps = 5;
        let selectedAccountType = 'usd';
        let currentChartSymbol = 'BTCUSD';
        
        // ========== INITIALIZATION ==========
        window.onload = async function() {
            await initializeApp();
            setupEventListeners();
            checkNotifications();
        };
        
        async function initializeApp() {
            try {
                const savedUser = localStorage.getItem('currentUser');
                const savedLogin = localStorage.getItem('isLoggedIn');
                
                if (savedUser && savedLogin === 'true') {
                    currentUser = savedUser;
                    isLoggedIn = true;
                    
                    githubToken = localStorage.getItem('githubToken_' + currentUser) || '';
                    
                    await loadUsersFromStorage();
                    
                    if (allUsers[currentUser]) {
                        loadUserData();
                        showMainContent();
                        initializeTradingView();
                        startPriceUpdates();
                        renderAiMessages();
                        
                        if (!config.tutorialCompleted) {
                            setTimeout(() => {
                                document.getElementById('tutorialModal').style.display = 'flex';
                            }, 1500);
                        }
                    } else {
                        logout();
                        showError('loginError', 'User tidak ditemukan. Silakan login ulang.');
                        showLogin();
                    }
                } else {
                    showLogin();
                }
            } catch (error) {
                console.error('Initialization error:', error);
                showLogin();
            }
        }
        
        function setupEventListeners() {
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('registerForm').addEventListener('submit', handleRegister);
            document.getElementById('result').addEventListener('change', function() {
                const currentPnlContainer = document.getElementById('current-pnl-container');
                const isActive = this.value === 'running' || this.value === 'floating';
                currentPnlContainer.style.display = isActive ? 'block' : 'none';
            });
            
            document.getElementById('aiMessageInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendAiMessage();
                }
            });
            
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeAllModals();
                }
            });
            
            // Auto-save every 30 seconds
            setInterval(async () => {
                if (isLoggedIn && currentUser) {
                    await saveUserData();
                }
            }, 30000);
            
            // Check for running trades every minute
            setInterval(() => {
                updateRunningTrades();
            }, 60000);
        }
        
        // ========== NOTIFICATIONS ==========
        function checkNotifications() {
            if (!("Notification" in window)) {
                console.log("Browser tidak mendukung notifications");
                return;
            }
            
            if (Notification.permission === "default") {
                Notification.requestPermission();
            }
        }
        
        function showNotification(title, body) {
            if (Notification.permission === "granted") {
                const icon = "https://cdn-icons-png.flaticon.com/512/3112/3112946.png";
                new Notification(title, { body, icon });
            }
        }
        
        // ========== AUTHENTICATION FUNCTIONS ==========
        function showLogin() {
            document.getElementById('loginModal').style.display = 'flex';
            document.getElementById('registerModal').style.display = 'none';
            hideAuthMessages();
        }
        
        function showRegister() {
            document.getElementById('registerModal').style.display = 'flex';
            document.getElementById('loginModal').style.display = 'none';
            hideAuthMessages();
        }
        
        function hideAuthMessages() {
            document.getElementById('loginError').style.display = 'none';
            document.getElementById('loginSuccess').style.display = 'none';
            document.getElementById('registerError').style.display = 'none';
            document.getElementById('registerSuccess').style.display = 'none';
        }
        
        function toggleTokenSection(type = 'login') {
            const toggle = type === 'login' ? 
                document.getElementById('tokenToggle') : 
                document.getElementById('tokenToggleRegister');
            const form = type === 'login' ? 
                document.getElementById('tokenForm') : 
                document.getElementById('tokenFormRegister');
            
            toggle.classList.toggle('expanded');
            form.classList.toggle('expanded');
        }
        
        function showTokenHelp() {
            alert(` CARA DAPATKAN GITHUB TOKEN:

1. Login ke GitHub.com
2. Klik foto profil  Settings
3. Developer settings  Personal access tokens
4. Generate new token (classic)
5. Beri nama token: "Trader Journal Sync"
6. Pilih permission: "repo" (full control)
7. Set expiration: No expiration (jika ingin permanen)
8. Generate token  COPY token

 Token digunakan untuk sync data ke GitHub.
 Jika tidak punya token, aplikasi tetap bisa digunakan dengan mode lokal.
 Token disimpan di browser Anda dan aman.`);
        }
        
        async function handleLogin(event) {
            event.preventDefault();
            
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value.trim();
            githubToken = document.getElementById('githubTokenInput').value.trim();
            
            if (!username || !password) {
                showError('loginError', 'Username dan password harus diisi');
                return;
            }
            
            const loginBtn = document.getElementById('loginBtn');
            const originalText = loginBtn.innerHTML;
            loginBtn.innerHTML = '<span class="auth-loading"></span> LOADING...';
            loginBtn.disabled = true;
            
            try {
                await loadUsersFromStorage();
                
                if (!allUsers[username]) {
                    showError('loginError', 'Username tidak ditemukan');
                    return;
                }
                
                if (allUsers[username].password !== password) {
                    showError('loginError', 'Password salah');
                    return;
                }
                
                currentUser = username;
                isLoggedIn = true;
                
                if (githubToken) {
                    localStorage.setItem('githubToken_' + currentUser, githubToken);
                }
                
                localStorage.setItem('currentUser', username);
                localStorage.setItem('isLoggedIn', 'true');
                
                loadUserData();
                
                showSuccess('loginSuccess', 'Login berhasil! Mengarahkan...');
                
                setTimeout(() => {
                    document.getElementById('loginModal').style.display = 'none';
                    showMainContent();
                    
                    if (!config.accountType) {
                        document.getElementById('accountTypeModal').style.display = 'flex';
                    } else {
                        initializeTradingView();
                        startPriceUpdates();
                        renderAiMessages();
                    }
                    
                    showNotification("Pro Trader Journal", `Welcome back, ${username}! `);
                }, 1500);
                
            } catch (error) {
                console.error('Login error:', error);
                showError('loginError', 'Terjadi kesalahan saat login');
            } finally {
                loginBtn.innerHTML = originalText;
                loginBtn.disabled = false;
            }
        }
        
        async function handleRegister(event) {
            event.preventDefault();
            
            const username = document.getElementById('registerUsername').value.trim();
            const password = document.getElementById('registerPassword').value.trim();
            const confirmPassword = document.getElementById('registerConfirmPassword').value.trim();
            const token = document.getElementById('githubTokenInputRegister').value.trim();
            
            if (!username || !password || !confirmPassword) {
                showError('registerError', 'Semua field harus diisi');
                return;
            }
            
            if (password !== confirmPassword) {
                showError('registerError', 'Password tidak cocok');
                return;
            }
            
            if (password.length < 6) {
                showError('registerError', 'Password minimal 6 karakter');
                return;
            }
            
            if (username.length < 3) {
                showError('registerError', 'Username minimal 3 karakter');
                return;
            }
            
            const registerBtn = document.getElementById('registerBtn');
            const originalText = registerBtn.innerHTML;
            registerBtn.innerHTML = '<span class="auth-loading"></span> MENDAFTAR...';
            registerBtn.disabled = true;
            
            try {
                await loadUsersFromStorage();
                
                if (allUsers[username]) {
                    showError('registerError', 'Username sudah digunakan');
                    return;
                }
                
                allUsers[username] = {
                    password: password,
                    createdAt: new Date().toISOString(),
                    accountType: null,
                    data: {
                        trades: [],
                        items: [],
                        withdrawals: [],
                        journals: [],
                        aiMessages: [
                            {
                                id: Date.now(),
                                sender: 'ai',
                                message: 'Halo! Saya AI Assistant Anda. Saya bisa membantu dengan analisis trading, risk management advice, psychology coaching, dan strategy optimization. Apa yang bisa saya bantu hari ini?',
                                timestamp: new Date().toISOString()
                            }
                        ],
                        config: {
                            name: username,
                            capital: 1000,
                            accent: "#6366f1",
                            accent2: "#8b5cf6",
                            bgData: "",
                            profilePic: `https://ui-avatars.com/api/?name=${encodeURIComponent(username)}&background=6366f1&color=fff`,
                            tutorialCompleted: false,
                            defaultRisk: 2,
                            defaultSL: 30,
                            accountType: null
                        },
                        lotRecommendations: {
                            optimalLot: 0.01,
                            maxLayering: 3,
                            lastUpdated: null
                        }
                    }
                };
                
                await saveUsersToStorage();
                
                if (token) {
                    localStorage.setItem('githubToken_' + username, token);
                    githubToken = token;
                }
                
                currentUser = username;
                isLoggedIn = true;
                localStorage.setItem('currentUser', username);
                localStorage.setItem('isLoggedIn', 'true');
                
                loadUserData();
                
                showSuccess('registerSuccess', 'Registrasi berhasil!');
                
                setTimeout(() => {
                    document.getElementById('registerModal').style.display = 'none';
                    document.getElementById('registerForm').reset();
                    document.getElementById('accountTypeModal').style.display = 'flex';
                    
                    showNotification("Pro Trader Journal", `Welcome aboard, ${username}! `);
                }, 1500);
                
            } catch (error) {
                console.error('Register error:', error);
                showError('registerError', 'Terjadi kesalahan saat mendaftar');
            } finally {
                registerBtn.innerHTML = originalText;
                registerBtn.disabled = false;
            }
        }
        
        function showError(elementId, message) {
            const element = document.getElementById(elementId);
            element.querySelector('span').textContent = message;
            element.style.display = 'block';
            setTimeout(() => element.style.display = 'none', 4000);
        }
        
        function showSuccess(elementId, message) {
            const element = document.getElementById(elementId);
            element.querySelector('span').textContent = message;
            element.style.display = 'block';
            setTimeout(() => element.style.display = 'none', 2500);
        }
        
        // ========== ACCOUNT TYPE FUNCTIONS ==========
        function selectAccountType(type) {
            selectedAccountType = type;
            
            document.querySelectorAll('.account-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            if (type === 'usd') {
                document.getElementById('usdAccountOption').classList.add('selected');
            } else {
                document.getElementById('centAccountOption').classList.add('selected');
            }
        }
        
        async function confirmAccountType() {
            if (!currentUser) return;
            
            const confirmBtn = document.getElementById('confirmAccountBtn');
            const originalText = confirmBtn.innerHTML;
            confirmBtn.innerHTML = '<span class="auth-loading"></span> MENYIMPAN...';
            confirmBtn.disabled = true;
            
            try {
                config.accountType = selectedAccountType;
                
                if (allUsers[currentUser]) {
                    allUsers[currentUser].accountType = selectedAccountType;
                    allUsers[currentUser].data.config.accountType = selectedAccountType;
                    
                    await saveUsersToStorage();
                    
                    localStorage.setItem('traderConfig', JSON.stringify(config));
                    localStorage.setItem('usersDatabase', JSON.stringify(allUsers));
                }
                
                document.getElementById('accountTypeModal').style.display = 'none';
                
                applyAccountType();
                
                showMainContent();
                initializeTradingView();
                startPriceUpdates();
                renderAiMessages();
                
                setTimeout(() => {
                    document.getElementById('tutorialModal').style.display = 'flex';
                }, 1000);
            } catch (error) {
                console.error('Error confirming account type:', error);
                alert('Terjadi kesalahan saat menyimpan pilihan account type.');
            } finally {
                confirmBtn.innerHTML = originalText;
                confirmBtn.disabled = false;
            }
        }
        
        function applyAccountType() {
            const isCentAccount = config.accountType === 'cent';
            
            if (isCentAccount) {
                document.body.classList.add('cent-mode');
            } else {
                document.body.classList.remove('cent-mode');
            }
            
            const currencySymbol = isCentAccount ? '' : '$';
            document.getElementById('currency-symbol').textContent = currencySymbol;
            document.getElementById('balance-unit').textContent = currencySymbol;
            document.getElementById('pnl-currency').textContent = currencySymbol;
            document.getElementById('balance-unit-label').textContent = isCentAccount ? 'USC' : 'USD';
            
            const accountBadge = document.getElementById('account-badge');
            if (isCentAccount) {
                accountBadge.innerHTML = '<i class="fas fa-coins"></i><span>CENT ACCOUNT</span>';
                accountBadge.classList.remove('usd');
            } else {
                accountBadge.innerHTML = '<i class="fas fa-dollar-sign"></i><span>USD ACCOUNT</span>';
                accountBadge.classList.add('usd');
            }
            accountBadge.style.display = 'flex';
            
            const accountTypeDisplay = document.getElementById('current-account-type-display');
            if (isCentAccount) {
                accountTypeDisplay.textContent = 'CENT Account (USC)';
            } else {
                accountTypeDisplay.textContent = 'USD Account';
            }
            
            updateUI();
        }
        
        function switchAccountType() {
            const newType = config.accountType === 'usd' ? 'cent' : 'usd';
            const confirmMsg = newType === 'cent' 
                ? 'Switch ke CENT Account? Perhitungan lot akan berubah (1 USD = 100 USC).'
                : 'Switch ke USD Account? Perhitungan lot akan kembali normal.';
            
            if (confirm(confirmMsg)) {
                config.accountType = newType;
                
                if (allUsers[currentUser]) {
                    allUsers[currentUser].accountType = newType;
                    allUsers[currentUser].data.config.accountType = newType;
                }
                
                saveUserData();
                localStorage.setItem('traderConfig', JSON.stringify(config));
                
                applyAccountType();
                
                alert(`Account type switched to ${newType.toUpperCase()}`);
            }
        }
        
        // ========== TUTORIAL FUNCTIONS ==========
        function nextTutorialStep() {
            if (tutorialStep < totalTutorialSteps) {
                document.getElementById(`step${tutorialStep}`).classList.remove('active');
                tutorialStep++;
                document.getElementById(`step${tutorialStep}`).classList.add('active');
                updateTutorialIndicators();
            }
        }
        
        function prevTutorialStep() {
            if (tutorialStep > 1) {
                document.getElementById(`step${tutorialStep}`).classList.remove('active');
                tutorialStep--;
                document.getElementById(`step${tutorialStep}`).classList.add('active');
                updateTutorialIndicators();
            }
        }
        
        function updateTutorialIndicators() {
            const indicators = document.querySelectorAll('.step-indicator');
            indicators.forEach((indicator, index) => {
                if (index === tutorialStep - 1) {
                    indicator.classList.add('active');
                } else {
                    indicator.classList.remove('active');
                }
            });
        }
        
        function skipTutorial() {
            config.tutorialCompleted = true;
            localStorage.setItem('traderConfig', JSON.stringify(config));
            
            if (allUsers[currentUser]) {
                allUsers[currentUser].data.config.tutorialCompleted = true;
                saveUserData();
            }
            
            document.getElementById('tutorialModal').style.display = 'none';
        }
        
        function finishTutorial() {
            config.tutorialCompleted = true;
            localStorage.setItem('traderConfig', JSON.stringify(config));
            
            if (allUsers[currentUser]) {
                allUsers[currentUser].data.config.tutorialCompleted = true;
                saveUserData();
            }
            
            document.getElementById('tutorialModal').style.display = 'none';
            showNotification("Pro Trader Journal", " Tutorial selesai! Mulai catat trading journey lo!");
        }
        
        function resetTutorial() {
            config.tutorialCompleted = false;
            localStorage.setItem('traderConfig', JSON.stringify(config));
            
            if (allUsers[currentUser]) {
                allUsers[currentUser].data.config.tutorialCompleted = false;
                saveUserData();
            }
            
            alert("Tutorial telah direset. Halaman akan direfresh...");
            location.reload();
        }
        
        // ========== DATA STORAGE FUNCTIONS ==========
        async function loadUsersFromStorage() {
            try {
                if (githubToken) {
                    try {
                        const response = await fetch(DATABASE_URL, {
                            headers: {
                                'Authorization': `token ${githubToken}`,
                                'Accept': 'application/vnd.github.v3+json'
                            }
                        });
                        
                        if (response.ok) {
                            const data = await response.json();
                            const content = atob(data.content);
                            const parsedData = JSON.parse(content || '{}');
                            allUsers = { ...allUsers, ...parsedData };
                            console.log(' Loaded from GitHub');
                        }
                    } catch (error) {
                        console.log(' GitHub sync failed, using local data');
                    }
                }
                
                const localData = localStorage.getItem('usersDatabase');
                if (localData) {
                    const parsedData = JSON.parse(localData);
                    allUsers = { ...parsedData, ...allUsers };
                    console.log(' Loaded from localStorage');
                }
                
                if (Object.keys(allUsers).length === 0) {
                    allUsers = {};
                }
                
            } catch (error) {
                console.error(' Load error:', error);
                const localData = localStorage.getItem('usersDatabase');
                allUsers = localData ? JSON.parse(localData) : {};
            }
        }
        
        async function saveUsersToStorage() {
            try {
                localStorage.setItem('usersDatabase', JSON.stringify(allUsers));
                
                if (githubToken) {
                    try {
                        await saveToGitHub(DATABASE_URL, allUsers, 'Update users database');
                        console.log(' Saved to GitHub');
                    } catch (error) {
                        console.log(' GitHub sync failed, saved locally only');
                    }
                }
                
                console.log(' Data saved successfully');
                return true;
                
            } catch (error) {
                console.error(' Save error:', error);
                return false;
            }
        }
        
        async function saveToGitHub(url, data, message) {
            try {
                const getResponse = await fetch(url, {
                    headers: {
                        'Authorization': `token ${githubToken}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                let sha = '';
                if (getResponse.ok) {
                    const fileData = await getResponse.json();
                    sha = fileData.sha;
                }
                
                const content = btoa(JSON.stringify(data, null, 2));
                const updateData = {
                    message: `${message} - ${new Date().toISOString()}`,
                    content: content,
                    sha: sha || undefined
                };
                
                const updateResponse = await fetch(url, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${githubToken}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(updateData)
                });
                
                return updateResponse.ok;
                
            } catch (error) {
                console.error('GitHub save error:', error);
                throw error;
            }
        }
        
        function loadUserData() {
            if (!currentUser || !allUsers[currentUser]) return;
            
            const userData = allUsers[currentUser].data;
            
            trades = userData.trades || [];
            items = userData.items || [];
            withdrawals = userData.withdrawals || [];
            journals = userData.journals || [];
            aiMessages = userData.aiMessages || [
                {
                    id: Date.now(),
                    sender: 'ai',
                    message: 'Halo! Saya AI Assistant Anda. Saya bisa membantu dengan analisis trading, risk management advice, psychology coaching, dan strategy optimization. Apa yang bisa saya bantu hari ini?',
                    timestamp: new Date().toISOString()
                }
            ];
            config = userData.config || config;
            
            localStorage.setItem('trades', JSON.stringify(trades));
            localStorage.setItem('dreamItems', JSON.stringify(items));
            localStorage.setItem('withdrawals', JSON.stringify(withdrawals));
            localStorage.setItem('journals', JSON.stringify(journals));
            localStorage.setItem('aiMessages', JSON.stringify(aiMessages));
            localStorage.setItem('traderConfig', JSON.stringify(config));
            
            updateUI();
            renderTradeHistory();
            renderJournalEntries();
            renderDreamItems();
        }
        
        async function saveUserData() {
            if (!currentUser || !allUsers[currentUser]) return;
            
            allUsers[currentUser].data = {
                trades: trades,
                items: items,
                withdrawals: withdrawals,
                journals: journals,
                aiMessages: aiMessages,
                config: config
            };
            
            await saveUsersToStorage();
        }
        
        // ========== TRADINGVIEW FUNCTIONS ==========
        function initializeTradingView() {
            if (typeof TradingView === 'undefined') {
                console.error('TradingView library not loaded');
                return;
            }
            
            initializePriceTicker();
            
            tradingViewWidget = new TradingView.widget({
                "container_id": "tradingview_chart",
                "width": "100%",
                "height": "100%",
                "symbol": "BTCUSD",
                "interval": "5",
                "timezone": "Asia/Jakarta",
                "theme": "dark",
                "style": "1",
                "locale": "id",
                "toolbar_bg": "#0a0a0f",
                "enable_publishing": false,
                "hide_side_toolbar": false,
                "allow_symbol_change": true,
                "details": true,
                "hotlist": true,
                "calendar": true,
                "studies": [
                    "MACD@tv-basicstudies",
                    "RSI@tv-basicstudies",
                    "Volume@tv-basicstudies",
                    "Bollinger_Bands@tv-basicstudies"
                ],
                "show_popup_button": true,
                "popup_width": "1000",
                "popup_height": "650",
                "support_host": "https://www.tradingview.com"
            });
        }
        
        function openTradingViewWeb() {
            const symbol = currentChartSymbol || 'BTCUSD';
            const url = `https://www.tradingview.com/chart/?symbol=${symbol}`;
            window.open(url, '_blank');
        }
        
        function initializePriceTicker() {
            const ticker = document.getElementById('priceTicker');
            ticker.innerHTML = '';
            
            TRADINGVIEW_SYMBOLS.forEach(symbol => {
                const item = document.createElement('div');
                item.className = 'ticker-item';
                item.id = `ticker-${symbol}`;
                item.innerHTML = `
                    <div class="ticker-symbol">${symbol}</div>
                    <div class="ticker-price" id="price-${symbol}">--.--</div>
                    <div class="ticker-change" id="change-${symbol}">--.--%</div>
                `;
                ticker.appendChild(item);
            });
            
            updateMarketPrices();
        }
        
        async function updateMarketPrices() {
            try {
                if (githubToken) {
                    try {
                        const response = await fetch(PRICE_URL, {
                            headers: {
                                'Authorization': `token ${githubToken}`,
                                'Accept': 'application/vnd.github.v3+json'
                            }
                        });
                        
                        if (response.ok) {
                            const data = await response.json();
                            const content = atob(data.content);
                            const savedPrices = JSON.parse(content || '{}');
                            
                            Object.keys(savedPrices).forEach(key => {
                                if (savedPrices[key]) {
                                    const symbol = key.replace('-price', '').toUpperCase();
                                    updateTickerPrice(symbol, savedPrices[key]);
                                }
                            });
                        }
                    } catch (error) {
                        console.log(' Price sync failed');
                    }
                }
                
                TRADINGVIEW_SYMBOLS.forEach(symbol => {
                    if (!marketPrices[symbol]) {
                        const basePrice = getBasePrice(symbol);
                        const change = (Math.random() - 0.5) * 1.5;
                        const newPrice = basePrice + (basePrice * change / 100);
                        
                        marketPrices[symbol] = {
                            price: newPrice.toFixed(2),
                            change: change.toFixed(2)
                        };
                        
                        updateTickerPrice(symbol, marketPrices[symbol]);
                    }
                });
                
                if (githubToken && Object.keys(marketPrices).length > 0) {
                    try {
                        const pricesToSave = {};
                        Object.keys(marketPrices).forEach(symbol => {
                            pricesToSave[`${symbol.toLowerCase()}-price`] = marketPrices[symbol].price;
                        });
                        
                        await saveToGitHub(PRICE_URL, pricesToSave, 'Update market prices');
                    } catch (error) {
                        console.log(' Price save failed');
                    }
                }
                
            } catch (error) {
                console.error('Price update error:', error);
                TRADINGVIEW_SYMBOLS.forEach(symbol => {
                    if (!marketPrices[symbol]) {
                        const basePrice = getBasePrice(symbol);
                        marketPrices[symbol] = {
                            price: basePrice.toFixed(2),
                            change: "0.00"
                        };
                        updateTickerPrice(symbol, marketPrices[symbol]);
                    }
                });
            }
        }
        
        function getBasePrice(symbol) {
            const basePrices = {
                'XAUUSD': 4533.99,
                'BTCUSD': 87532.99,
                'US30': 39500.50,
                'NAS100': 25644.39,
                'EURUSD': 1.0850,
                'GBPUSD': 1.2650,
                'USDJPY': 148.50,
                'AUDUSD': 0.6550
            };
            return basePrices[symbol] || 100.00;
        }
        
        function updateTickerPrice(symbol, data) {
            const priceElement = document.getElementById(`price-${symbol}`);
            const changeElement = document.getElementById(`change-${symbol}`);
            
            if (priceElement && changeElement) {
                priceElement.textContent = data.price;
                changeElement.textContent = `${data.change}%`;
                changeElement.className = `ticker-change ${parseFloat(data.change) >= 0 ? 'positive' : 'negative'}`;
                
                priceElement.classList.add('price-update');
                setTimeout(() => {
                    priceElement.classList.remove('price-update');
                }, 500);
            }
        }
        
        function startPriceUpdates() {
            updateMarketPrices();
            
            setInterval(updateMarketPrices, 10000);
            
            setInterval(() => {
                TRADINGVIEW_SYMBOLS.forEach(symbol => {
                    if (marketPrices[symbol]) {
                        const currentPrice = parseFloat(marketPrices[symbol].price);
                        const change = (Math.random() - 0.5) * 0.8;
                        const newPrice = currentPrice + (currentPrice * change / 100);
                        
                        marketPrices[symbol] = {
                            price: newPrice.toFixed(2),
                            change: change.toFixed(2)
                        };
                        
                        updateTickerPrice(symbol, marketPrices[symbol]);
                    }
                });
            }, 30000);
        }
        
        // ========== AI ASSISTANT FUNCTIONS ==========
        async function sendAiMessage() {
            const input = document.getElementById('aiMessageInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            const sendBtn = document.getElementById('aiSendBtn');
            const originalIcon = sendBtn.innerHTML;
            sendBtn.innerHTML = '<span class="spinner"></span>';
            sendBtn.disabled = true;
            
            try {
                // Add user message
                const userMessage = {
                    id: Date.now(),
                    sender: 'user',
                    message: message,
                    timestamp: new Date().toISOString()
                };
                
                aiMessages.push(userMessage);
                renderAiMessage(userMessage);
                
                input.value = '';
                
                // Show typing indicator
                const typingIndicator = document.getElementById('aiTypingIndicator');
                typingIndicator.style.display = 'block';
                scrollToBottom();
                
                // Simulate AI thinking
                setTimeout(async () => {
                    typingIndicator.style.display = 'none';
                    
                    const aiResponse = generateAiResponse(message);
                    
                    const aiMessage = {
                        id: Date.now() + 1,
                        sender: 'ai',
                        message: aiResponse,
                        timestamp: new Date().toISOString()
                    };
                    
                    aiMessages.push(aiMessage);
                    renderAiMessage(aiMessage);
                    
                    await saveUserData();
                    
                }, 1500 + Math.random() * 1000);
                
            } catch (error) {
                console.error('Error sending AI message:', error);
            } finally {
                sendBtn.innerHTML = originalIcon;
                sendBtn.disabled = false;
            }
        }
        
        function generateAiResponse(userMessage) {
            const lowerMessage = userMessage.toLowerCase();
            
            const responses = {
                'lot': `Berdasarkan data trading Anda:
 Balance: ${config.accountType === 'cent' ? '' : '$'}${calculateBalance().toLocaleString()}
 Win Rate: ${calculateWinRate()}%
 Risk Profile: ${trades.length > 10 ? 'Moderate' : 'Conservative'}

Rekomendasi lot size: 0.01-0.03
Max positions: 2-3 secara bersamaan
Risk per trade: 1-2% dari balance

Tips: Gunakan stop loss minimal 20 pips untuk risk management yang baik.`,
                
                'strategy': `Untuk strategy trading yang efektif:

1. **Trend Following**: 
   - Trade dengan trend dominan
   - Gunakan EMA 20 & 50 untuk konfirmasi
   - Entry di pullback ke support/resistance

2. **Range Trading**:
   - Identifikasi range jelas
   - Buy di support, sell di resistance
   - Target 1:1 risk reward

3. **Breakout Trading**:
   - Tunggu konfirmasi breakout
   - Volume harus meningkat
   - Target minimal 2x risk

Pilih satu strategy dan konsisten!`,
                
                'psychology': `Psikologi trading sangat krusial:

**Emosi Umum:**
 FOMO  Takut ketinggalan profit
 Revenge Trading  Ingin balas dendam
 Overtrading  Terlalu banyak trade

**Solusi:**
1. Buat trading plan dan STICK TO IT
2. Gunakan stop loss OTOMATIS
3. Review journal setiap minggu
4. Take breaks setelah loss streak

Ingat: Disiplin > Analisis!`,
                
                'analysis': `Analisis trading pattern Anda:

 Total Trades: ${trades.length}
 Win Rate: ${calculateWinRate()}%
 Avg Win: ${calculateAverageWin()}
 Avg Loss: ${calculateAverageLoss()}
 Profit Factor: ${calculateProfitFactor()}

**Insight:**
${trades.length > 5 ? 'Coba improve risk reward ratio ke minimal 1:1.5' : 'Mulai dengan risk kecil dulu, fokus konsistensi'}

**Action Plan:**
1. Review losing trades pattern
2. Optimize entry timing
3. Improve risk management`
            };
            
            for (const [key, response] of Object.entries(responses)) {
                if (lowerMessage.includes(key)) {
                    return response;
                }
            }
            
            // Default response
            const defaultResponses = [
                `Saya menganalisis data trading Anda. Berdasarkan ${trades.length} trades dengan win rate ${calculateWinRate()}%, fokus pada konsistensi dan risk management. Apa yang spesifik ingin Anda tanyakan?`,
                `Untuk trading yang sustainable, penting untuk menjaga risk management. Balance Anda ${config.accountType === 'cent' ? '' : '$'}${calculateBalance().toLocaleString()} dengan ${trades.length} trades. Bagaimana saya bisa membantu lebih spesifik?`,
                `Saya lihat Anda sudah mencatat ${journals.length} journal entries. Bagus untuk perkembangan trading psychology! Ada pertanyaan spesifik tentang trading strategy atau risk management?`
            ];
            
            return defaultResponses[Math.floor(Math.random() * defaultResponses.length)];
        }
        
        function renderAiMessages() {
            const chatMessages = document.getElementById('aiChatMessages');
            chatMessages.innerHTML = '';
            
            aiMessages.forEach(message => {
                renderAiMessage(message, false);
            });
            
            scrollToBottom();
        }
        
        function renderAiMessage(message, animate = true) {
            const chatMessages = document.getElementById('aiChatMessages');
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${message.sender}`;
            messageDiv.innerHTML = `
                <div class="message-content">${message.message}</div>
                <div class="message-time">${formatTime(message.timestamp)}</div>
            `;
            
            if (animate) {
                messageDiv.style.animation = 'slideUp 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
            }
            
            chatMessages.appendChild(messageDiv);
            scrollToBottom();
        }
        
        function scrollToBottom() {
            const chatMessages = document.getElementById('aiChatMessages');
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        function formatTime(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
        }
        
        // ========== CALCULATION FUNCTIONS ==========
        function calculateWinRate() {
            if (trades.length === 0) return 0;
            const winTrades = trades.filter(t => t.result === 'win').length;
            return Math.round((winTrades / trades.length) * 100);
        }
        
        function calculateAverageWin() {
            const winTrades = trades.filter(t => t.result === 'win');
            if (winTrades.length === 0) return 0;
            const totalWin = winTrades.reduce((sum, t) => sum + (parseFloat(t.pnl) || 0), 0);
            return (totalWin / winTrades.length).toFixed(2);
        }
        
        function calculateAverageLoss() {
            const lossTrades = trades.filter(t => t.result === 'loss');
            if (lossTrades.length === 0) return 0;
            const totalLoss = lossTrades.reduce((sum, t) => sum + (parseFloat(t.pnl) || 0), 0);
            return Math.abs(totalLoss / lossTrades.length).toFixed(2);
        }
        
        function calculateProfitFactor() {
            const winTrades = trades.filter(t => t.result === 'win');
            const lossTrades = trades.filter(t => t.result === 'loss');
            
            const totalWin = winTrades.reduce((sum, t) => sum + (parseFloat(t.pnl) || 0), 0);
            const totalLoss = lossTrades.reduce((sum, t) => sum + Math.abs(parseFloat(t.pnl) || 0), 0);
            
            if (totalLoss === 0) return totalWin > 0 ? '' : '0';
            return (totalWin / totalLoss).toFixed(2);
        }
        
        // ========== UI FUNCTIONS ==========
        function showMainContent() {
            document.getElementById('mainContent').classList.add('active');
            document.getElementById('mainContent').style.display = 'block';
            updateUI();
        }
        
        function updateUI() {
            const balance = calculateBalance();
            document.getElementById('home-balance').textContent = balance.toLocaleString();
            
            document.getElementById('total-trades').textContent = trades.length;
            
            const winRate = calculateWinRate();
            document.getElementById('stat-wr').textContent = `${winRate}%`;
            
            const runningTrades = trades.filter(t => t.result === 'running').length;
            const floatingTrades = trades.filter(t => t.result === 'floating').length;
            document.getElementById('stat-running').textContent = runningTrades;
            document.getElementById('stat-floating').textContent = floatingTrades;
            
            document.getElementById('display-name').textContent = config.name.toUpperCase();
            
            updateRecentActivity();
            updateEquityCardColor();
            updateBalanceStatus();
        }
        
        function calculateBalance() {
            let totalProfit = 0;
            
            trades.forEach(t => {
                const val = parseFloat(t.pnl) || 0;
                if (t.result === 'win') { 
                    totalProfit += val; 
                } else if (t.result === 'loss') { 
                    totalProfit -= Math.abs(val); 
                }
            });
            
            const totalWithdrawals = withdrawals.reduce((a, c) => a + (parseFloat(c.amount) || 0), 0);
            return (config.capital || 1000) + totalProfit - totalWithdrawals;
        }
        
        function updateEquityCardColor() {
            const equityCard = document.getElementById('equityCard');
            const runningTrades = trades.filter(t => t.result === 'running').length;
            const floatingTrades = trades.filter(t => t.result === 'floating').length;
            
            equityCard.className = 'equity-card';
            
            if (runningTrades > 0 && floatingTrades === 0) {
                equityCard.classList.add('running');
            } else if (floatingTrades > 0 && runningTrades === 0) {
                equityCard.classList.add('floating');
            } else if (runningTrades > 0 && floatingTrades > 0) {
                equityCard.classList.add('mixed');
            } else if (config.accountType === 'cent') {
                equityCard.classList.add('cent');
            }
        }
        
        function updateBalanceStatus() {
            const statusIndicator = document.getElementById('balance-status-indicator');
            const runningTrades = trades.filter(t => t.result === 'running').length;
            const floatingTrades = trades.filter(t => t.result === 'floating').length;
            
            statusIndicator.className = 'balance-status';
            statusIndicator.innerHTML = '';
            
            if (runningTrades > 0 && floatingTrades === 0) {
                statusIndicator.classList.add('balance-running');
                statusIndicator.innerHTML = `<span class="balance-dot dot-running"></span> ${runningTrades} RUNNING`;
            } else if (floatingTrades > 0 && runningTrades === 0) {
                statusIndicator.classList.add('balance-floating');
                statusIndicator.innerHTML = `<span class="balance-dot dot-floating"></span> ${floatingTrades} FLOATING`;
            } else if (runningTrades > 0 && floatingTrades > 0) {
                statusIndicator.classList.add('balance-mixed');
                statusIndicator.innerHTML = `<span class="balance-dot dot-running"></span><span class="balance-dot dot-floating"></span> ${runningTrades}R / ${floatingTrades}F`;
            }
            
            const floatingBalance = document.getElementById('floating-balance');
            const balanceBreakdown = document.getElementById('balance-breakdown');
            const activeTradesInfo = document.getElementById('active-trades-info');
            
            if (runningTrades > 0 || floatingTrades > 0) {
                let totalFloating = 0;
                let floatingHTML = '';
                
                trades.forEach(t => {
                    if ((t.result === 'running' || t.result === 'floating') && t.currentPnl) {
                        const pnlValue = parseFloat(t.currentPnl) || 0;
                        totalFloating += pnlValue;
                        floatingHTML += `
                            <div class="balance-line">
                                <span>${t.pair} ${t.side}:</span>
                                <span class="${pnlValue >= 0 ? 'balance-positive' : 'balance-negative'}">
                                    ${pnlValue >= 0 ? '+' : ''}${config.accountType === 'cent' ? '' : '$'}${Math.abs(pnlValue).toFixed(2)}
                                </span>
                            </div>
                        `;
                    }
                });
                
                if (totalFloating !== 0) {
                    floatingBalance.textContent = `Floating P&L: ${totalFloating >= 0 ? '+' : ''}${config.accountType === 'cent' ? '' : '$'}${Math.abs(totalFloating).toFixed(2)}`;
                    floatingBalance.style.display = 'block';
                    
                    balanceBreakdown.innerHTML = floatingHTML;
                    balanceBreakdown.style.display = 'block';
                }
                
                activeTradesInfo.textContent = `Active Trades: ${runningTrades} Running, ${floatingTrades} Floating`;
                activeTradesInfo.style.display = 'block';
            } else {
                floatingBalance.style.display = 'none';
                balanceBreakdown.style.display = 'none';
                activeTradesInfo.style.display = 'none';
            }
        }
        
        function updateRecentActivity() {
            const activityDiv = document.getElementById('recent-activity');
            const recentTrades = trades.slice(0, 3);
            
            if (recentTrades.length === 0) {
                activityDiv.innerHTML = '<div style="text-align: center; padding: 25px; color: var(--text-tertiary); font-size: 15px;">No recent trades</div>';
                return;
            }
            
            let html = '';
            recentTrades.forEach(trade => {
                const time = new Date(trade.date).toLocaleTimeString('id-ID', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
                const pnl = parseFloat(trade.pnl) || 0;
                const pnlSign = pnl >= 0 ? '+' : '';
                const currencySymbol = config.accountType === 'cent' ? '' : '$';
                
                html += `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 2px solid rgba(255, 255, 255, 0.1);">
                        <div>
                            <div style="font-weight: 800; font-size: 17px; margin-bottom: 8px;">
                                ${trade.pair} 
                                <span style="color: ${trade.side === 'BUY' ? 'var(--win-color)' : 'var(--loss-color)'}; font-size: 13px; margin-left: 10px;">
                                    ${trade.side}
                                </span>
                            </div>
                            <div style="font-size: 13px; color: var(--text-tertiary);">
                                ${time}  ${trade.result.toUpperCase()}
                            </div>
                        </div>
                        <div style="font-weight: 900; color: ${pnl >= 0 ? 'var(--win-color)' : 'var(--loss-color)'}; font-size: 20px;">
                            ${pnlSign}${currencySymbol}${Math.abs(pnl).toFixed(2)}
                        </div>
                    </div>
                `;
            });
            
            activityDiv.innerHTML = html;
        }
        
        function showTab(tabName, btn) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            btn.classList.add('active');
            window.scrollTo(0,0);
        }
        
        function openSettings() {
            document.getElementById('input-name').value = config.name;
            document.getElementById('input-capital').value = config.capital;
            document.getElementById('default-risk').value = config.defaultRisk || 2;
            document.getElementById('default-sl').value = config.defaultSL || 30;
            document.getElementById('tutorial-toggle').checked = !config.tutorialCompleted;
        }
        
        function editEquity() {
            const newCapital = prompt("Edit Modal Awal (" + (config.accountType === 'cent' ? '' : '$') + "):", config.capital);
            if (newCapital !== null && !isNaN(parseFloat(newCapital))) {
                config.capital = parseFloat(newCapital);
                saveUserData();
                updateUI();
                showNotification("Pro Trader Journal", "Modal awal telah diupdate!");
            }
        }
        
        function openLogoutModal() {
            document.getElementById('logoutModal').classList.add('active');
        }
        
        function closeLogoutModal() {
            document.getElementById('logoutModal').classList.remove('active');
        }
        
        async function confirmLogout() {
            await saveUserData();
            
            currentUser = null;
            isLoggedIn = false;
            trades = [];
            items = [];
            withdrawals = [];
            journals = [];
            aiMessages = [];
            config = { 
                name: "Trader", 
                capital: 1000, 
                accent: "#6366f1",
                accent2: "#8b5cf6",
                bgData: "", 
                profilePic: "https://ui-avatars.com/api/?name=User&background=6366f1&color=fff",
                tutorialCompleted: false,
                defaultRisk: 2,
                defaultSL: 30,
                accountType: 'usd',
            };
            
            localStorage.removeItem('currentUser');
            localStorage.removeItem('isLoggedIn');
            localStorage.removeItem('trades');
            localStorage.removeItem('dreamItems');
            localStorage.removeItem('withdrawals');
            localStorage.removeItem('journals');
            localStorage.removeItem('aiMessages');
            localStorage.removeItem('traderConfig');
            
            document.getElementById('mainContent').classList.remove('active');
            document.getElementById('mainContent').style.display = 'none';
            closeLogoutModal();
            showLogin();
            document.getElementById('loginForm').reset();
            
            showNotification("Pro Trader Journal", "Logout berhasil! Data tersimpan.");
        }
        
        function closeAllModals() {
            document.getElementById('logoutModal').classList.remove('active');
            document.getElementById('lotCalculatorModal').classList.remove('active');
            document.getElementById('recommendationPopup').classList.remove('active');
        }
        
        // ========== TRADE FUNCTIONS ==========
        async function addTrade() {
            const pair = document.getElementById('pair').value;
            const finalPnl = parseFloat(document.getElementById('pnl').value) || 0;
            const result = document.getElementById('result').value;
            
            if(!pair) {
                alert("Isi pair dulu!");
                return;
            }
            
            const addBtn = document.getElementById('addTradeBtn');
            const originalText = addBtn.innerHTML;
            addBtn.innerHTML = '<span class="spinner"></span> MENYIMPAN...';
            addBtn.disabled = true;
            
            try {
                let currentPnl = document.getElementById('current-pnl').value;
                const now = new Date();
                const timestamp = now.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
                
                currentPnl = currentPnl ? parseFloat(currentPnl) : 0;
                
                const newTrade = {
                    id: Date.now(), 
                    pair: pair.toUpperCase(), 
                    side: document.getElementById('side').value, 
                    result: result,
                    pnl: finalPnl,
                    currentPnl: currentPnl,
                    currentPnlTimestamp: timestamp,
                    rr: document.getElementById('rr').value || "0", 
                    emotion: document.getElementById('emotion').value, 
                    ss: document.getElementById('screenshot').value, 
                    date: now.toISOString(),
                    isActive: (result === 'running' || result === 'floating')
                };
                
                trades.unshift(newTrade);
                localStorage.setItem('trades', JSON.stringify(trades));
                
                if (allUsers[currentUser]) {
                    allUsers[currentUser].data.trades = trades;
                    await saveUserData();
                }
                
                updateUI();
                renderTradeHistory();
                
                if (!config.tutorialCompleted) {
                    config.tutorialCompleted = true;
                    localStorage.setItem('traderConfig', JSON.stringify(config));
                    
                    if (allUsers[currentUser]) {
                        allUsers[currentUser].data.config.tutorialCompleted = true;
                        await saveUserData();
                    }
                }
                
                ['pair','pnl','rr','screenshot','current-pnl'].forEach(id => document.getElementById(id).value = '');
                document.getElementById('result').value = 'running';
                document.getElementById('current-pnl-container').style.display = 'block';
                document.getElementById('pnl').placeholder = "Final P&L (isi nanti)";
                
                if((result === 'running' || result === 'floating')) {
                    showNotification("Pro Trader Journal", `Trade ${pair} ditambahkan sebagai ${result.toUpperCase()}. Jangan lupa update P&L!`);
                } else {
                    showNotification("Pro Trader Journal", `Trade ${pair} berhasil dicatat!`);
                }
                
            } catch (error) {
                console.error('Error adding trade:', error);
                alert('Terjadi kesalahan saat menambah trade.');
            } finally {
                addBtn.innerHTML = originalText;
                addBtn.disabled = false;
            }
        }
        
        function updateRunningTrades() {
            let updated = false;
            
            trades.forEach(trade => {
                if (trade.result === 'running' || trade.result === 'floating') {
                    // Simulate P&L changes for running trades
                    const change = (Math.random() - 0.5) * 20;
                    const currentPnl = parseFloat(trade.currentPnl) || 0;
                    trade.currentPnl = (currentPnl + change).toFixed(2);
                    trade.currentPnlTimestamp = new Date().toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
                    updated = true;
                }
            });
            
            if (updated) {
                localStorage.setItem('trades', JSON.stringify(trades));
                updateUI();
                renderTradeHistory();
                saveUserData();
            }
        }
        
        function renderTradeHistory() {
            const tradeList = document.getElementById('trade-list');
            
            if (trades.length === 0) {
                tradeList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-chart-line"></i>
                        <p>Belum ada trade yang dicatat.<br>Mulai catat trade pertama Anda!</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            trades.forEach(trade => {
                const time = new Date(trade.date).toLocaleTimeString('id-ID', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
                const date = new Date(trade.date).toLocaleDateString('id-ID', { 
                    day: 'numeric', 
                    month: 'short' 
                });
                const pnl = parseFloat(trade.pnl) || 0;
                const currentPnl = parseFloat(trade.currentPnl) || 0;
                const currencySymbol = config.accountType === 'cent' ? '' : '$';
                
                let resultBadge = '';
                if (trade.result === 'running') {
                    resultBadge = '<span style="background: linear-gradient(135deg, var(--running-color), #059669); color: white; padding: 6px 15px; border-radius: 20px; font-size: 11px; font-weight: 900; letter-spacing: 1px; margin-left: 10px;">RUNNING</span>';
                } else if (trade.result === 'floating') {
                    resultBadge = '<span style="background: linear-gradient(135deg, var(--floating-color), #dc2626); color: white; padding: 6px 15px; border-radius: 20px; font-size: 11px; font-weight: 900; letter-spacing: 1px; margin-left: 10px;">FLOATING</span>';
                }
                
                html += `
                    <div class="history-item">
                        <div>
                            <div style="font-weight: 900; font-size: 18px; margin-bottom: 8px;">
                                ${trade.pair} 
                                <span style="color: ${trade.side === 'BUY' ? 'var(--win-color)' : 'var(--loss-color)'}; font-size: 13px; margin-left: 8px;">
                                    ${trade.side}
                                </span>
                                ${resultBadge}
                            </div>
                            <div style="font-size: 13px; color: var(--text-tertiary); margin-bottom: 12px;">
                                ${date} ${time}  RR: ${trade.rr}  ${trade.emotion}
                            </div>
                            <div style="font-weight: 900; color: ${pnl >= 0 ? 'var(--win-color)' : 'var(--loss-color)'}; font-size: 22px; margin-bottom: 5px;">
                                ${pnl >= 0 ? '+' : ''}${currencySymbol}${Math.abs(pnl).toFixed(2)}
                            </div>
                            ${trade.currentPnl ? `
                                <div style="font-size: 12px; color: ${currentPnl >= 0 ? 'var(--win-color)' : 'var(--loss-color)'};">
                                    Current: ${currentPnl >= 0 ? '+' : ''}${currencySymbol}${Math.abs(currentPnl).toFixed(2)}
                                    <span style="color: var(--text-tertiary); font-size: 11px; margin-left: 8px;">
                                        ${trade.currentPnlTimestamp ? `(${trade.currentPnlTimestamp})` : ''}
                                    </span>
                                </div>
                            ` : ''}
                        </div>
                        <div style="display: flex; align-items: center;">
                            <button class="edit-btn" onclick="editTrade(${trade.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="del-btn" onclick="deleteTrade(${trade.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            });
            
            tradeList.innerHTML = html;
        }
        
        function updateCurrentPnl() {
            const currentPnlInput = document.getElementById('current-pnl').value;
            const currentPnl = parseFloat(currentPnlInput) || 0;
            const timestamp = new Date().toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
            
            document.getElementById('current-pnl-timestamp').textContent = `Last updated: ${timestamp}`;
            
            showNotification("Pro Trader Journal", `Current P&L updated to: ${currentPnl >= 0 ? '+' : ''}${config.accountType === 'cent' ? '' : '$'}${Math.abs(currentPnl).toFixed(2)}`);
        }
        
        function editTrade(id) {
            const trade = trades.find(t => t.id === id);
            if (!trade) return;
            
            const newPnl = prompt(`Edit P&L untuk ${trade.pair} (${trade.side}):`, trade.pnl);
            if (newPnl !== null && !isNaN(parseFloat(newPnl))) {
                trade.pnl = parseFloat(newPnl);
                localStorage.setItem('trades', JSON.stringify(trades));
                saveUserData();
                updateUI();
                renderTradeHistory();
                showNotification("Pro Trader Journal", `P&L updated for ${trade.pair}`);
            }
        }
        
        function deleteTrade(id) {
            if (confirm("Hapus trade ini?")) {
                trades = trades.filter(t => t.id !== id);
                localStorage.setItem('trades', JSON.stringify(trades));
                saveUserData();
                updateUI();
                renderTradeHistory();
                showNotification("Pro Trader Journal", "Trade deleted successfully");
            }
        }
        
        // ========== WITHDRAWAL FUNCTIONS ==========
        function addWithdrawal() {
            const amt = parseFloat(prompt("Jumlah WD (" + (config.accountType === 'cent' ? '' : '$') + "):"));
            if(!isNaN(amt) && amt > 0) {
                withdrawals.unshift({ 
                    id: Date.now(), 
                    amount: amt, 
                    date: new Date().toLocaleDateString('id-ID', { 
                        day: 'numeric', 
                        month: 'short', 
                        year: 'numeric' 
                    }),
                    timestamp: new Date().toISOString()
                });
                localStorage.setItem('withdrawals', JSON.stringify(withdrawals));
                
                if (allUsers[currentUser]) {
                    allUsers[currentUser].data.withdrawals = withdrawals;
                    saveUserData();
                }
                
                updateUI();
                showNotification("WD Success!", `Withdrawal ${config.accountType === 'cent' ? '' : '$'}${amt} telah dicatat. Good job!`);
            }
        }
        
        function showAllWithdrawals() {
            if (withdrawals.length === 0) {
                alert("Belum ada withdrawal!");
                return;
            }
            
            let message = "Withdrawal History:\n\n";
            let total = 0;
            
            withdrawals.forEach((wd, index) => {
                message += `${index + 1}. ${config.accountType === 'cent' ? '' : '$'}${wd.amount} - ${wd.date}\n`;
                total += parseFloat(wd.amount);
            });
            
            message += `\nTotal Withdrawn: ${config.accountType === 'cent' ? '' : '$'}${total.toFixed(2)}`;
            alert(message);
        }
        
        function exportWithdrawals() {
            if (withdrawals.length === 0) {
                alert("Tidak ada data withdrawal untuk diexport!");
                return;
            }
            
            const data = {
                withdrawals: withdrawals,
                exportDate: new Date().toISOString(),
                accountType: config.accountType,
                username: currentUser
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `withdrawals_${new Date().toLocaleDateString().replace(/\//g, '-')}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        // ========== JOURNAL FUNCTIONS ==========
        async function addJournal() {
            const category = document.getElementById('journal-category').value;
            const title = document.getElementById('journal-title').value;
            const content = document.getElementById('journal-content').value.trim();
            
            if(!content) {
                alert("Isi konten jurnal dulu!");
                return;
            }
            
            const addBtn = document.getElementById('addJournalBtn');
            const originalText = addBtn.innerHTML;
            addBtn.innerHTML = '<span class="spinner"></span> MENYIMPAN...';
            addBtn.disabled = true;
            
            try {
                journals.unshift({
                    id: Date.now(),
                    category: category,
                    title: title || getCategoryName(category),
                    content: content,
                    date: new Date().toLocaleDateString('id-ID', { 
                        day: 'numeric', 
                        month: 'short', 
                        year: 'numeric' 
                    }),
                    timestamp: new Date().toISOString()
                });
                
                localStorage.setItem('journals', JSON.stringify(journals));
                
                if (allUsers[currentUser]) {
                    allUsers[currentUser].data.journals = journals;
                    await saveUserData();
                }
                
                renderJournalEntries();
                
                if (!config.tutorialCompleted) {
                    config.tutorialCompleted = true;
                    localStorage.setItem('traderConfig', JSON.stringify(config));
                    
                    if (allUsers[currentUser]) {
                        allUsers[currentUser].data.config.tutorialCompleted = true;
                        await saveUserData();
                    }
                }
                
                document.getElementById('journal-title').value = '';
                document.getElementById('journal-content').value = '';
                
                showNotification("Journal Updated", "Journal entry berhasil ditambahkan!");
                
            } catch (error) {
                console.error('Error adding journal:', error);
                alert('Terjadi kesalahan saat menambah journal.');
            } finally {
                addBtn.innerHTML = originalText;
                addBtn.disabled = false;
            }
        }
        
        function getCategoryName(cat) {
            const names = {
                'mistake': 'Kesalahan',
                'lesson': 'Pelajaran',
                'analysis': 'Analisis',
                'note': 'Catatan'
            };
            return names[cat] || 'Entry';
        }
        
        function renderJournalEntries() {
            const journalList = document.getElementById('journal-list');
            
            if (journals.length === 0) {
                journalList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-book"></i>
                        <p>Belum ada journal entry.<br>Mulai catat pembelajaran trading Anda!</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            journals.forEach(journal => {
                const categoryClass = `cat-${journal.category}`;
                const categoryName = getCategoryName(journal.category);
                
                html += `
                    <div class="journal-entry">
                        <div class="journal-category ${categoryClass}">${categoryName}</div>
                        <h4 style="margin: 0 0 12px 0; color: var(--text-primary); font-size: 20px;">${journal.title}</h4>
                        <div style="font-size: 13px; color: var(--text-tertiary); margin-bottom: 20px;">
                            <i class="far fa-calendar"></i> ${journal.date}
                        </div>
                        <div style="color: var(--text-secondary); line-height: 1.8; font-size: 15px; white-space: pre-line;">
                            ${journal.content}
                        </div>
                        <div style="display: flex; justify-content: flex-end; margin-top: 20px;">
                            <button class="del-btn" onclick="deleteJournal(${journal.id})" style="font-size: 13px; padding: 10px 20px;">
                                <i class="fas fa-trash"></i> HAPUS
                            </button>
                        </div>
                    </div>
                `;
            });
            
            journalList.innerHTML = html;
        }
        
        function deleteJournal(id) {
            if (confirm("Hapus journal entry ini?")) {
                journals = journals.filter(j => j.id !== id);
                localStorage.setItem('journals', JSON.stringify(journals));
                saveUserData();
                renderJournalEntries();
                showNotification("Journal Updated", "Journal entry dihapus");
            }
        }
        
        // ========== SAVING GOALS FUNCTIONS ==========
        async function addItem() {
            const name = document.getElementById('itemName').value.trim();
            const image = document.getElementById('itemImage').value.trim();
            const price = parseFloat(document.getElementById('itemPrice').value);
            
            if(!name || !price || isNaN(price)) {
                alert("Isi nama dan harga dengan benar!");
                return;
            }
            
            const addBtn = document.getElementById('addItemBtn');
            const originalText = addBtn.innerHTML;
            addBtn.innerHTML = '<span class="spinner"></span> MENYIMPAN...';
            addBtn.disabled = true;
            
            try {
                items.unshift({
                    id: Date.now(),
                    name: name,
                    image: image || 'https://images.unsplash.com/photo-1556742049-0cfed4f6a45d?ixlib=rb-1.2.1&auto=format&fit=crop&w=600&q=80',
                    price: price,
                    saved: 0,
                    date: new Date().toISOString()
                });
                
                localStorage.setItem('dreamItems', JSON.stringify(items));
                
                if (allUsers[currentUser]) {
                    allUsers[currentUser].data.items = items;
                    await saveUserData();
                }
                
                renderDreamItems();
                
                document.getElementById('itemName').value = '';
                document.getElementById('itemImage').value = '';
                document.getElementById('itemPrice').value = '';
                
                showNotification("Dream Goal Added", `Target "${name}" berhasil ditambahkan!`);
                
            } catch (error) {
                console.error('Error adding item:', error);
                alert('Terjadi kesalahan saat menambah item.');
            } finally {
                addBtn.innerHTML = originalText;
                addBtn.disabled = false;
            }
        }
        
        function renderDreamItems() {
            const dreamList = document.getElementById('dream-list');
            
            if (items.length === 0) {
                dreamList.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <i class="fas fa-gem"></i>
                        <p>Belum ada dream goals.<br>Tambahkan barang impian Anda!</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            items.forEach(item => {
                const progress = item.saved / item.price * 100;
                const currencySymbol = config.accountType === 'cent' ? '' : '$';
                
                html += `
                    <div class="dream-item">
                        <img src="${item.image}" alt="${item.name}">
                        <div class="dream-item-content">
                            <h4>${item.name}</h4>
                            <p>Target: ${currencySymbol}${item.price.toLocaleString()}</p>
                            <p>Tersimpan: ${currencySymbol}${item.saved.toLocaleString()}</p>
                            <div class="dream-progress">
                                <div class="dream-progress-bar" style="width: ${Math.min(progress, 100)}%"></div>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-top: 15px;">
                                <button onclick="addSavings(${item.id})" style="background: var(--accent-gradient); color: white; border: none; padding: 10px 15px; border-radius: var(--radius-sm); font-size: 12px; cursor: pointer; font-weight: 800; letter-spacing: 0.5px;">
                                    <i class="fas fa-plus"></i> TAMBAH
                                </button>
                                <button onclick="deleteItem(${item.id})" style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(239, 68, 68, 0.1)); color: var(--loss-color); border: 2px solid rgba(239, 68, 68, 0.3); padding: 10px 15px; border-radius: var(--radius-sm); font-size: 12px; cursor: pointer; font-weight: 800; letter-spacing: 0.5px;">
                                    <i class="fas fa-trash"></i> HAPUS
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            dreamList.innerHTML = html;
        }
        
        function addSavings(itemId) {
            const amount = parseFloat(prompt("Jumlah yang ditambahkan (" + (config.accountType === 'cent' ? '' : '$') + "):"));
            if(!isNaN(amount) && amount > 0) {
                const item = items.find(i => i.id === itemId);
                if(item) {
                    item.saved += amount;
                    localStorage.setItem('dreamItems', JSON.stringify(items));
                    saveUserData();
                    renderDreamItems();
                    showNotification("Savings Updated", `Tabungan ditambahkan: ${config.accountType === 'cent' ? '' : '$'}${amount}`);
                }
            }
        }
        
        function deleteItem(id) {
            if (confirm("Hapus item ini?")) {
                items = items.filter(i => i.id !== id);
                localStorage.setItem('dreamItems', JSON.stringify(items));
                saveUserData();
                renderDreamItems();
                showNotification("Dream Goal Deleted", "Item berhasil dihapus");
            }
        }
        
        // ========== LOT CALCULATOR FUNCTIONS ==========
        function openLotCalculator() {
            document.getElementById('lotCalculatorModal').classList.add('active');
            
            const balance = parseFloat(document.getElementById('home-balance').innerText.replace(/,/g, '')) || config.capital || 1000;
            document.getElementById('calc-balance').value = balance;
            document.getElementById('calc-risk').value = config.defaultRisk || 2;
            document.getElementById('calc-sl').value = config.defaultSL || 30;
            
            const warningText = document.getElementById('lot-warning-text');
            if (config.accountType === 'cent') {
                warningText.innerHTML = `<i class="fas fa-exclamation-triangle"></i> <strong>CENT ACCOUNT MODE:</strong> Lot size dikonversi ke USC (1 USD = 100 USC). Perhitungan sudah otomatis.`;
            } else {
                warningText.innerHTML = `<i class="fas fa-exclamation-triangle"></i> This is a recommendation. Always adjust based on your risk tolerance and market conditions.`;
            }
            
            document.getElementById('lotResultContainer').style.display = 'none';
        }
        
        function closeLotCalculator() {
            document.getElementById('lotCalculatorModal').classList.remove('active');
        }
        
        async function calculateLot() {
            const calculateBtn = document.getElementById('calculateBtn');
            const originalText = calculateBtn.innerHTML;
            calculateBtn.innerHTML = '<span class="spinner"></span> MENGHITUNG...';
            calculateBtn.disabled = true;
            
            try {
                const balance = parseFloat(document.getElementById('calc-balance').value);
                const riskPercent = parseFloat(document.getElementById('calc-risk').value);
                const stopLoss = parseFloat(document.getElementById('calc-sl').value);
                const instrument = document.getElementById('calc-instrument').value;
                
                if (!balance || !riskPercent || !stopLoss) {
                    alert("Harap isi semua field!");
                    return;
                }
                
                if (balance <= 0 || riskPercent <= 0 || stopLoss <= 0) {
                    alert("Nilai harus lebih dari 0!");
                    return;
                }
                
                const isCentAccount = config.accountType === 'cent';
                const adjustedBalance = isCentAccount ? balance / 100 : balance;
                const riskAmount = (adjustedBalance * riskPercent) / 100;
                
                let pipValuePerLot = 10;
                
                switch(instrument) {
                    case 'forex':
                        pipValuePerLot = 10;
                        break;
                    case 'forex_minor':
                        pipValuePerLot = 10;
                        break;
                    case 'gold':
                        pipValuePerLot = 10;
                        break;
                    case 'index':
                        pipValuePerLot = 1;
                        break;
                    case 'crypto':
                        pipValuePerLot = 1;
                        break;
                }
                
                let optimalLot = riskAmount / (stopLoss * pipValuePerLot);
                
                if (isCentAccount) {
                    optimalLot = optimalLot / 100;
                }
                
                let roundedLot = Math.max(0.01, Math.round(optimalLot * 100) / 100);
                
                const standardLots = isCentAccount 
                    ? [0.0001, 0.0002, 0.0003, 0.0005, 0.001, 0.002, 0.003, 0.005, 0.01, 0.02, 0.03, 0.05, 0.1]
                    : [0.01, 0.02, 0.03, 0.05, 0.1, 0.2, 0.3, 0.5, 1, 2, 3, 5, 10];
                
                let finalLot = isCentAccount ? 0.0001 : 0.01;
                
                for (let i = 0; i < standardLots.length; i++) {
                    if (roundedLot >= standardLots[i]) {
                        finalLot = standardLots[i];
                    } else {
                        break;
                    }
                }
                
                let maxLayering = 3;
                
                if (adjustedBalance < 1000) {
                    maxLayering = 2;
                } else if (adjustedBalance >= 1000 && adjustedBalance < 5000) {
                    maxLayering = 3;
                } else if (adjustedBalance >= 5000 && adjustedBalance < 20000) {
                    maxLayering = 4;
                } else {
                    maxLayering = 5;
                }
                
                if (instrument === 'crypto') {
                    maxLayering = Math.min(2, maxLayering);
                }
                
                document.getElementById('result-lot').textContent = finalLot.toFixed(4);
                const riskAmountDisplay = isCentAccount ? riskAmount * 100 : riskAmount;
                const currencySymbol = isCentAccount ? '' : '$';
                document.getElementById('result-risk').textContent = `${currencySymbol}${riskAmountDisplay.toFixed(2)}`;
                document.getElementById('result-layering').textContent = maxLayering;
                
                let recommendationText = '';
                const balanceDisplay = isCentAccount ? balance.toLocaleString() + ' USC' : currencySymbol + balance.toLocaleString();
                
                if (finalLot <= (isCentAccount ? 0.0005 : 0.05)) {
                    recommendationText = `Balance ${balanceDisplay} dengan risk ${riskPercent}% per trade. Start dengan ${finalLot.toFixed(4)} lot untuk risk management yang aman.`;
                } else if (finalLot <= (isCentAccount ? 0.002 : 0.2)) {
                    recommendationText = `Balance ${balanceDisplay} cukup solid! ${finalLot.toFixed(4)} lot size optimal dengan max ${maxLayering} posisi bersamaan.`;
                } else {
                    recommendationText = `Balance ${balanceDisplay} besar! ${finalLot.toFixed(4)} lot size bisa profitable dengan disiplin stop loss.`;
                }
                
                recommendationText += ` Max layering: ${maxLayering} posisi untuk manage risk.`;
                
                if (isCentAccount) {
                    recommendationText += `\n\n Note: CENT Account mode (1 USD = 100 USC).`;
                }
                
                document.getElementById('recommendation-text').textContent = recommendationText;
                
                document.getElementById('lotResultContainer').style.display = 'block';
                
                showRecommendationPopup(finalLot, maxLayering);
                
                if (config.defaultRisk !== riskPercent) {
                    config.defaultRisk = riskPercent;
                }
                if (config.defaultSL !== stopLoss) {
                    config.defaultSL = stopLoss;
                }
                localStorage.setItem('traderConfig', JSON.stringify(config));
                
                if (allUsers[currentUser]) {
                    allUsers[currentUser].data.config.defaultRisk = config.defaultRisk;
                    allUsers[currentUser].data.config.defaultSL = config.defaultSL;
                    await saveUserData();
                }
                
                showNotification("Lot Calculator", `Optimal lot size: ${finalLot.toFixed(4)}`);
                
            } catch (error) {
                console.error('Error calculating lot:', error);
                alert('Terjadi kesalahan saat menghitung lot.');
            } finally {
                calculateBtn.innerHTML = originalText;
                calculateBtn.disabled = false;
            }
        }
        
        function showRecommendationPopup(lot, layering) {
            document.getElementById('popup-lot').textContent = lot.toFixed(4);
            document.getElementById('popup-layering').textContent = layering;
            document.getElementById('recommendationPopup').classList.add('active');
            
            setTimeout(() => {
                closeRecommendation();
            }, 10000);
        }
        
        function closeRecommendation() {
            document.getElementById('recommendationPopup').classList.remove('active');
        }
        
        // ========== SETTINGS FUNCTIONS ==========
        async function saveProfile() {
            const saveBtn = document.getElementById('saveProfileBtn');
            const originalText = saveBtn.innerHTML;
            saveBtn.innerHTML = '<span class="spinner"></span> MENYIMPAN...';
            saveBtn.disabled = true;
            
            try {
                config.name = document.getElementById('input-name').value || config.name;
                config.capital = parseFloat(document.getElementById('input-capital').value) || config.capital;
                
                const defaultRisk = parseFloat(document.getElementById('default-risk').value);
                const defaultSL = parseFloat(document.getElementById('default-sl').value);
                
                if (defaultRisk && defaultRisk > 0 && defaultRisk <= 10) {
                    config.defaultRisk = defaultRisk;
                }
                
                if (defaultSL && defaultSL > 0) {
                    config.defaultSL = defaultSL;
                }
                
                config.tutorialCompleted = !document.getElementById('tutorial-toggle').checked;
                
                localStorage.setItem('traderConfig', JSON.stringify(config));
                
                if (allUsers[currentUser]) {
                    allUsers[currentUser].data.config = config;
                    await saveUserData();
                }
                
                updateUI();
                showNotification("Profile Saved", "Profile berhasil disimpan!");
            } catch (error) {
                console.error('Error saving profile:', error);
                alert('Terjadi kesalahan saat menyimpan profile.');
            } finally {
                saveBtn.innerHTML = originalText;
                saveBtn.disabled = false;
            }
        }
        
        function previewBg(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    config.bgData = e.target.result;
                    localStorage.setItem('traderConfig', JSON.stringify(config));
                    
                    if (allUsers[currentUser]) {
                        allUsers[currentUser].data.config.bgData = e.target.result;
                        saveUserData();
                    }
                    
                    document.body.style.backgroundImage = `url('${e.target.result}')`;
                    showNotification("Wallpaper Updated", "Wallpaper berhasil diubah!");
                };
                reader.readAsDataURL(file);
            }
        }
        
        function exportData() {
            const data = {
                trades: trades,
                withdrawals: withdrawals,
                config: config,
                dreamItems: items,
                journals: journals,
                aiMessages: aiMessages,
                exportDate: new Date().toISOString(),
                username: currentUser
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `pro_trader_backup_${new Date().toLocaleDateString().replace(/\//g, '-')}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification("Data Exported", "Backup berhasil diexport!");
        }
        
        function importData(event) {
            const reader = new FileReader();
            reader.onload = async function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if(confirm("Timpa data saat ini dengan data dari file backup?")) {
                        trades = data.trades || [];
                        withdrawals = data.withdrawals || [];
                        config = data.config || config;
                        items = data.dreamItems || [];
                        journals = data.journals || [];
                        aiMessages = data.aiMessages || [];
                        
                        localStorage.setItem('trades', JSON.stringify(trades));
                        localStorage.setItem('withdrawals', JSON.stringify(withdrawals));
                        localStorage.setItem('traderConfig', JSON.stringify(config));
                        localStorage.setItem('dreamItems', JSON.stringify(items));
                        localStorage.setItem('journals', JSON.stringify(journals));
                        localStorage.setItem('aiMessages', JSON.stringify(aiMessages));
                        
                        if (allUsers[currentUser]) {
                            allUsers[currentUser].data = {
                                trades: trades,
                                items: items,
                                withdrawals: withdrawals,
                                journals: journals,
                                aiMessages: aiMessages,
                                config: config
                            };
                            await saveUserData();
                        }
                        
                        alert("Data berhasil dipulihkan!");
                        location.reload();
                    }
                } catch(err) {
                    alert("File backup tidak valid!");
                }
            };
            reader.readAsText(event.target.files[0]);
        }
        
        function clearAllData() { 
            if(confirm("Reset semua data? Ini tidak bisa dibatalkan!")) { 
                if(confirm("Yakin 100%? Semua trade, journal, dan settings akan hilang!")) {
                    trades = [];
                    items = [];
                    withdrawals = [];
                    journals = [];
                    aiMessages = [];
                    config = { 
                        name: "Trader", 
                        capital: 1000, 
                        accent: "#6366f1",
                        accent2: "#8b5cf6",
                        bgData: "", 
                        profilePic: "https://ui-avatars.com/api/?name=User&background=6366f1&color=fff",
                        tutorialCompleted: false,
                        defaultRisk: 2,
                        defaultSL: 30,
                        accountType: 'usd',
                    };
                    
                    localStorage.removeItem('trades');
                    localStorage.removeItem('dreamItems');
                    localStorage.removeItem('withdrawals');
                    localStorage.removeItem('journals');
                    localStorage.removeItem('aiMessages');
                    localStorage.removeItem('traderConfig');
                    
                    if (allUsers[currentUser]) {
                        allUsers[currentUser].data = {
                            trades: [],
                            items: [],
                            withdrawals: [],
                            journals: [],
                            aiMessages: [],
                            config: config
                        };
                        saveUserData();
                    }
                    
                    alert("Data berhasil direset!");
                    location.reload();
                }
            } 
        }
        
        // ========== HELPER FUNCTIONS ==========
        function checkReminder() {
            const lastTrade = trades.length > 0 ? new Date(trades[0].date).toLocaleDateString() : null;
            const today = new Date().toLocaleDateString();

            if (lastTrade !== today && Notification.permission === "granted") {
                setTimeout(() => {
                    showNotification("Pro Trader Journal", "Bre, belum ada trade yang dicatat hari ini. Jangan lupa evaluasi ya! ");
                }, 5000);
            }
            
            const activeTrades = trades.filter(t => t.result === 'running' || t.result === 'floating');
            if (activeTrades.length > 0 && Notification.permission === "granted") {
                setTimeout(() => {
                    showNotification("Update P&L", `Jangan lupa update P&L untuk ${activeTrades.length} trade yang masih aktif!`);
                }, 10000);
            }
        }
        
        // Start reminder check
        setTimeout(checkReminder, 10000);
        
        // ========== EXPORT FUNCTIONS ==========
        window.showLogin = showLogin;
        window.showRegister = showRegister;
        window.toggleTokenSection = toggleTokenSection;
        window.showTokenHelp = showTokenHelp;
        window.selectAccountType = selectAccountType;
        window.confirmAccountType = confirmAccountType;
        window.nextTutorialStep = nextTutorialStep;
        window.prevTutorialStep = prevTutorialStep;
        window.skipTutorial = skipTutorial;
        window.finishTutorial = finishTutorial;
        window.showTab = showTab;
        window.openSettings = openSettings;
        window.editEquity = editEquity;
        window.openLogoutModal = openLogoutModal;
        window.closeLogoutModal = closeLogoutModal;
        window.confirmLogout = confirmLogout;
        window.addTrade = addTrade;
        window.updateCurrentPnl = updateCurrentPnl;
        window.addWithdrawal = addWithdrawal;
        window.showAllWithdrawals = showAllWithdrawals;
        window.exportWithdrawals = exportWithdrawals;
        window.addJournal = addJournal;
        window.addItem = addItem;
        window.sendAiMessage = sendAiMessage;
        window.openLotCalculator = openLotCalculator;
        window.closeLotCalculator = closeLotCalculator;
        window.calculateLot = calculateLot;
        window.closeRecommendation = closeRecommendation;
        window.saveProfile = saveProfile;
        window.previewBg = previewBg;
        window.exportData = exportData;
        window.importData = importData;
        window.clearAllData = clearAllData;
        window.switchAccountType = switchAccountType;
        window.resetTutorial = resetTutorial;
        window.openTradingViewWeb = openTradingViewWeb;
        
    </script>
</body>
</html>
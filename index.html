<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trading Journal - Multi Currency</title>
<style>
:root {
    --green: #2fa37a;
    --red: #e5533d;
    --soft-green: rgba(47, 163, 122, 0.1);
    --soft-red: rgba(229, 83, 61, 0.1);
    --bg: #f0f2f5;
    --blue: #4a6491;
    --dark-blue: #1a2b3c;
    --gray: #7f8c8d;
    --light-gray: #e9ecef;
    --purple: #9b59b6;
    --orange: #e67e22;
    --yellow: #f1c40f;
    --idr-green: #27ae60;
    --fomo-color: #e74c3c;
    --santai-color: #2ecc71;
    --ragu-color: #f39c12;
    --card-bg: rgba(255, 255, 255, 0.95);
    --gradient-1: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    --gradient-2: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    --gradient-3: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    --gradient-green: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
    --gradient-blue: linear-gradient(135deg, #4a6491 0%, #2c3e50 100%);
}

* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
}

body {
    padding: 15px;
    max-width: 1200px;
    margin: 0 auto;
    background: var(--gradient-1);
    background-attachment: fixed;
    min-height: 100vh;
    background-size: 400% 400%;
}

/* Notification Toast */
.notification-toast {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 9999;
    max-width: 300px;
}

.notification {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 12px;
    padding: 15px;
    margin-bottom: 10px;
    box-shadow: 0 8px 30px rgba(0,0,0,0.2);
    backdrop-filter: blur(10px);
    animation: slideIn 0.3s ease, fadeOut 0.3s ease 2.7s forwards;
    border-left: 4px solid var(--green);
    display: none;
}

.notification.success { border-left-color: var(--green); }
.notification.error { border-left-color: var(--red); }
.notification.warning { border-left-color: var(--orange); }
.notification.info { border-left-color: var(--blue); }

@keyframes slideIn {
    from { transform: translateX(400px); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
}

@keyframes fadeOut {
    from { opacity: 1; transform: translateX(0); }
    to { opacity: 0; transform: translateX(400px); }
}

/* Main Container */
.container {
    display: grid;
    grid-template-columns: 1fr;
    gap: 20px;
}

/* Header Section */
.header-section {
    background: var(--card-bg);
    border-radius: 20px;
    padding: 25px;
    box-shadow: 0 20px 40px rgba(0,0,0,0.1);
    margin-bottom: 20px;
    border: 1px solid rgba(255,255,255,0.2);
    position: relative;
    overflow: hidden;
}

.header-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: var(--gradient-green);
}

.header-title {
    font-size: 1.8rem;
    color: var(--dark-blue);
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 12px;
}

/* Account Selector */
.account-selector {
    display: flex;
    gap: 10px;
    margin-bottom: 25px;
    flex-wrap: wrap;
}

.account-tab {
    padding: 12px 20px;
    border: 2px solid transparent;
    border-radius: 12px;
    background: white;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    gap: 8px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.08);
}

.account-tab:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}

.account-tab.active {
    border-color: var(--blue);
    background: var(--blue);
    color: white;
    box-shadow: 0 8px 25px rgba(74, 100, 145, 0.3);
}

.account-tab.usd.active { background: var(--gradient-green); border-color: transparent; }
.account-tab.cent.active { background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%); border-color: transparent; }
.account-tab.idr.active { background: linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%); border-color: transparent; }

.account-badge {
    background: rgba(255,255,255,0.2);
    padding: 4px 10px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
}

.delete-account-btn {
    background: rgba(229, 83, 61, 0.1);
    color: var(--red);
    border: 1px solid rgba(229, 83, 61, 0.3);
    border-radius: 50%;
    width: 22px;
    height: 22px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 12px;
    margin-left: 6px;
    transition: all 0.3s;
}

.delete-account-btn:hover {
    background: var(--red);
    color: white;
    transform: scale(1.1);
}

/* Exchange Rate Info */
.exchange-info {
    background: rgba(255, 255, 255, 0.9);
    padding: 18px;
    border-radius: 16px;
    margin: 20px 0;
    border: 1px solid rgba(255,255,255,0.3);
    box-shadow: 0 8px 32px rgba(0,0,0,0.1);
}

.exchange-controls {
    display: flex;
    gap: 10px;
    align-items: center;
    margin-top: 12px;
}

.refresh-btn {
    background: var(--gradient-3);
    color: white;
    border: none;
    border-radius: 10px;
    padding: 8px 16px;
    cursor: pointer;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 6px;
    transition: all 0.3s;
    box-shadow: 0 4px 15px rgba(79, 172, 254, 0.3);
}

.refresh-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(79, 172, 254, 0.4);
}

/* Balance Display */
.balance-display {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 25px;
    margin-top: 20px;
}

.current-balance, .initial-capital {
    background: var(--card-bg);
    padding: 25px;
    border-radius: 20px;
    border: 1px solid rgba(255,255,255,0.3);
    box-shadow: 0 15px 35px rgba(0,0,0,0.1);
    position: relative;
    overflow: hidden;
    transition: transform 0.3s;
}

.current-balance:hover, .initial-capital:hover {
    transform: translateY(-5px);
}

.current-balance::before, .initial-capital::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 6px;
}

.current-balance::before {
    background: var(--gradient-green);
}

.initial-capital::before {
    background: var(--gradient-blue);
}

.balance-label {
    font-size: 0.9rem;
    color: var(--gray);
    margin-bottom: 8px;
    font-weight: 600;
    letter-spacing: 0.5px;
}

.balance-amount {
    font-size: 2.2rem;
    font-weight: 800;
    margin: 10px 0;
    color: var(--dark-blue);
}

.current-balance .balance-amount {
    background: var(--gradient-green);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.initial-capital .balance-amount {
    background: var(--gradient-blue);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.growth-display {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 15px;
    padding-top: 15px;
    border-top: 1px solid rgba(0,0,0,0.1);
}

.growth-badge {
    padding: 8px 16px;
    border-radius: 20px;
    font-weight: 700;
    font-size: 0.9rem;
    letter-spacing: 0.5px;
}

.growth-positive {
    background: var(--soft-green);
    color: var(--green);
    box-shadow: 0 4px 15px rgba(47, 163, 122, 0.2);
}

.growth-negative {
    background: var(--soft-red);
    color: var(--red);
    box-shadow: 0 4px 15px rgba(229, 83, 61, 0.2);
}

.btn-edit {
    background: var(--blue);
    color: white;
    border: none;
    padding: 6px 12px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.85rem;
    font-weight: 600;
    transition: all 0.3s;
    margin-top: 10px;
}

.btn-edit:hover {
    background: var(--dark-blue);
    transform: translateY(-2px);
}

/* Main Cards */
.form-card, .calendar-card, .stats-card, .trades-card {
    background: var(--card-bg);
    border-radius: 20px;
    padding: 25px;
    box-shadow: 0 20px 40px rgba(0,0,0,0.1);
    border: 1px solid rgba(255,255,255,0.3);
    position: relative;
    overflow: hidden;
}

.form-card::before, .calendar-card::before, .stats-card::before, .trades-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 6px;
}

.form-card::before { background: var(--gradient-1); }
.calendar-card::before { background: var(--gradient-2); }
.stats-card::before { background: var(--gradient-3); }
.trades-card::before { background: var(--gradient-blue); }

.form-card h2 {
    color: var(--dark-blue);
    margin-bottom: 25px;
    font-size: 1.4rem;
    display: flex;
    align-items: center;
    gap: 12px;
}

/* Account Indicator */
.account-indicator {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 700;
    background: var(--gradient-blue);
    color: white;
    box-shadow: 0 4px 15px rgba(74, 100, 145, 0.3);
}

/* Form Elements */
.form-group {
    margin-bottom: 20px;
}

label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: var(--dark-blue);
    font-size: 0.95rem;
}

input, select, textarea {
    width: 100%;
    padding: 14px 18px;
    border: 2px solid #e1e5e9;
    border-radius: 12px;
    font-size: 15px;
    background: white;
    transition: all 0.3s;
    box-shadow: 0 4px 15px rgba(0,0,0,0.05);
}

input:focus, select:focus, textarea:focus {
    outline: none;
    border-color: var(--blue);
    box-shadow: 0 4px 20px rgba(74, 100, 145, 0.2);
    transform: translateY(-2px);
}

/* Feeling Option */
.feeling-option {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
    margin-bottom: 20px;
}

.feeling-btn {
    padding: 16px 10px;
    border: 2px solid transparent;
    border-radius: 15px;
    background: white;
    cursor: pointer;
    font-weight: 700;
    text-align: center;
    transition: all 0.3s;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    font-size: 0.95rem;
    box-shadow: 0 6px 20px rgba(0,0,0,0.08);
}

.feeling-btn:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 30px rgba(0,0,0,0.15);
}

.feeling-btn.selected {
    transform: translateY(-4px);
    box-shadow: 0 12px 30px rgba(0,0,0,0.2);
}

.feeling-fomo {
    border-color: var(--fomo-color);
    color: var(--fomo-color);
}

.feeling-fomo.selected {
    background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
    color: var(--fomo-color);
}

.feeling-santai {
    border-color: var(--santai-color);
    color: var(--santai-color);
}

.feeling-santai.selected {
    background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
    color: var(--santai-color);
}

.feeling-ragu {
    border-color: var(--ragu-color);
    color: var(--ragu-color);
}

.feeling-ragu.selected {
    background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
    color: var(--ragu-color);
}

/* Profit/Loss Button */
.profit-loss-option {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
    margin-bottom: 25px;
}

.profit-loss-btn {
    padding: 20px;
    border: 2px solid transparent;
    border-radius: 15px;
    background: white;
    cursor: pointer;
    font-weight: 700;
    text-align: center;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    font-size: 1.1rem;
    box-shadow: 0 8px 25px rgba(0,0,0,0.1);
}

.profit-loss-btn:hover {
    transform: translateY(-4px);
    box-shadow: 0 15px 35px rgba(0,0,0,0.2);
}

.profit-btn {
    border-color: var(--green);
    color: var(--green);
}

.profit-btn.selected {
    background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
    color: white;
    border-color: transparent;
}

.loss-btn {
    border-color: var(--red);
    color: var(--red);
}

.loss-btn.selected {
    background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
    color: white;
    border-color: transparent;
}

/* Main Button */
.btn {
    padding: 16px 30px;
    border: none;
    border-radius: 12px;
    background: var(--gradient-blue);
    color: white;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s;
    width: 100%;
    font-size: 1rem;
    box-shadow: 0 8px 25px rgba(74, 100, 145, 0.3);
}

.btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 15px 35px rgba(74, 100, 145, 0.4);
}

.btn-success {
    background: var(--gradient-green);
    box-shadow: 0 8px 25px rgba(67, 233, 123, 0.3);
}

.btn-success:hover {
    box-shadow: 0 15px 35px rgba(67, 233, 123, 0.4);
}

/* Chart Upload */
.chart-upload {
    border: 3px dashed rgba(74, 100, 145, 0.3);
    border-radius: 16px;
    padding: 25px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s;
    background: rgba(255,255,255,0.7);
    margin-bottom: 20px;
}

.chart-upload:hover {
    border-color: var(--blue);
    background: rgba(255,255,255,0.9);
    transform: translateY(-3px);
    box-shadow: 0 12px 30px rgba(0,0,0,0.1);
}

/* Calendar */
.calendar-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding: 15px;
    background: rgba(255,255,255,0.7);
    border-radius: 15px;
}

.month-label {
    font-weight: 700;
    font-size: 1.3rem;
    color: var(--dark-blue);
}

.summary-box {
    background: rgba(255,255,255,0.8);
    border-radius: 15px;
    padding: 18px;
    text-align: center;
    margin-bottom: 20px;
    font-weight: 700;
    font-size: 1.1rem;
}

.days-header {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    font-size: 0.9rem;
    color: var(--gray);
    text-align: center;
    margin-bottom: 15px;
    font-weight: 600;
    text-transform: uppercase;
}

.calendar-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 8px;
}

.calendar-cell {
    border-radius: 12px;
    padding: 12px 8px;
    text-align: center;
    font-size: 0.95rem;
    min-height: 70px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    cursor: pointer;
    transition: all 0.3s;
    background: white;
    border: 2px solid transparent;
    position: relative;
    overflow: hidden;
}

.calendar-cell:hover {
    transform: translateY(-5px);
    box-shadow: 0 12px 30px rgba(0,0,0,0.15);
    z-index: 1;
}

.calendar-cell.positive {
    background: linear-gradient(135deg, rgba(67, 233, 123, 0.15) 0%, rgba(56, 249, 215, 0.15) 100%);
    border-color: rgba(67, 233, 123, 0.3);
}

.calendar-cell.negative {
    background: linear-gradient(135deg, rgba(255, 154, 158, 0.15) 0%, rgba(254, 207, 239, 0.15) 100%);
    border-color: rgba(255, 154, 158, 0.3);
}

.calendar-cell.neutral {
    background: rgba(255,255,255,0.7);
    border-color: rgba(0,0,0,0.1);
}

.day-number {
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--dark-blue);
}

.pnl-amount {
    font-size: 0.85rem;
    font-weight: 700;
    margin-top: 5px;
    padding: 4px 8px;
    border-radius: 8px;
    background: rgba(255,255,255,0.8);
}

.calendar-cell.positive .pnl-amount { color: var(--green); }
.calendar-cell.negative .pnl-amount { color: var(--red); }

.trade-count {
    font-size: 0.75rem;
    color: var(--gray);
    background: rgba(255,255,255,0.8);
    border-radius: 10px;
    padding: 2px 6px;
    margin-top: 5px;
}

/* Statistics */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 20px;
    margin-top: 25px;
}

.stat-item {
    background: rgba(255, 255, 255, 0.7);
    border-radius: 16px;
    padding: 25px;
    text-align: center;
    transition: all 0.3s;
    border: 1px solid rgba(255,255,255,0.3);
    position: relative;
    overflow: hidden;
}

.stat-item:hover {
    transform: translateY(-8px);
    box-shadow: 0 20px 40px rgba(0,0,0,0.15);
}

.stat-item::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 6px;
}

.stat-item:nth-child(1)::before { background: var(--gradient-green); }
.stat-item:nth-child(2)::before { background: var(--gradient-2); }
.stat-item:nth-child(3)::before { background: var(--gradient-3); }
.stat-item:nth-child(4)::before { background: var(--gradient-1); }

.stat-value {
    font-size: 1.8rem;
    font-weight: 800;
    margin: 10px 0;
}

.stat-positive .stat-value { 
    background: var(--gradient-green);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.stat-negative .stat-value { 
    background: var(--gradient-2);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.stat-neutral .stat-value { 
    background: var(--gradient-blue);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.stat-label {
    font-size: 0.9rem;
    color: var(--gray);
    font-weight: 600;
}

/* Feeling Stats */
.feeling-stats {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 15px;
    margin-top: 25px;
}

.feeling-stat-item {
    background: rgba(255, 255, 255, 0.7);
    border-radius: 16px;
    padding: 20px;
    text-align: center;
    border: 1px solid rgba(255,255,255,0.3);
    transition: transform 0.3s;
}

.feeling-stat-item:hover {
    transform: translateY(-5px);
}

/* Trades Table */
.trades-table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0 10px;
    margin-top: 15px;
}

.trades-table th {
    text-align: left;
    padding: 18px 20px;
    background: rgba(255,255,255,0.7);
    color: var(--dark-blue);
    font-weight: 700;
    font-size: 0.95rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border: none;
}

.trades-table th:first-child {
    border-radius: 12px 0 0 12px;
}

.trades-table th:last-child {
    border-radius: 0 12px 12px 0;
}

.trades-table td {
    padding: 20px;
    background: rgba(255,255,255,0.8);
    border: none;
    font-size: 0.95rem;
    transition: all 0.3s;
}

.trades-table tbody tr {
    transition: transform 0.3s;
}

.trades-table tbody tr:hover {
    transform: translateY(-5px);
}

.trades-table tbody tr:hover td {
    background: rgba(255,255,255,0.95);
    box-shadow: 0 10px 25px rgba(0,0,0,0.1);
}

.trades-table td:first-child {
    border-radius: 12px 0 0 12px;
}

.trades-table td:last-child {
    border-radius: 0 12px 12px 0;
}

/* Footer */
.footer {
    text-align: center;
    margin-top: 30px;
    padding: 25px;
    color: white;
    font-size: 0.9rem;
    background: var(--gradient-blue);
    border-radius: 20px;
    box-shadow: 0 20px 40px rgba(0,0,0,0.2);
    position: relative;
    overflow: hidden;
}

.footer::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: var(--gradient-green);
}

/* Modal */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    justify-content: center;
    align-items: center;
    z-index: 1000;
    padding: 20px;
}

.modal-content {
    background: var(--card-bg);
    padding: 30px;
    border-radius: 25px;
    width: 100%;
    max-width: 450px;
    box-shadow: 0 30px 60px rgba(0,0,0,0.3);
    border: 1px solid rgba(255,255,255,0.3);
    animation: modalAppear 0.4s;
}

@keyframes modalAppear {
    from { opacity: 0; transform: translateY(30px) scale(0.9); }
    to { opacity: 1; transform: translateY(0) scale(1); }
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 25px;
    padding-bottom: 15px;
    border-bottom: 2px solid rgba(0,0,0,0.1);
}

.modal-title {
    font-size: 1.4rem;
    color: var(--dark-blue);
    font-weight: 700;
}

.close-btn {
    background: rgba(0,0,0,0.1);
    border: none;
    font-size: 1.8rem;
    cursor: pointer;
    color: var(--gray);
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s;
}

.close-btn:hover {
    background: rgba(0,0,0,0.2);
    transform: rotate(90deg);
}

/* Responsive Design */
@media (min-width: 768px) {
    .container {
        grid-template-columns: 1fr 1fr;
    }
    
    .header-section,
    .stats-card,
    .trades-card {
        grid-column: 1 / -1;
    }
}

@media (max-width: 768px) {
    .container {
        grid-template-columns: 1fr;
        gap: 15px;
    }
    
    .header-section, .form-card, .calendar-card, .stats-card, .trades-card {
        padding: 20px;
    }
    
    .balance-display {
        grid-template-columns: 1fr;
        gap: 15px;
    }
    
    .feeling-option, .profit-loss-option {
        grid-template-columns: 1fr;
    }
    
    .stats-grid {
        grid-template-columns: 1fr 1fr;
    }
    
    .feeling-stats {
        grid-template-columns: 1fr;
    }
    
    .account-selector {
        overflow-x: auto;
        padding-bottom: 10px;
    }
    
    .trades-table {
        display: block;
        overflow-x: auto;
    }
    
    .calendar-cell {
        min-height: 60px;
        padding: 8px 4px;
    }
}

@media (max-width: 480px) {
    body {
        padding: 10px;
    }
    
    .header-title {
        font-size: 1.4rem;
    }
    
    .balance-amount {
        font-size: 1.8rem;
    }
    
    .stats-grid {
        grid-template-columns: 1fr;
    }
    
    .modal-content {
        padding: 20px;
    }
}

/* Scrollbar Styling */
::-webkit-scrollbar {
    width: 8px;
}

::-webkit-scrollbar-track {
    background: rgba(255,255,255,0.1);
    border-radius: 4px;
}

::-webkit-scrollbar-thumb {
    background: var(--gradient-1);
    border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
    background: var(--gradient-2);
}

/* Loading Animation */
@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}

.loading {
    animation: pulse 1.5s ease-in-out infinite;
}
</style>
</head>
<body>

<!-- Notification Toast -->
<div class="notification-toast" id="notificationToast"></div>

<!-- Modal Update Modal -->
<div id="capitalModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">üí∞ Update Modal</h3>
            <button class="close-btn" onclick="closeCapitalModal()">&times;</button>
        </div>
        <div class="form-group">
            <label id="capitalLabel">Jumlah Modal Baru</label>
            <input type="number" id="newCapital" placeholder="Contoh: 1000" min="0" step="0.01" required>
            <div id="capitalInfo" style="font-size: 0.85rem; color: var(--orange); margin-top: 5px; display: none;"></div>
        </div>
        <button class="btn btn-success" onclick="updateInitialCapital()">
            Update Modal
        </button>
    </div>
</div>

<!-- Modal Detail Hari -->
<div id="dayDetailModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title" id="dayDetailTitle">Detail Trading</h3>
            <button class="close-btn" onclick="closeDayDetailModal()">&times;</button>
        </div>
        <div id="dayDetailContent"></div>
    </div>
</div>

<!-- Modal Add Account -->
<div id="addAccountModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">‚ûï Tambah Account</h3>
            <button class="close-btn" onclick="closeAddAccountModal()">&times;</button>
        </div>
        <div class="form-group">
            <label>Nama Account</label>
            <input type="text" id="newAccountName" placeholder="Contoh: Akun Cent Saya" required>
        </div>
        <div class="form-group">
            <label>Tipe Currency</label>
            <select id="newAccountType">
                <option value="usd">USD Account</option>
                <option value="cent">Cent Account</option>
                <option value="idr">Rupiah Account</option>
            </select>
        </div>
        <div class="form-group">
            <label>Modal Awal</label>
            <input type="number" id="newAccountCapital" placeholder="Contoh: 1000" min="0" step="0.01" required>
            <div id="newAccountInfo" style="font-size: 0.85rem; color: var(--orange); margin-top: 5px; display: none;"></div>
        </div>
        <button class="btn btn-success" onclick="addNewAccount()">
            Buat Account Baru
        </button>
    </div>
</div>

<!-- Modal Delete Account -->
<div id="deleteAccountModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">üóëÔ∏è Hapus Account</h3>
            <button class="close-btn" onclick="closeDeleteAccountModal()">&times;</button>
        </div>
        <div id="deleteAccountContent"></div>
    </div>
</div>

<!-- Main Layout -->
<div class="header-section">
    <h1 class="header-title">üí∞ Trading Journal</h1>
    
    <!-- Account Selector -->
    <div class="account-selector" id="accountTabs"></div>
    
    <!-- Exchange Rate Info -->
    <div class="exchange-info">
        <div><strong>üí± Kurs Live:</strong> 1 USD = <span id="usdToCentDisplay">100</span> CENT = <span id="usdToIdrDisplay">15,000</span> IDR</div>
        <div class="exchange-controls">
            <button class="refresh-btn" onclick="fetchLiveExchangeRate()">
                üîÑ Update Kurs
            </button>
            <small id="exchangeTime" style="color: var(--gray); margin-left: auto;">Terakhir: -</small>
        </div>
    </div>
    
    <!-- Balance Display -->
    <div class="balance-display">
        <div class="current-balance">
            <div class="balance-label">SALDO SAAT INI</div>
            <div class="balance-amount" id="currentBalance">$0.00</div>
            <div class="growth-display">
                <div>
                    <small style="color: var(--gray);">Total P/L:</small>
                    <span id="totalProfitDisplay" style="font-weight: 700;">$0.00</span>
                </div>
                <div class="growth-badge growth-positive" id="growthDisplay">+0.00%</div>
            </div>
        </div>
        
        <div class="initial-capital">
            <div class="balance-label">MODAL AWAL</div>
            <div class="balance-amount" id="initialCapitalDisplay">$0.00</div>
            <button class="btn-edit" onclick="showCapitalModal()">
                ‚úèÔ∏è Edit Modal
            </button>
        </div>
    </div>
</div>

<div class="container">
    <!-- Form Input Trading -->
    <div class="form-card">
        <h2>
            ‚ûï Input Trading 
            <span class="account-indicator" id="currentAccountBadge">USD</span>
        </h2>
        
        <div class="cent-info" id="formCentInfo" style="display: none; margin-bottom: 15px; padding: 12px; background: rgba(255, 234, 167, 0.3); border-radius: 12px; border-left: 4px solid var(--orange);">
            <strong>üéØ Cent Account:</strong> Input dalam CENT (100 CENT = 1 USD)
        </div>
        
        <form id="tradeForm">
            <div class="form-group">
                <label>üìÖ Tanggal Trading</label>
                <input type="date" id="tradeDate" required>
            </div>
            
            <div class="form-group">
                <label>üìä Pasangan Pair</label>
                <input type="text" id="pair" placeholder="BTC/USDT" required>
            </div>
            
            <div class="form-group">
                <label>‚ÜïÔ∏è Arah Trading</label>
                <select id="direction" required>
                    <option value="BUY">üìà BUY/Long</option>
                    <option value="SELL">üìâ SELL/Short</option>
                </select>
            </div>
            
            <!-- Feeling -->
            <div class="form-group">
                <label>üòä Rasa Trading</label>
                <div class="feeling-option">
                    <div class="feeling-btn feeling-fomo" id="fomoBtn" onclick="selectFeeling('fomo')">
                        <span style="font-size: 1.5rem;">üî•</span>
                        <span>FOMO</span>
                    </div>
                    <div class="feeling-btn feeling-santai" id="santaiBtn" onclick="selectFeeling('santai')">
                        <span style="font-size: 1.5rem;">üòå</span>
                        <span>Santai</span>
                    </div>
                    <div class="feeling-btn feeling-ragu" id="raguBtn" onclick="selectFeeling('ragu')">
                        <span style="font-size: 1.5rem;">ü§î</span>
                        <span>Ragu</span>
                    </div>
                </div>
                <input type="hidden" id="feelingType" value="santai">
            </div>
            
            <!-- Profit/Loss -->
            <div class="profit-loss-option">
                <div class="profit-loss-btn profit-btn" id="profitBtn" onclick="selectProfitLoss('profit')">
                    <span style="font-size: 1.5rem;">üìà</span>
                    <span>PROFIT</span>
                </div>
                <div class="profit-loss-btn loss-btn" id="lossBtn" onclick="selectProfitLoss('loss')">
                    <span style="font-size: 1.5rem;">üìâ</span>
                    <span>LOSS</span>
                </div>
            </div>
            <input type="hidden" id="profitLossType" value="profit">
            
            <div class="form-group">
                <label id="amountLabel">üí∞ Jumlah</label>
                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 12px;">
                    <input type="number" id="profitAmount" placeholder="280" min="0" step="0.01" required>
                    <div style="background: var(--gradient-blue); color: white; padding: 14px; border-radius: 12px; text-align: center; font-weight: 700; font-size: 1.1rem;">
                        <span id="currencyDisplay">USD</span>
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label>üíµ Hasil dalam <span id="displayCurrencyLabel">USD</span></label>
                <input type="text" id="profitDisplay" readonly style="background: rgba(255,255,255,0.8); font-weight: 700; font-size: 1.1rem;">
            </div>
            
            <!-- Chart Upload -->
            <div class="chart-upload" onclick="document.getElementById('chartFile').click()">
                <div style="font-size: 2rem; margin-bottom: 10px;">üìä</div>
                <div style="font-size: 0.95rem; color: var(--dark-blue); font-weight: 600;">Upload Chart Screenshot</div>
                <div style="font-size: 0.85rem; color: var(--gray); margin-top: 5px;">Klik atau drag & drop</div>
                <input type="file" id="chartFile" accept="image/*" style="display: none;" onchange="handleChartUpload(event)">
                <img id="chartPreview" style="max-width: 100%; max-height: 200px; margin-top: 15px; border-radius: 12px; display: none; border: 3px solid rgba(255,255,255,0.5);">
                <button type="button" onclick="removeChart(event)" style="display: none; margin-top: 10px; background: var(--gradient-2); color: white; border: none; padding: 8px 20px; border-radius: 8px; cursor: pointer; font-weight: 600;" id="removeChartBtn">Hapus Chart</button>
            </div>
            
            <div class="form-group">
                <label>üìù Catatan (Opsional)</label>
                <textarea id="notes" rows="3" placeholder="Strategi, emosi, atau catatan penting trading..."></textarea>
            </div>
            
            <button type="submit" class="btn btn-success">
                üí∞ Simpan Trading
            </button>
        </form>
    </div>

    <!-- Kalender PnL -->
    <div class="calendar-card">
        <div class="calendar-header">
            <button onclick="changeMonth(-1)" style="background: var(--gradient-2); color: white; border: none; padding: 10px 15px; border-radius: 10px; cursor: pointer; font-weight: 700;">‚óÄ</button>
            <span class="month-label" id="monthLabel"></span>
            <button onclick="changeMonth(1)" style="background: var(--gradient-2); color: white; border: none; padding: 10px 15px; border-radius: 10px; cursor: pointer; font-weight: 700;">‚ñ∂</button>
        </div>
        
        <div class="summary-box" id="monthSummary">
            Total PnL Bulan Ini: $0.00
        </div>
        
        <div class="days-header">
            <div>Min</div><div>Sen</div><div>Sel</div><div>Rab</div><div>Kam</div><div>Jum</div><div>Sab</div>
        </div>
        
        <div class="calendar-grid" id="calendarGrid"></div>
    </div>

    <!-- Statistics -->
    <div class="stats-card">
        <h2>üìä Statistik Performa</h2>
        
        <div class="feeling-stats" id="feelingStats">
            <div class="feeling-stat-item">
                <div style="font-size: 1.2rem; margin-bottom: 5px;">üî•</div>
                <div style="font-size: 0.9rem; color: var(--fomo-color); font-weight: 700;">FOMO</div>
                <div class="stat-value">0</div>
                <div style="font-size: 0.8rem; color: var(--gray);">trading</div>
            </div>
            <div class="feeling-stat-item">
                <div style="font-size: 1.2rem; margin-bottom: 5px;">üòå</div>
                <div style="font-size: 0.9rem; color: var(--santai-color); font-weight: 700;">Santai</div>
                <div class="stat-value">0</div>
                <div style="font-size: 0.8rem; color: var(--gray);">trading</div>
            </div>
            <div class="feeling-stat-item">
                <div style="font-size: 1.2rem; margin-bottom: 5px;">ü§î</div>
                <div style="font-size: 0.9rem; color: var(--ragu-color); font-weight: 700;">Ragu</div>
                <div class="stat-value">0</div>
                <div style="font-size: 0.8rem; color: var(--gray);">trading</div>
            </div>
        </div>
        
        <div class="stats-grid">
            <div class="stat-item">
                <div class="stat-label">üìà Profit Terbesar</div>
                <div class="stat-value stat-positive" id="statMaxProfit">$0.00</div>
                <div class="stat-label" id="statMaxProfitDate">-</div>
            </div>
            
            <div class="stat-item">
                <div class="stat-label">üìâ Loss Terbesar</div>
                <div class="stat-value stat-negative" id="statMaxLoss">$0.00</div>
                <div class="stat-label" id="statMaxLossDate">-</div>
            </div>
            
            <div class="stat-item">
                <div class="stat-label">üìä Total Trading</div>
                <div class="stat-value stat-neutral" id="statTotalTrades">0</div>
                <div class="stat-label">Transaksi</div>
            </div>
            
            <div class="stat-item">
                <div class="stat-label">üéØ Win Rate</div>
                <div class="stat-value stat-neutral" id="statWinRate">0%</div>
                <div class="stat-label">Rasio Menang</div>
            </div>
        </div>
    </div>

    <!-- Riwayat Trading -->
    <div class="trades-card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h2 style="margin: 0;">üìã Riwayat Trading</h2>
            <div style="display: flex; gap: 10px;">
                <button onclick="showAddAccountModal()" style="background: var(--gradient-3); color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer; font-weight: 700;">
                    ‚ûï Account
                </button>
                <button onclick="toggleCurrencyDisplay()" id="toggleCurrencyBtn" style="background: var(--gradient-1); color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer; font-weight: 700; display: none;">
                    üí± Tampilkan IDR
                </button>
            </div>
        </div>
        <div id="tradesList">
            <div style="text-align: center; padding: 40px; background: rgba(255,255,255,0.7); border-radius: 15px;">
                <div style="font-size: 3rem; margin-bottom: 15px; opacity: 0.5;">üìä</div>
                <div style="font-size: 1.1rem; color: var(--dark-blue); font-weight: 700; margin-bottom: 10px;">Belum ada trading</div>
                <div style="color: var(--gray); font-size: 0.9rem;">Tambahkan trading pertama Anda!</div>
            </div>
        </div>
    </div>
</div>

<div class="footer">
    <p style="margin-bottom: 10px; font-size: 0.95rem; opacity: 0.9;">Trading Journal ¬© 2023 | Data tersimpan di browser Anda</p>
    <div style="display: flex; gap: 12px; justify-content: center; flex-wrap: wrap;">
        <button onclick="exportData()" style="background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.3); padding: 8px 20px; border-radius: 8px; cursor: pointer; font-weight: 600;">
            üì§ Ekspor Data
        </button>
        <button onclick="importData()" style="background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.3); padding: 8px 20px; border-radius: 8px; cursor: pointer; font-weight: 600;">
            üì• Impor Data
        </button>
        <button onclick="clearAllData()" style="background: rgba(231, 76, 60, 0.2); color: white; border: 1px solid rgba(231, 76, 60, 0.3); padding: 8px 20px; border-radius: 8px; cursor: pointer; font-weight: 600;">
            üóëÔ∏è Hapus Semua
        </button>
    </div>
</div>

<script>
// Data Structure
let accounts = {
    "usd-account": {
        id: "usd-account",
        name: "USD Account",
        type: "usd",
        capital: 1000,
        trades: [],
        convertToIdr: false,
        createdAt: new Date().toISOString()
    }
};

let currentAccountId = "usd-account";
let currentMonth = new Date();
let displayInIdr = false;
let exchangeRates = {
    USD_IDR: 15000,
    CENT_USD: 100
};

let exchangeRateMeta = {
    lastUpdated: null,
    source: "default"
};

let chartDataUrl = null;

// Initialize
document.addEventListener('DOMContentLoaded', function() {
    loadData();
    setupEventListeners();
    renderAccountTabs();
    renderUI();
    
    // Set today's date
    document.getElementById('tradeDate').valueAsDate = new Date();
    
    // Event listeners
    document.getElementById('profitAmount').addEventListener('input', updateProfitDisplay);
    document.getElementById('newAccountType').addEventListener('change', updateCurrencyInfo);
    
    // Initial selections
    selectFeeling('santai');
    selectProfitLoss('profit');
    
    // Auto fetch exchange rate
    setTimeout(fetchLiveExchangeRate, 1000);
});

// Load from localStorage
function loadData() {
    try {
        const saved = localStorage.getItem('tradingAccountsMulti');
        if (saved) accounts = JSON.parse(saved);
        
        const rates = localStorage.getItem('exchangeRates');
        if (rates) exchangeRates = JSON.parse(rates);
        
        const display = localStorage.getItem('displayInIdr');
        if (display) displayInIdr = JSON.parse(display);
        
        const meta = localStorage.getItem('exchangeRateMeta');
        if (meta) exchangeRateMeta = JSON.parse(meta);
    } catch (error) {
        console.error('Error loading data:', error);
        showNotification('error', 'Gagal memuat data dari penyimpanan lokal');
    }
    
    updateExchangeRateDisplay();
}

// Save to localStorage
function saveData() {
    try {
        localStorage.setItem('tradingAccountsMulti', JSON.stringify(accounts));
        localStorage.setItem('exchangeRates', JSON.stringify(exchangeRates));
        localStorage.setItem('displayInIdr', JSON.stringify(displayInIdr));
        localStorage.setItem('exchangeRateMeta', JSON.stringify(exchangeRateMeta));
        renderUI();
    } catch (error) {
        console.error('Error saving data:', error);
        showNotification('error', 'Gagal menyimpan data ke penyimpanan lokal');
    }
}

// Setup event listeners
function setupEventListeners() {
    // Form submit
    document.getElementById('tradeForm').addEventListener('submit', function(e) {
        e.preventDefault();
        addTrade();
    });
}

// Show notification
function showNotification(type, message) {
    const toast = document.getElementById('notificationToast');
    const icon = type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ö†Ô∏è';
    
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.innerHTML = `
        <div style="display: flex; align-items: flex-start; gap: 10px;">
            <div style="font-size: 20px;">${icon}</div>
            <div style="font-size: 0.9rem;">${message}</div>
        </div>
    `;
    
    toast.appendChild(notification);
    notification.style.display = 'block';
    
    setTimeout(() => {
        notification.remove();
    }, 3000);
}

// Fetch live exchange rate
async function fetchLiveExchangeRate() {
    const btn = document.querySelector('.refresh-btn');
    const oldText = btn.innerHTML;
    btn.innerHTML = '‚è≥';
    
    try {
        const response = await fetch('https://api.exchangerate-api.com/v4/latest/USD');
        if (response.ok) {
            const data = await response.json();
            const idrRate = data.rates.IDR;
            
            if (idrRate) {
                exchangeRates.USD_IDR = Math.round(idrRate);
                exchangeRateMeta.lastUpdated = new Date().toISOString();
                exchangeRateMeta.source = 'ExchangeRate-API';
                
                saveData();
                updateExchangeRateDisplay();
                
                showNotification('success', `Kurs terupdate: 1 USD = ${idrRate.toLocaleString('id-ID')} IDR`);
            }
        }
    } catch (error) {
        // Fallback: use cached rate
        console.log('Using cached exchange rate');
        exchangeRateMeta.source = 'Cached';
        saveData();
        updateExchangeRateDisplay();
        showNotification('info', 'Menggunakan kurs yang tersimpan');
    } finally {
        btn.innerHTML = oldText;
    }
}

// Update exchange rate display
function updateExchangeRateDisplay() {
    document.getElementById('usdToCentDisplay').textContent = exchangeRates.CENT_USD;
    document.getElementById('usdToIdrDisplay').textContent = exchangeRates.USD_IDR.toLocaleString('id-ID');
    
    if (exchangeRateMeta.lastUpdated) {
        const time = new Date(exchangeRateMeta.lastUpdated);
        document.getElementById('exchangeTime').textContent = 
            `Terakhir: ${time.getHours().toString().padStart(2,'0')}:${time.getMinutes().toString().padStart(2,'0')}`;
    }
}

// Render account tabs
function renderAccountTabs() {
    const container = document.getElementById('accountTabs');
    let html = '';
    
    Object.keys(accounts).forEach(id => {
        const acc = accounts[id];
        const isActive = id === currentAccountId;
        const typeText = acc.type === 'cent' ? 'CENT' : acc.type === 'idr' ? 'IDR' : 'USD';
        const typeClass = acc.type;
        
        html += `
            <div class="account-tab ${typeClass} ${isActive ? 'active' : ''}" onclick="switchAccount('${id}')">
                <span>${acc.name}</span>
                <span class="account-badge">${typeText}</span>
                ${id !== "usd-account" ? `
                    <button class="delete-account-btn" onclick="deleteAccount('${id}', event)">√ó</button>
                ` : ''}
            </div>
        `;
    });
    
    html += `<div class="account-tab" onclick="showAddAccountModal()" style="border: 2px dashed #ccc;">+ Add</div>`;
    container.innerHTML = html;
}

// Switch account
function switchAccount(id) {
    currentAccountId = id;
    const currentAccount = accounts[currentAccountId];
    
    // Only show IDR toggle for non-IDR accounts
    const toggleBtn = document.getElementById('toggleCurrencyBtn');
    if (currentAccount.type === 'idr') {
        displayInIdr = true;
        toggleBtn.style.display = 'none';
    } else {
        displayInIdr = currentAccount.convertToIdr || false;
        toggleBtn.style.display = 'inline-block';
        toggleBtn.textContent = displayInIdr ? 'üíµ Tampilkan USD' : 'üí± Tampilkan IDR';
    }
    
    renderAccountTabs();
    renderUI();
}

// Delete account
function deleteAccount(id, event) {
    event.stopPropagation();
    if (id === "usd-account") {
        showNotification('warning', 'Account USD default tidak bisa dihapus');
        return;
    }
    
    if (confirm(`Hapus account "${accounts[id].name}"? Semua trading akan dihapus.`)) {
        const wasCurrent = id === currentAccountId;
        const accountName = accounts[id].name;
        delete accounts[id];
        
        if (wasCurrent) {
            const remaining = Object.keys(accounts);
            currentAccountId = remaining[0];
        }
        
        saveData();
        renderAccountTabs();
        renderUI();
        showNotification('warning', `Account "${accountName}" telah dihapus`);
    }
}

// Update UI
function renderUI() {
    updateAccountBadge();
    updateBalanceDisplay();
    updateProfitDisplay();
    renderCalendar();
    renderStatistics();
    renderTradesList();
}

// Update account badge
function updateAccountBadge() {
    const currentAccount = accounts[currentAccountId];
    const badge = document.getElementById('currentAccountBadge');
    const formCentInfo = document.getElementById('formCentInfo');
    
    if (currentAccount.type === 'cent') {
        badge.textContent = displayInIdr ? 'CENT ‚Üí IDR' : 'CENT ‚Üí USD';
        formCentInfo.style.display = 'block';
    } else if (currentAccount.type === 'idr') {
        badge.textContent = 'IDR';
        formCentInfo.style.display = 'none';
    } else {
        badge.textContent = 'USD';
        formCentInfo.style.display = 'none';
    }
}

// Update balance display
function updateBalanceDisplay() {
    const acc = accounts[currentAccountId];
    const trades = acc.trades || [];
    
    // Calculate totals
    const totalProfitUSD = trades.reduce((sum, t) => sum + t.profitUSD, 0);
    const totalProfitIDR = trades.reduce((sum, t) => sum + t.profitIDR, 0);
    
    // Current balance
    let currentBalanceUSD, currentBalanceIDR;
    if (acc.type === 'cent') {
        const capitalUSD = acc.capital / exchangeRates.CENT_USD;
        const capitalIDR = capitalUSD * exchangeRates.USD_IDR;
        currentBalanceUSD = capitalUSD + totalProfitUSD;
        currentBalanceIDR = capitalIDR + totalProfitIDR;
    } else if (acc.type === 'idr') {
        const capitalUSD = acc.capital / exchangeRates.USD_IDR;
        currentBalanceIDR = acc.capital + totalProfitIDR;
        currentBalanceUSD = capitalUSD + totalProfitUSD;
    } else {
        const capitalIDR = acc.capital * exchangeRates.USD_IDR;
        currentBalanceUSD = acc.capital + totalProfitUSD;
        currentBalanceIDR = capitalIDR + totalProfitIDR;
    }
    
    // Growth percentage
    const capitalUSD = acc.type === 'cent' ? acc.capital / exchangeRates.CENT_USD :
                     acc.type === 'idr' ? acc.capital / exchangeRates.USD_IDR : acc.capital;
    const growthPercent = capitalUSD > 0 ? (totalProfitUSD / capitalUSD * 100) : 0;
    
    // Update display
    if (displayInIdr || acc.type === 'idr') {
        document.getElementById('currentBalance').textContent = formatIDR(currentBalanceIDR);
        document.getElementById('totalProfitDisplay').textContent = 
            `${totalProfitIDR >= 0 ? '+' : ''}${formatIDR(totalProfitIDR)}`;
        document.getElementById('initialCapitalDisplay').textContent = 
            acc.type === 'idr' ? formatIDR(acc.capital) : formatIDR(acc.type === 'cent' ? 
                (acc.capital / exchangeRates.CENT_USD) * exchangeRates.USD_IDR : 
                acc.capital * exchangeRates.USD_IDR);
    } else {
        document.getElementById('currentBalance').textContent = `$${formatNumber(currentBalanceUSD)}`;
        document.getElementById('totalProfitDisplay').textContent = 
            `${totalProfitUSD >= 0 ? '+' : ''}$${formatNumber(totalProfitUSD)}`;
        document.getElementById('initialCapitalDisplay').textContent = 
            `$${formatNumber(acc.type === 'cent' ? acc.capital / exchangeRates.CENT_USD : 
                           acc.type === 'idr' ? acc.capital / exchangeRates.USD_IDR : acc.capital)}`;
    }
    
    document.getElementById('growthDisplay').textContent = 
        `${growthPercent >= 0 ? '+' : ''}${Math.abs(growthPercent).toFixed(2)}%`;
    document.getElementById('growthDisplay').className = 
        `growth-badge ${growthPercent >= 0 ? 'growth-positive' : 'growth-negative'}`;
}

// Render calendar
function renderCalendar() {
    const grid = document.getElementById('calendarGrid');
    const label = document.getElementById('monthLabel');
    const summary = document.getElementById('monthSummary');
    
    grid.innerHTML = '';
    const month = currentMonth.getMonth();
    const year = currentMonth.getFullYear();
    const monthNames = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 
                       'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];
    label.textContent = `${monthNames[month]} ${year}`;
    
    // Get trades for this month
    const acc = accounts[currentAccountId];
    const trades = acc.trades || [];
    const tradesByDate = {};
    let monthProfitUSD = 0;
    let monthTradeCount = 0;
    
    trades.forEach(t => {
        const date = new Date(t.date);
        if (date.getMonth() === month && date.getFullYear() === year) {
            const day = date.getDate();
            if (!tradesByDate[day]) tradesByDate[day] = { profitUSD: 0, profitIDR: 0, count: 0 };
            tradesByDate[day].profitUSD += t.profitUSD;
            tradesByDate[day].profitIDR += t.profitIDR;
            tradesByDate[day].count++;
            monthProfitUSD += t.profitUSD;
            monthTradeCount++;
        }
    });
    
    // Month summary
    if (displayInIdr || acc.type === 'idr') {
        const monthProfitIDR = trades.reduce((sum, t) => {
            const date = new Date(t.date);
            return date.getMonth() === month && date.getFullYear() === year ? sum + t.profitIDR : sum;
        }, 0);
        summary.textContent = `Total: ${monthProfitIDR >= 0 ? '+' : ''}${formatIDR(monthProfitIDR)} (${monthTradeCount} trading)`;
    } else {
        summary.textContent = `Total: ${monthProfitUSD >= 0 ? '+' : ''}$${formatNumber(monthProfitUSD)} (${monthTradeCount} trading)`;
    }
    summary.style.color = monthProfitUSD >= 0 ? 'var(--green)' : 'var(--red)';
    
    // Calendar days
    const firstDay = new Date(year, month, 1).getDay();
    const daysInMonth = new Date(year, month + 1, 0).getDate();
    
    // Empty cells for start
    for (let i = 0; i < firstDay; i++) {
        grid.innerHTML += '<div class="calendar-cell"></div>';
    }
    
    // Day cells
    for (let day = 1; day <= daysInMonth; day++) {
        const dayData = tradesByDate[day];
        let cellClass = 'calendar-cell';
        let content = `<div class="day-number">${day}</div>`;
        
        if (dayData) {
            const profit = displayInIdr || acc.type === 'idr' ? dayData.profitIDR : dayData.profitUSD;
            const sign = profit >= 0 ? '+' : '-';
            const amount = displayInIdr || acc.type === 'idr' ? 
                formatIDR(Math.abs(profit)) : `$${Math.abs(profit).toFixed(0)}`;
            
            cellClass += profit > 0 ? ' positive' : profit < 0 ? ' negative' : ' neutral';
            content += `<div class="pnl-amount">${sign}${amount}</div>`;
            if (dayData.count > 0) {
                content += `<div class="trade-count">${dayData.count}t</div>`;
            }
        }
        
        grid.innerHTML += `<div class="${cellClass}" onclick="showDayDetail(${year},${month+1},${day})">${content}</div>`;
    }
}

// Show day detail
function showDayDetail(year, month, day) {
    const dateKey = `${year}-${month.toString().padStart(2,'0')}-${day.toString().padStart(2,'0')}`;
    const acc = accounts[currentAccountId];
    const dayTrades = acc.trades.filter(t => t.date === dateKey);
    
    if (dayTrades.length === 0) {
        document.getElementById('dayDetailTitle').textContent = `Tidak ada trading pada ${day}/${month}/${year}`;
        document.getElementById('dayDetailContent').innerHTML = 
            '<p style="text-align: center; color: var(--gray); padding: 20px;">Tidak ada trading</p>';
    } else {
        const totalProfit = dayTrades.reduce((sum, t) => sum + (displayInIdr ? t.profitIDR : t.profitUSD), 0);
        
        let content = `
            <div style="margin-bottom: 15px;">
                <div style="font-weight: 600; margin-bottom: 5px;">Total: 
                    <span style="color: ${totalProfit >= 0 ? 'var(--green)' : 'var(--red)'}">
                        ${totalProfit >= 0 ? '+' : ''}${displayInIdr ? formatIDR(totalProfit) : `$${Math.abs(totalProfit).toFixed(2)}`}
                    </span>
                </div>
                <div style="font-size: 0.9rem; color: var(--gray);">
                    ${dayTrades.length} trading
                </div>
            </div>
        `;
        
        dayTrades.forEach(t => {
            const profit = displayInIdr ? t.profitIDR : t.profitUSD;
            const feelingIcon = t.feeling === 'fomo' ? 'üî•' : t.feeling === 'santai' ? 'üòå' : 'ü§î';
            
            content += `
                <div style="border: 1px solid #eee; border-radius: 8px; padding: 10px; margin-bottom: 8px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-weight: 600; color: ${t.direction === 'BUY' ? 'var(--green)' : 'var(--red)'}">
                                ${t.pair} ${t.direction}
                            </div>
                            <div style="font-size: 0.8rem; color: var(--gray);">
                                ${feelingIcon} ${t.feeling}
                            </div>
                        </div>
                        <div style="font-weight: 600; color: ${profit >= 0 ? 'var(--green)' : 'var(--red)'}">
                            ${profit >= 0 ? '+' : ''}${displayInIdr ? formatIDR(profit) : `$${Math.abs(profit).toFixed(2)}`}
                        </div>
                    </div>
                    ${t.notes ? `<div style="font-size: 0.85rem; margin-top: 5px; color: var(--gray);">"${t.notes}"</div>` : ''}
                </div>
            `;
        });
        
        document.getElementById('dayDetailContent').innerHTML = content;
        document.getElementById('dayDetailTitle').textContent = `Trading ${day}/${month}/${year}`;
    }
    
    document.getElementById('dayDetailModal').style.display = 'flex';
}

// Render statistics
function renderStatistics() {
    const acc = accounts[currentAccountId];
    const trades = acc.trades || [];
    
    if (trades.length === 0) {
        document.getElementById('statMaxProfit').textContent = displayInIdr ? 'IDR 0' : '$0.00';
        document.getElementById('statMaxLoss').textContent = displayInIdr ? 'IDR 0' : '$0.00';
        document.getElementById('statTotalTrades').textContent = '0';
        document.getElementById('statWinRate').textContent = '0%';
        
        document.getElementById('feelingStats').innerHTML = `
            <div class="feeling-stat-item">
                <div style="font-size: 1.2rem; margin-bottom: 5px;">üî•</div>
                <div style="font-size: 0.9rem; color: var(--fomo-color); font-weight: 700;">FOMO</div>
                <div class="stat-value">0</div>
                <div style="font-size: 0.8rem; color: var(--gray);">trading</div>
            </div>
            <div class="feeling-stat-item">
                <div style="font-size: 1.2rem; margin-bottom: 5px;">üòå</div>
                <div style="font-size: 0.9rem; color: var(--santai-color); font-weight: 700;">Santai</div>
                <div class="stat-value">0</div>
                <div style="font-size: 0.8rem; color: var(--gray);">trading</div>
            </div>
            <div class="feeling-stat-item">
                <div style="font-size: 1.2rem; margin-bottom: 5px;">ü§î</div>
                <div style="font-size: 0.9rem; color: var(--ragu-color); font-weight: 700;">Ragu</div>
                <div class="stat-value">0</div>
                <div style="font-size: 0.8rem; color: var(--gray);">trading</div>
            </div>
        `;
        return;
    }
    
    // Calculate stats
    const wins = trades.filter(t => t.profitUSD > 0);
    const losses = trades.filter(t => t.profitUSD < 0);
    const winRate = ((wins.length / trades.length) * 100).toFixed(1);
    
    // Max profit/loss
    const maxProfit = wins.length ? Math.max(...wins.map(t => t.profitUSD)) : 0;
    const maxLoss = losses.length ? Math.min(...losses.map(t => t.profitUSD)) : 0;
    
    // Update display
    if (displayInIdr || acc.type === 'idr') {
        document.getElementById('statMaxProfit').textContent = `+${formatIDR(maxProfit * exchangeRates.USD_IDR)}`;
        document.getElementById('statMaxLoss').textContent = `${formatIDR(maxLoss * exchangeRates.USD_IDR)}`;
    } else {
        document.getElementById('statMaxProfit').textContent = `+$${formatNumber(maxProfit)}`;
        document.getElementById('statMaxLoss').textContent = `$${formatNumber(maxLoss)}`;
    }
    
    document.getElementById('statTotalTrades').textContent = trades.length;
    document.getElementById('statWinRate').textContent = `${winRate}%`;
    
    // Feeling stats
    const fomoCount = trades.filter(t => t.feeling === 'fomo').length;
    const santaiCount = trades.filter(t => t.feeling === 'santai').length;
    const raguCount = trades.filter(t => t.feeling === 'ragu').length;
    
    document.getElementById('feelingStats').innerHTML = `
        <div class="feeling-stat-item">
            <div style="font-size: 1.2rem; margin-bottom: 5px;">üî•</div>
            <div style="font-size: 0.9rem; color: var(--fomo-color); font-weight: 700;">FOMO</div>
            <div class="stat-value">${fomoCount}</div>
            <div style="font-size: 0.8rem; color: var(--gray);">trading</div>
        </div>
        <div class="feeling-stat-item">
            <div style="font-size: 1.2rem; margin-bottom: 5px;">üòå</div>
            <div style="font-size: 0.9rem; color: var(--santai-color); font-weight: 700;">Santai</div>
            <div class="stat-value">${santaiCount}</div>
            <div style="font-size: 0.8rem; color: var(--gray);">trading</div>
        </div>
        <div class="feeling-stat-item">
            <div style="font-size: 1.2rem; margin-bottom: 5px;">ü§î</div>
            <div style="font-size: 0.9rem; color: var(--ragu-color); font-weight: 700;">Ragu</div>
            <div class="stat-value">${raguCount}</div>
            <div style="font-size: 0.8rem; color: var(--gray);">trading</div>
        </div>
    `;
}

// Render trades list
function renderTradesList() {
    const container = document.getElementById('tradesList');
    const acc = accounts[currentAccountId];
    const trades = acc.trades || [];
    
    if (trades.length === 0) {
        container.innerHTML = `
            <div style="text-align: center; padding: 40px; background: rgba(255,255,255,0.7); border-radius: 15px;">
                <div style="font-size: 3rem; margin-bottom: 15px; opacity: 0.5;">üìä</div>
                <div style="font-size: 1.1rem; color: var(--dark-blue); font-weight: 700; margin-bottom: 10px;">Belum ada trading</div>
                <div style="color: var(--gray); font-size: 0.9rem;">Tambahkan trading pertama Anda!</div>
            </div>
        `;
        return;
    }
    
    let html = `
        <div style="max-height: 400px; overflow-y: auto; padding-right: 5px;">
        <table class="trades-table">
            <thead>
                <tr>
                    <th>Tanggal</th>
                    <th>Pair</th>
                    <th>Arah</th>
                    <th>Rasa</th>
                    <th>P/L</th>
                    <th>Aksi</th>
                </tr>
            </thead>
            <tbody>
    `;
    
    trades.forEach(t => {
        const profit = displayInIdr ? t.profitIDR : t.profitUSD;
        const feelingIcon = t.feeling === 'fomo' ? 'üî•' : t.feeling === 'santai' ? 'üòå' : 'ü§î';
        
        html += `
            <tr>
                <td>${formatDate(t.date)}</td>
                <td>${t.pair}</td>
                <td style="color: ${t.direction === 'BUY' ? 'var(--green)' : 'var(--red)'}">${t.direction}</td>
                <td>${feelingIcon}</td>
                <td style="color: ${profit >= 0 ? 'var(--green)' : 'var(--red)'}; font-weight: 600;">
                    ${profit >= 0 ? '+' : ''}${displayInIdr ? formatIDR(profit) : `$${Math.abs(profit).toFixed(2)}`}
                </td>
                <td>
                    <button onclick="deleteTrade(${t.id})" style="background: none; border: none; color: var(--red); cursor: pointer; padding: 2px 6px; font-size: 0.9rem;">
                        üóëÔ∏è
                    </button>
                </td>
            </tr>
        `;
    });
    
    html += `</tbody></table></div>`;
    container.innerHTML = html;
}

// Select feeling
function selectFeeling(type) {
    const fomoBtn = document.getElementById('fomoBtn');
    const santaiBtn = document.getElementById('santaiBtn');
    const raguBtn = document.getElementById('raguBtn');
    
    fomoBtn.classList.remove('selected');
    santaiBtn.classList.remove('selected');
    raguBtn.classList.remove('selected');
    
    if (type === 'fomo') {
        fomoBtn.classList.add('selected');
    } else if (type === 'santai') {
        santaiBtn.classList.add('selected');
    } else {
        raguBtn.classList.add('selected');
    }
    
    document.getElementById('feelingType').value = type;
}

// Select profit/loss
function selectProfitLoss(type) {
    const profitBtn = document.getElementById('profitBtn');
    const lossBtn = document.getElementById('lossBtn');
    
    profitBtn.classList.remove('selected');
    lossBtn.classList.remove('selected');
    
    if (type === 'profit') {
        profitBtn.classList.add('selected');
        document.getElementById('profitLossType').value = 'profit';
        document.getElementById('amountLabel').textContent = 'üí∞ Jumlah Profit';
    } else {
        lossBtn.classList.add('selected');
        document.getElementById('profitLossType').value = 'loss';
        document.getElementById('amountLabel').textContent = 'üí∞ Jumlah Loss';
    }
    
    updateProfitDisplay();
}

// Update profit display
function updateProfitDisplay() {
    const acc = accounts[currentAccountId];
    const amount = parseFloat(document.getElementById('profitAmount').value) || 0;
    const isLoss = document.getElementById('profitLossType').value === 'loss';
    
    // Update currency display
    const currency = acc.type === 'cent' ? 'CENT' : acc.type === 'idr' ? 'IDR' : 'USD';
    document.getElementById('currencyDisplay').textContent = currency;
    document.getElementById('displayCurrencyLabel').textContent = displayInIdr ? 'IDR' : 'USD';
    
    if (amount > 0) {
        let result = 0;
        if (acc.type === 'cent') {
            const usdAmount = amount / exchangeRates.CENT_USD;
            result = displayInIdr ? usdAmount * exchangeRates.USD_IDR : usdAmount;
        } else if (acc.type === 'idr') {
            result = displayInIdr ? amount : amount / exchangeRates.USD_IDR;
        } else {
            result = displayInIdr ? amount * exchangeRates.USD_IDR : amount;
        }
        
        const finalResult = isLoss ? -result : result;
        const sign = finalResult >= 0 ? '+' : '-';
        
        document.getElementById('profitDisplay').value = 
            displayInIdr ? 
            `${sign}${formatIDR(Math.abs(finalResult))}` :
            `${sign}$${Math.abs(finalResult).toFixed(2)}`;
    } else {
        document.getElementById('profitDisplay').value = '';
    }
}

// Handle chart upload
function handleChartUpload(event) {
    const file = event.target.files[0];
    if (!file) return;
    
    if (!file.type.match('image.*')) {
        showNotification('error', 'File harus berupa gambar');
        return;
    }
    
    if (file.size > 5 * 1024 * 1024) {
        showNotification('error', 'Ukuran file maksimal 5MB');
        return;
    }
    
    const reader = new FileReader();
    reader.onload = function(e) {
        chartDataUrl = e.target.result;
        document.getElementById('chartPreview').src = chartDataUrl;
        document.getElementById('chartPreview').style.display = 'block';
        document.getElementById('removeChartBtn').style.display = 'inline-block';
        showNotification('success', 'Chart berhasil diupload');
    };
    reader.readAsDataURL(file);
}

function removeChart(event) {
    if (event) event.stopPropagation();
    chartDataUrl = null;
    document.getElementById('chartPreview').style.display = 'none';
    document.getElementById('removeChartBtn').style.display = 'none';
    document.getElementById('chartFile').value = '';
}

// Add trade
function addTrade() {
    const acc = accounts[currentAccountId];
    const amount = parseFloat(document.getElementById('profitAmount').value);
    
    if (!amount || amount <= 0) {
        showNotification('error', 'Masukkan jumlah yang valid');
        return;
    }
    
    if (!document.getElementById('pair').value.trim()) {
        showNotification('error', 'Masukkan pair trading');
        return;
    }
    
    // Calculate profit
    const isLoss = document.getElementById('profitLossType').value === 'loss';
    let profitUSD = 0, profitIDR = 0, originalAmount = amount;
    
    if (acc.type === 'cent') {
        profitUSD = amount / exchangeRates.CENT_USD;
        profitIDR = profitUSD * exchangeRates.USD_IDR;
    } else if (acc.type === 'idr') {
        profitIDR = amount;
        profitUSD = profitIDR / exchangeRates.USD_IDR;
    } else {
        profitUSD = amount;
        profitIDR = profitUSD * exchangeRates.USD_IDR;
    }
    
    if (isLoss) {
        profitUSD = -profitUSD;
        profitIDR = -profitIDR;
        originalAmount = -originalAmount;
    }
    
    // Create trade object
    const trade = {
        id: Date.now(),
        date: document.getElementById('tradeDate').value,
        pair: document.getElementById('pair').value.trim().toUpperCase(),
        direction: document.getElementById('direction').value,
        feeling: document.getElementById('feelingType').value,
        profitOriginal: parseFloat(originalAmount.toFixed(2)),
        profitUSD: parseFloat(profitUSD.toFixed(2)),
        profitIDR: parseFloat(profitIDR.toFixed(2)),
        currency: acc.type === 'cent' ? 'CENT' : acc.type === 'idr' ? 'IDR' : 'USD',
        accountType: acc.type,
        type: isLoss ? 'loss' : 'profit',
        chartData: chartDataUrl,
        notes: document.getElementById('notes').value.trim()
    };
    
    // Calculate percentage
    const capitalUSD = acc.type === 'cent' ? acc.capital / exchangeRates.CENT_USD :
                     acc.type === 'idr' ? acc.capital / exchangeRates.USD_IDR : acc.capital;
    trade.percent = capitalUSD > 0 ? (trade.profitUSD / capitalUSD * 100).toFixed(2) : 0;
    
    // Add to trades
    acc.trades.unshift(trade);
    
    // Reset form
    document.getElementById('tradeForm').reset();
    document.getElementById('tradeDate').valueAsDate = new Date();
    removeChart();
    selectFeeling('santai');
    selectProfitLoss('profit');
    
    // Save and update
    saveData();
    showNotification('success', 'Trading berhasil disimpan!');
}

// Delete trade
function deleteTrade(id) {
    if (confirm('Hapus trading ini?')) {
        const acc = accounts[currentAccountId];
        acc.trades = acc.trades.filter(t => t.id !== id);
        saveData();
        showNotification('success', 'Trading berhasil dihapus');
    }
}

// Modal functions
function showCapitalModal() {
    const acc = accounts[currentAccountId];
    const capitalInput = document.getElementById('newCapital');
    const capitalLabel = document.getElementById('capitalLabel');
    const capitalInfo = document.getElementById('capitalInfo');
    
    capitalInput.value = acc.capital;
    
    if (acc.type === 'cent') {
        capitalLabel.textContent = 'Modal (dalam CENT)';
        capitalInfo.textContent = `100 CENT = 1 USD = ${exchangeRates.USD_IDR.toLocaleString('id-ID')} IDR`;
        capitalInfo.style.display = 'block';
    } else if (acc.type === 'idr') {
        capitalLabel.textContent = 'Modal (dalam IDR)';
        capitalInfo.textContent = `${exchangeRates.USD_IDR.toLocaleString('id-ID')} IDR = 1 USD`;
        capitalInfo.style.display = 'block';
    } else {
        capitalLabel.textContent = 'Modal (dalam USD)';
        capitalInfo.style.display = 'none';
    }
    
    document.getElementById('capitalModal').style.display = 'flex';
}

function closeCapitalModal() {
    document.getElementById('capitalModal').style.display = 'none';
}

function updateInitialCapital() {
    const amount = parseFloat(document.getElementById('newCapital').value);
    if (isNaN(amount) || amount < 0) {
        showNotification('error', 'Masukkan jumlah modal yang valid');
        return;
    }
    
    accounts[currentAccountId].capital = amount;
    closeCapitalModal();
    saveData();
    showNotification('success', 'Modal berhasil diupdate');
}

function showAddAccountModal() {
    document.getElementById('addAccountModal').style.display = 'flex';
}

function closeAddAccountModal() {
    document.getElementById('addAccountModal').style.display = 'none';
}

function updateCurrencyInfo() {
    const type = document.getElementById('newAccountType').value;
    const info = document.getElementById('newAccountInfo');
    
    if (type === 'cent') {
        info.textContent = 'Masukkan dalam CENT (contoh: 1000 CENT = $10)';
        info.style.display = 'block';
    } else if (type === 'idr') {
        info.textContent = 'Masukkan dalam IDR (contoh: 1000000 = 1 juta)';
        info.style.display = 'block';
    } else {
        info.style.display = 'none';
    }
}

function addNewAccount() {
    const name = document.getElementById('newAccountName').value.trim();
    const type = document.getElementById('newAccountType').value;
    const capital = parseFloat(document.getElementById('newAccountCapital').value);
    
    if (!name) {
        showNotification('error', 'Masukkan nama account');
        return;
    }
    
    if (isNaN(capital) || capital < 0) {
        showNotification('error', 'Masukkan modal yang valid');
        return;
    }
    
    // Check for duplicate name
    const existingAccount = Object.values(accounts).find(acc => acc.name === name);
    if (existingAccount) {
        showNotification('error', 'Nama account sudah digunakan');
        return;
    }
    
    const id = `${type}-${Date.now()}`;
    accounts[id] = {
        id: id,
        name: name,
        type: type,
        capital: capital,
        trades: [],
        convertToIdr: false,
        createdAt: new Date().toISOString()
    };
    
    currentAccountId = id;
    closeAddAccountModal();
    saveData();
    renderAccountTabs();
    renderUI();
    showNotification('success', `Account "${name}" berhasil dibuat`);
}

function closeDayDetailModal() {
    document.getElementById('dayDetailModal').style.display = 'none';
}

function closeDeleteAccountModal() {
    document.getElementById('deleteAccountModal').style.display = 'none';
}

function toggleCurrencyDisplay() {
    const acc = accounts[currentAccountId];
    if (acc.type === 'idr') {
        showNotification('info', 'Account IDR selalu menampilkan IDR');
        return;
    }
    
    displayInIdr = !displayInIdr;
    const btn = document.getElementById('toggleCurrencyBtn');
    btn.textContent = displayInIdr ? 'üíµ Tampilkan USD' : 'üí± Tampilkan IDR';
    
    // Save preference to account
    acc.convertToIdr = displayInIdr;
    saveData();
    renderUI();
}

// Utility functions
function formatDate(dateString) {
    const date = new Date(dateString);
    return date.toLocaleDateString('id-ID', {
        day: '2-digit',
        month: 'short'
    });
}

function formatNumber(num) {
    const absNum = Math.abs(num);
    if (absNum >= 1000000) {
        return (absNum / 1000000).toFixed(1) + 'M';
    } else if (absNum >= 1000) {
        return (absNum / 1000).toFixed(1) + 'K';
    }
    return absNum.toFixed(2);
}

function formatIDR(amount) {
    const absAmount = Math.abs(amount);
    if (absAmount >= 1000000000) {
        return 'Rp' + (absAmount / 1000000000).toFixed(1) + 'B';
    } else if (absAmount >= 1000000) {
        return 'Rp' + (absAmount / 1000000).toFixed(1) + 'M';
    } else if (absAmount >= 1000) {
        return 'Rp' + (absAmount / 1000).toFixed(1) + 'K';
    }
    return 'Rp' + absAmount.toFixed(0);
}

function changeMonth(step) {
    currentMonth.setMonth(currentMonth.getMonth() + step);
    renderCalendar();
}

// Export/Import functions
function exportData() {
    const data = {
        accounts: accounts,
        currentAccountId: currentAccountId,
        exchangeRates: exchangeRates,
        displayInIdr: displayInIdr,
        exchangeRateMeta: exchangeRateMeta,
        exportDate: new Date().toISOString()
    };
    
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `trading-journal-${new Date().toISOString().slice(0,10)}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    showNotification('success', 'Data berhasil diekspor');
}

function importData() {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.json';
    
    input.onchange = function(e) {
        const file = e.target.files[0];
        const reader = new FileReader();
        
        reader.onload = function(e) {
            try {
                const data = JSON.parse(e.target.result);
                if (confirm(`Impor ${Object.keys(data.accounts).length} account?`)) {
                    accounts = data.accounts;
                    currentAccountId = data.currentAccountId || Object.keys(accounts)[0];
                    exchangeRates = data.exchangeRates || exchangeRates;
                    displayInIdr = data.displayInIdr || false;
                    exchangeRateMeta = data.exchangeRateMeta || exchangeRateMeta;
                    saveData();
                    renderAccountTabs();
                    renderUI();
                    showNotification('success', 'Data berhasil diimpor');
                }
            } catch (error) {
                showNotification('error', 'Gagal membaca file. Format tidak valid.');
            }
        };
        
        reader.readAsText(file);
    };
    
    input.click();
}

function clearAllData() {
    if (confirm('Hapus SEMUA data trading? Tindakan ini tidak dapat dibatalkan.')) {
        Object.keys(accounts).forEach(id => {
            accounts[id].trades = [];
            accounts[id].capital = id.includes('cent') ? 1000 : 
                                  id.includes('idr') ? 1000000 : 1000;
        });
        saveData();
        showNotification('warning', 'Semua data trading telah dihapus');
    }
}
</script>
</body>
</html>